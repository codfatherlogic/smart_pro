var k=(E,S,p)=>new Promise((y,m)=>{var v=g=>{try{h(p.next(g))}catch(w){m(w)}},f=g=>{try{h(p.throw(g))}catch(w){m(w)}},h=g=>g.done?y(g.value):Promise.resolve(g.value).then(v,f);h((p=p.apply(E,S)).next())});import{j as J,k as I,m as N,y as K,l as Q,n as x,d as R,X as Z,B as ee,C as z,e as P,r as te,Y as ae,t as V,g as F,M as $,w as se,x as oe,i as le,P as b}from"./index-DT4P12y0.js";import{f as ne,r as T,w as re,a as ie,A as j,q as n,t as s,z as D,l as r,n as l,v as c,k as d,F as A,O as B,x as o,y as u,N as _,P as ce}from"./frappe-ui-5f3Xtay5.js";const de={key:0,class:"p-4"},ue={key:1,class:"empty-state h-full"},pe={key:2,class:"empty-state h-full"},me={key:3,class:"p-4"},ve={class:"flex justify-between items-start mb-2"},fe={class:"font-semibold text-gray-800"},_e={class:"text-sm text-gray-500"},ye={class:"text-sm text-gray-600 mb-3"},ge={class:"flex items-center mb-1"},ke={key:0,class:"mt-1 text-blue-600"},be={key:1,class:"mt-2 line-clamp-3"},we={key:2,class:"mt-2 text-xs text-green-600"},xe={class:"flex space-x-2"},je={key:4,class:"p-4"},Ce={class:"flex justify-between items-start mb-2"},Re={class:"font-semibold text-gray-800"},Te={class:"text-sm text-gray-500"},De={class:"text-sm text-gray-600 mb-3"},Se={class:"flex items-center mb-1"},he={class:"flex items-center"},$e={key:0,class:"mt-1"},Ae={class:"flex space-x-2"},Be={__name:"Approvals",setup(E){const S=T(!0),p=T("date_requests"),y=T([]),m=T([]),v=T(""),f=T("");function h(){return k(this,null,function*(){try{const a=yield D("smart_pro.smart_pro.api.projects.get_pending_approvals");y.value=(a==null?void 0:a.date_requests)||[]}catch(a){console.error("Error loading date requests:",a)}})}function g(){return k(this,null,function*(){try{const a=yield D("smart_pro.smart_pro.api.projects.get_team_time_sheets");m.value=(a||[]).filter(t=>t.status==="Submitted")}catch(a){console.error("Error loading time sheets:",a)}})}function w(){return k(this,null,function*(){S.value=!0,yield Promise.all([h(),g()]),S.value=!1})}function O(a){return k(this,null,function*(){var t;v.value=a;try{yield D("smart_pro.smart_pro.api.projects.approve_date_request",{request_id:a,status:"Approved"}),yield(yield b.create({message:"Request approved successfully!",duration:2e3,color:"success"})).present(),y.value=y.value.filter(i=>i.name!==a)}catch(e){console.error("Error approving request:",e),yield(yield b.create({message:((t=e.messages)==null?void 0:t[0])||"Failed to approve request",duration:3e3,color:"danger"})).present()}finally{v.value=""}})}function q(a){return k(this,null,function*(){var t;v.value=a;try{yield D("smart_pro.smart_pro.api.projects.approve_date_request",{request_id:a,status:"Rejected"}),yield(yield b.create({message:"Request rejected successfully!",duration:2e3,color:"warning"})).present(),y.value=y.value.filter(i=>i.name!==a)}catch(e){console.error("Error rejecting request:",e),yield(yield b.create({message:((t=e.messages)==null?void 0:t[0])||"Failed to reject request",duration:3e3,color:"danger"})).present()}finally{v.value=""}})}function H(a){return k(this,null,function*(){var t;f.value=a;try{yield D("frappe.client.set_value",{doctype:"Smart Time Sheet",name:a,fieldname:{status:"Approved"}}),yield(yield b.create({message:"Time sheet approved successfully!",duration:2e3,color:"success"})).present(),m.value=m.value.filter(i=>i.name!==a)}catch(e){console.error("Error approving time sheet:",e),yield(yield b.create({message:((t=e.messages)==null?void 0:t[0])||"Failed to approve time sheet",duration:3e3,color:"danger"})).present()}finally{f.value=""}})}function L(a){return k(this,null,function*(){var t;f.value=a;try{yield D("frappe.client.set_value",{doctype:"Smart Time Sheet",name:a,fieldname:{status:"Rejected"}}),yield(yield b.create({message:"Time sheet rejected successfully!",duration:2e3,color:"warning"})).present(),m.value=m.value.filter(i=>i.name!==a)}catch(e){console.error("Error rejecting time sheet:",e),yield(yield b.create({message:((t=e.messages)==null?void 0:t[0])||"Failed to reject time sheet",duration:3e3,color:"danger"})).present()}finally{f.value=""}})}function M(a){alert(`Request Details:
Employee: ${a.employee_name}
Type: ${a.request_type}
Dates: ${C(a.from_date)} to ${C(a.to_date)}
Reason: ${a.reason||"None"}`)}function U(a){alert(`Time Sheet Details:
Employee: ${a.employee}
Date: ${C(a.date)}
Hours: ${a.hours_worked}
Task: ${a.task||"None"}
Project: ${a.project||"None"}`)}function C(a){return a?new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"-"}function G(a){return a?a.replace(/<[^>]*>/g,""):""}function W(a){return{Draft:"planning",Submitted:"pending",Approved:"completed",Rejected:"cancelled"}[a]||""}function X(a){w().finally(()=>{a.target.complete()})}function Y(){w()}return re(p,()=>{}),ie(()=>{w()}),(a,t)=>(r(),j(s(le),null,{default:n(()=>[l(s(J),null,{default:n(()=>[l(s(I),null,{default:n(()=>[l(s(N),{slot:"start"},{default:n(()=>[l(s(K),{"default-href":"/smart-pro/home",text:""})]),_:1}),l(s(Q),null,{default:n(()=>[...t[1]||(t[1]=[c("Approvals",-1)])]),_:1}),l(s(N),{slot:"end"},{default:n(()=>[l(s(x),{onClick:Y},{default:n(()=>[l(s(R),{icon:s(Z)},null,8,["icon"])]),_:1})]),_:1})]),_:1}),l(s(I),null,{default:n(()=>[l(s(ee),{modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=e=>p.value=e)},{default:n(()=>[l(s(z),{value:"date_requests"},{default:n(()=>[l(s(P),null,{default:n(()=>[...t[2]||(t[2]=[c("Date Requests",-1)])]),_:1})]),_:1}),l(s(z),{value:"timesheets"},{default:n(()=>[l(s(P),null,{default:n(()=>[...t[3]||(t[3]=[c("Time Sheets",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(s(te),{fullscreen:!0},{fixed:n(()=>[l(s(se),{onIonRefresh:X},{default:n(()=>[l(s(oe))]),_:1})]),default:n(()=>[S.value?(r(),d("div",de,[(r(),d(A,null,B(3,e=>o("div",{key:e,class:"app-card mb-4 p-4"},[...t[4]||(t[4]=[o("div",{class:"skeleton h-5 w-3/4 mb-2"},null,-1),o("div",{class:"skeleton h-4 w-1/2 mb-2"},null,-1),o("div",{class:"skeleton h-3 w-full"},null,-1)])])),64))])):p.value==="date_requests"&&y.value.length===0?(r(),d("div",ue,[l(s(R),{icon:s(ae),class:"empty-state-icon"},null,8,["icon"]),t[5]||(t[5]=o("div",{class:"empty-state-title"}," No pending date requests ",-1)),t[6]||(t[6]=o("div",{class:"empty-state-description"}," All date requests have been approved or rejected ",-1))])):p.value==="timesheets"&&m.value.length===0?(r(),d("div",pe,[l(s(R),{icon:s(V),class:"empty-state-icon"},null,8,["icon"]),t[7]||(t[7]=o("div",{class:"empty-state-title"}," No pending time sheets ",-1)),t[8]||(t[8]=o("div",{class:"empty-state-description"}," All time sheets have been approved or rejected ",-1))])):p.value==="date_requests"?(r(),d("div",me,[(r(!0),d(A,null,B(y.value,e=>(r(),d("div",{key:e.name,class:"app-card mb-4 p-4"},[o("div",ve,[o("div",null,[o("h3",fe,u(e.employee_name),1),o("div",_e,u(e.request_type),1)]),t[9]||(t[9]=o("span",{class:"status-badge pending"}," Pending ",-1))]),o("div",ye,[o("div",ge,[l(s(R),{icon:s(F),class:"mr-2"},null,8,["icon"]),c(" "+u(C(e.from_date))+" - "+u(C(e.to_date)),1)]),e.project_title?(r(),d("div",ke,[t[10]||(t[10]=o("strong",null,"Project:",-1)),c(" "+u(e.project_title),1)])):_("",!0),e.reason?(r(),d("div",be,[t[11]||(t[11]=o("strong",null,"Reason:",-1)),c(" "+u(G(e.reason)),1)])):_("",!0),e.auto_create_tasks?(r(),d("div",we," Tasks will be auto-created on approval ")):_("",!0)]),o("div",xe,[l(s(x),{expand:"block",color:"success",size:"small",disabled:v.value===e.name,onClick:i=>O(e.name)},{default:n(()=>[v.value===e.name?(r(),j(s($),{key:0,name:"crescent",class:"mr-2"})):_("",!0),t[12]||(t[12]=c(" Approve ",-1))]),_:2},1032,["disabled","onClick"]),l(s(x),{expand:"block",color:"danger",size:"small",disabled:v.value===e.name,onClick:i=>q(e.name)},{default:n(()=>[v.value===e.name?(r(),j(s($),{key:0,name:"crescent",class:"mr-2"})):_("",!0),t[13]||(t[13]=c(" Reject ",-1))]),_:2},1032,["disabled","onClick"]),l(s(x),{expand:"block",color:"medium",size:"small",onClick:i=>M(e)},{default:n(()=>[...t[14]||(t[14]=[c(" Details ",-1)])]),_:1},8,["onClick"])])]))),128))])):(r(),d("div",je,[(r(!0),d(A,null,B(m.value,e=>(r(),d("div",{key:e.name,class:"app-card mb-4 p-4"},[o("div",Ce,[o("div",null,[o("h3",Re,u(e.employee||"Employee"),1),o("div",Te,u(e.task||"General Work"),1)]),o("span",{class:ce(["status-badge",W(e.status)])},u(e.status),3)]),o("div",De,[o("div",Se,[l(s(R),{icon:s(F),class:"mr-2"},null,8,["icon"]),c(" "+u(C(e.date)),1)]),o("div",he,[l(s(R),{icon:s(V),class:"mr-2"},null,8,["icon"]),c(" "+u(e.hours_worked)+" hours ",1)]),e.project?(r(),d("div",$e,[t[15]||(t[15]=o("strong",null,"Project:",-1)),c(" "+u(e.project),1)])):_("",!0)]),o("div",Ae,[e.status==="Submitted"?(r(),j(s(x),{key:0,expand:"block",color:"success",size:"small",disabled:f.value===e.name,onClick:i=>H(e.name)},{default:n(()=>[f.value===e.name?(r(),j(s($),{key:0,name:"crescent",class:"mr-2"})):_("",!0),t[16]||(t[16]=c(" Approve ",-1))]),_:2},1032,["disabled","onClick"])):_("",!0),e.status==="Submitted"?(r(),j(s(x),{key:1,expand:"block",color:"danger",size:"small",disabled:f.value===e.name,onClick:i=>L(e.name)},{default:n(()=>[f.value===e.name?(r(),j(s($),{key:0,name:"crescent",class:"mr-2"})):_("",!0),t[17]||(t[17]=c(" Reject ",-1))]),_:2},1032,["disabled","onClick"])):_("",!0),l(s(x),{expand:"block",color:"medium",size:"small",onClick:i=>U(e)},{default:n(()=>[...t[18]||(t[18]=[c(" Details ",-1)])]),_:1},8,["onClick"])])]))),128))]))]),_:1})]),_:1}))}},ze=ne(Be,[["__scopeId","data-v-b422416c"]]);export{ze as default};
//# sourceMappingURL=Approvals-BIAgjSuz.js.map
