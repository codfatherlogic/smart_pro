var b=(I,S,p)=>new Promise((y,m)=>{var v=g=>{try{h(p.next(g))}catch(k){m(k)}},f=g=>{try{h(p.throw(g))}catch(k){m(k)}},h=g=>g.done?y(g.value):Promise.resolve(g.value).then(v,f);h((p=p.apply(I,S)).next())});import{o as Q,j as X,k as B,m as N,z as Y,l as Z,n as x,d as R,T as ee,B as te,C as z,e as V,u as ae,v as se,w as oe,U as le,t as P,g as F,J as $,i as ne,M as w}from"./index-Cn4F0kH1.js";import{f as re,r as T,w as ie,a as ce,A as j,q as n,t as s,z as D,l as r,n as l,v as c,k as d,F as A,O as E,x as o,y as u,N as _,P as de}from"./frappe-ui-5f3Xtay5.js";const ue={key:0,class:"p-4"},pe={key:1,class:"empty-state h-full"},me={key:2,class:"empty-state h-full"},ve={key:3,class:"p-4"},fe={class:"flex justify-between items-start mb-2"},_e={class:"font-semibold text-gray-800"},ye={class:"text-sm text-gray-500"},ge={class:"text-sm text-gray-600 mb-3"},ke={class:"flex items-center mb-1"},be={key:0,class:"mt-1 text-blue-600"},we={key:1,class:"mt-2 line-clamp-3"},xe={key:2,class:"mt-2 text-xs text-green-600"},je={class:"flex space-x-2"},Ce={key:4,class:"p-4"},Re={class:"flex justify-between items-start mb-2"},Te={class:"font-semibold text-gray-800"},De={class:"text-sm text-gray-500"},Se={class:"text-sm text-gray-600 mb-3"},he={class:"flex items-center mb-1"},$e={class:"flex items-center"},Ae={key:0,class:"mt-1"},Ee={class:"flex space-x-2"},Ie={__name:"Approvals",setup(I){const S=T(!0),p=T("date_requests"),y=T([]),m=T([]),v=T(""),f=T("");function h(){return b(this,null,function*(){try{const a=yield D("smart_pro.smart_pro.api.projects.get_pending_approvals");y.value=(a==null?void 0:a.date_requests)||[]}catch(a){console.error("Error loading date requests:",a)}})}function g(){return b(this,null,function*(){try{const a=yield D("smart_pro.smart_pro.api.projects.get_team_time_sheets");m.value=(a||[]).filter(t=>t.status==="Submitted")}catch(a){console.error("Error loading time sheets:",a)}})}function k(){return b(this,null,function*(){S.value=!0,yield Promise.all([h(),g()]),S.value=!1})}function O(a){return b(this,null,function*(){var t;v.value=a;try{yield D("smart_pro.smart_pro.api.projects.approve_date_request",{request_id:a,status:"Approved"}),yield(yield w.create({message:"Request approved successfully!",duration:2e3,color:"success"})).present(),y.value=y.value.filter(i=>i.name!==a)}catch(e){console.error("Error approving request:",e),yield(yield w.create({message:((t=e.messages)==null?void 0:t[0])||"Failed to approve request",duration:3e3,color:"danger"})).present()}finally{v.value=""}})}function q(a){return b(this,null,function*(){var t;v.value=a;try{yield D("smart_pro.smart_pro.api.projects.approve_date_request",{request_id:a,status:"Rejected"}),yield(yield w.create({message:"Request rejected successfully!",duration:2e3,color:"warning"})).present(),y.value=y.value.filter(i=>i.name!==a)}catch(e){console.error("Error rejecting request:",e),yield(yield w.create({message:((t=e.messages)==null?void 0:t[0])||"Failed to reject request",duration:3e3,color:"danger"})).present()}finally{v.value=""}})}function H(a){return b(this,null,function*(){var t;f.value=a;try{yield D("frappe.client.set_value",{doctype:"Smart Time Sheet",name:a,fieldname:{status:"Approved"}}),yield(yield w.create({message:"Time sheet approved successfully!",duration:2e3,color:"success"})).present(),m.value=m.value.filter(i=>i.name!==a)}catch(e){console.error("Error approving time sheet:",e),yield(yield w.create({message:((t=e.messages)==null?void 0:t[0])||"Failed to approve time sheet",duration:3e3,color:"danger"})).present()}finally{f.value=""}})}function L(a){return b(this,null,function*(){var t;f.value=a;try{yield D("frappe.client.set_value",{doctype:"Smart Time Sheet",name:a,fieldname:{status:"Rejected"}}),yield(yield w.create({message:"Time sheet rejected successfully!",duration:2e3,color:"warning"})).present(),m.value=m.value.filter(i=>i.name!==a)}catch(e){console.error("Error rejecting time sheet:",e),yield(yield w.create({message:((t=e.messages)==null?void 0:t[0])||"Failed to reject time sheet",duration:3e3,color:"danger"})).present()}finally{f.value=""}})}function U(a){alert(`Request Details:
Employee: ${a.employee_name}
Type: ${a.request_type}
Dates: ${C(a.from_date)} to ${C(a.to_date)}
Reason: ${a.reason||"None"}`)}function M(a){alert(`Time Sheet Details:
Employee: ${a.employee}
Date: ${C(a.date)}
Hours: ${a.hours_worked}
Task: ${a.task||"None"}
Project: ${a.project||"None"}`)}function C(a){return a?new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"-"}function W(a){return a?a.replace(/<[^>]*>/g,""):""}function G(a){return{Draft:"planning",Submitted:"pending",Approved:"completed",Rejected:"cancelled"}[a]||""}function J(a){k().finally(()=>{a.target.complete()})}function K(){k()}return ie(p,()=>{}),ce(()=>{k()}),Q(()=>{k()}),(a,t)=>(r(),j(s(ne),null,{default:n(()=>[l(s(X),null,{default:n(()=>[l(s(B),null,{default:n(()=>[l(s(N),{slot:"start"},{default:n(()=>[l(s(Y),{"default-href":"/smart-pro/home",text:""})]),_:1}),l(s(Z),null,{default:n(()=>[...t[1]||(t[1]=[c("Approvals",-1)])]),_:1}),l(s(N),{slot:"end"},{default:n(()=>[l(s(x),{onClick:K},{default:n(()=>[l(s(R),{icon:s(ee)},null,8,["icon"])]),_:1})]),_:1})]),_:1}),l(s(B),null,{default:n(()=>[l(s(te),{modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=e=>p.value=e)},{default:n(()=>[l(s(z),{value:"date_requests"},{default:n(()=>[l(s(V),null,{default:n(()=>[...t[2]||(t[2]=[c("Date Requests",-1)])]),_:1})]),_:1}),l(s(z),{value:"timesheets"},{default:n(()=>[l(s(V),null,{default:n(()=>[...t[3]||(t[3]=[c("Time Sheets",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(s(ae),{fullscreen:!0},{default:n(()=>[l(s(se),{slot:"fixed",onIonRefresh:J},{default:n(()=>[l(s(oe))]),_:1}),S.value?(r(),d("div",ue,[(r(),d(A,null,E(3,e=>o("div",{key:e,class:"app-card mb-4 p-4"},[...t[4]||(t[4]=[o("div",{class:"skeleton h-5 w-3/4 mb-2"},null,-1),o("div",{class:"skeleton h-4 w-1/2 mb-2"},null,-1),o("div",{class:"skeleton h-3 w-full"},null,-1)])])),64))])):p.value==="date_requests"&&y.value.length===0?(r(),d("div",pe,[l(s(R),{icon:s(le),class:"empty-state-icon"},null,8,["icon"]),t[5]||(t[5]=o("div",{class:"empty-state-title"}," No pending date requests ",-1)),t[6]||(t[6]=o("div",{class:"empty-state-description"}," All date requests have been approved or rejected ",-1))])):p.value==="timesheets"&&m.value.length===0?(r(),d("div",me,[l(s(R),{icon:s(P),class:"empty-state-icon"},null,8,["icon"]),t[7]||(t[7]=o("div",{class:"empty-state-title"}," No pending time sheets ",-1)),t[8]||(t[8]=o("div",{class:"empty-state-description"}," All time sheets have been approved or rejected ",-1))])):p.value==="date_requests"?(r(),d("div",ve,[(r(!0),d(A,null,E(y.value,e=>(r(),d("div",{key:e.name,class:"app-card mb-4 p-4"},[o("div",fe,[o("div",null,[o("h3",_e,u(e.employee_name),1),o("div",ye,u(e.request_type),1)]),t[9]||(t[9]=o("span",{class:"status-badge pending"}," Pending ",-1))]),o("div",ge,[o("div",ke,[l(s(R),{icon:s(F),class:"mr-2"},null,8,["icon"]),c(" "+u(C(e.from_date))+" - "+u(C(e.to_date)),1)]),e.project_title?(r(),d("div",be,[t[10]||(t[10]=o("strong",null,"Project:",-1)),c(" "+u(e.project_title),1)])):_("",!0),e.reason?(r(),d("div",we,[t[11]||(t[11]=o("strong",null,"Reason:",-1)),c(" "+u(W(e.reason)),1)])):_("",!0),e.auto_create_tasks?(r(),d("div",xe," Tasks will be auto-created on approval ")):_("",!0)]),o("div",je,[l(s(x),{expand:"block",color:"success",size:"small",disabled:v.value===e.name,onClick:i=>O(e.name)},{default:n(()=>[v.value===e.name?(r(),j(s($),{key:0,name:"crescent",class:"mr-2"})):_("",!0),t[12]||(t[12]=c(" Approve ",-1))]),_:2},1032,["disabled","onClick"]),l(s(x),{expand:"block",color:"danger",size:"small",disabled:v.value===e.name,onClick:i=>q(e.name)},{default:n(()=>[v.value===e.name?(r(),j(s($),{key:0,name:"crescent",class:"mr-2"})):_("",!0),t[13]||(t[13]=c(" Reject ",-1))]),_:2},1032,["disabled","onClick"]),l(s(x),{expand:"block",color:"medium",size:"small",onClick:i=>U(e)},{default:n(()=>[...t[14]||(t[14]=[c(" Details ",-1)])]),_:1},8,["onClick"])])]))),128))])):(r(),d("div",Ce,[(r(!0),d(A,null,E(m.value,e=>(r(),d("div",{key:e.name,class:"app-card mb-4 p-4"},[o("div",Re,[o("div",null,[o("h3",Te,u(e.employee||"Employee"),1),o("div",De,u(e.task||"General Work"),1)]),o("span",{class:de(["status-badge",G(e.status)])},u(e.status),3)]),o("div",Se,[o("div",he,[l(s(R),{icon:s(F),class:"mr-2"},null,8,["icon"]),c(" "+u(C(e.date)),1)]),o("div",$e,[l(s(R),{icon:s(P),class:"mr-2"},null,8,["icon"]),c(" "+u(e.hours_worked)+" hours ",1)]),e.project?(r(),d("div",Ae,[t[15]||(t[15]=o("strong",null,"Project:",-1)),c(" "+u(e.project),1)])):_("",!0)]),o("div",Ee,[e.status==="Submitted"?(r(),j(s(x),{key:0,expand:"block",color:"success",size:"small",disabled:f.value===e.name,onClick:i=>H(e.name)},{default:n(()=>[f.value===e.name?(r(),j(s($),{key:0,name:"crescent",class:"mr-2"})):_("",!0),t[16]||(t[16]=c(" Approve ",-1))]),_:2},1032,["disabled","onClick"])):_("",!0),e.status==="Submitted"?(r(),j(s(x),{key:1,expand:"block",color:"danger",size:"small",disabled:f.value===e.name,onClick:i=>L(e.name)},{default:n(()=>[f.value===e.name?(r(),j(s($),{key:0,name:"crescent",class:"mr-2"})):_("",!0),t[17]||(t[17]=c(" Reject ",-1))]),_:2},1032,["disabled","onClick"])):_("",!0),l(s(x),{expand:"block",color:"medium",size:"small",onClick:i=>M(e)},{default:n(()=>[...t[18]||(t[18]=[c(" Details ",-1)])]),_:1},8,["onClick"])])]))),128))]))]),_:1})]),_:1}))}},Ve=re(Ie,[["__scopeId","data-v-37deb81f"]]);export{Ve as default};
//# sourceMappingURL=Approvals-BmxQIiSs.js.map
