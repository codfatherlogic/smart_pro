var g=(V,S,b)=>new Promise((E,T)=>{var R=c=>{try{p(b.next(c))}catch(m){T(m)}},f=c=>{try{p(b.throw(c))}catch(m){T(m)}},p=c=>c.done?E(c.value):Promise.resolve(c.value).then(R,f);p((b=b.apply(V,S)).next())});import{o as te,j as ae,k as B,m as z,A as se,l as oe,n as x,d as C,V as le,D as ne,E as F,e as O,u as re,v as ie,w as ce,W as ue,t as q,g as L,L as A,i as de,O as k}from"./index-CfzjP1Tk.js";import{u as pe}from"./usePermissions-DkJGg_er.js";import{f as me,r as D,w as ve,a as _e,A as j,q as r,t as s,z as w,l as n,n as l,v as u,k as d,F as I,O as N,x as o,y as v,N as _,P as fe}from"./frappe-ui-5f3Xtay5.js";const ye={key:0,class:"p-4"},ge={key:1,class:"empty-state h-full"},ke={key:2,class:"empty-state h-full"},we={key:3,class:"p-4"},be={class:"flex justify-between items-start mb-2"},xe={class:"font-semibold text-gray-800"},je={class:"text-sm text-gray-500"},he={class:"text-sm text-gray-600 mb-3"},Ce={class:"flex items-center mb-1"},De={key:0,class:"mt-1 text-blue-600"},Re={key:1,class:"mt-2 line-clamp-3"},Te={key:2,class:"mt-2 text-xs text-green-600"},$e={class:"flex space-x-2"},Ae={key:4,class:"p-4"},Se={class:"flex justify-between items-start mb-2"},Ee={class:"font-semibold text-gray-800"},Pe={class:"text-sm text-gray-500"},Ie={class:"text-sm text-gray-600 mb-3"},Ne={class:"flex items-center mb-1"},Ve={class:"flex items-center"},Be={key:0,class:"mt-1"},ze={class:"flex space-x-2"},Fe={key:0,class:"text-xs text-gray-500 mt-2 italic"},Oe={__name:"Approvals",setup(V){const{fetchPermissions:S,hasFullAccess:b,isProjectManager:E,canApproveTimesheetForProject:T}=pe(),R=D(!0),f=D("date_requests"),p=D([]),c=D([]),m=D(""),y=D("");function P(a){return T(a.project)}function H(){return g(this,null,function*(){try{if(b.value){const a=yield w("smart_pro.smart_pro.api.projects.get_all_date_requests");p.value=(a||[]).filter(t=>t.status==="Pending Approval")}else{const a=yield w("smart_pro.smart_pro.api.projects.get_pending_approvals");p.value=(a==null?void 0:a.date_requests)||[]}}catch(a){console.error("Error loading date requests:",a)}})}function W(){return g(this,null,function*(){try{if(b.value||E.value){const a=yield w("smart_pro.smart_pro.api.projects.get_all_timesheets_for_approval");c.value=a||[]}else{const a=yield w("smart_pro.smart_pro.api.projects.get_team_time_sheets");c.value=(a||[]).filter(t=>t.status==="Submitted")}}catch(a){console.error("Error loading time sheets:",a)}})}function $(){return g(this,null,function*(){R.value=!0,yield S(),yield Promise.all([H(),W()]),R.value=!1})}function M(a){return g(this,null,function*(){var t;m.value=a;try{yield w("smart_pro.smart_pro.api.projects.approve_date_request",{request_id:a,status:"Approved"}),yield(yield k.create({message:"Request approved successfully!",duration:2e3,color:"success"})).present(),p.value=p.value.filter(i=>i.name!==a)}catch(e){console.error("Error approving request:",e),yield(yield k.create({message:((t=e.messages)==null?void 0:t[0])||"Failed to approve request",duration:3e3,color:"danger"})).present()}finally{m.value=""}})}function U(a){return g(this,null,function*(){var t;m.value=a;try{yield w("smart_pro.smart_pro.api.projects.approve_date_request",{request_id:a,status:"Rejected"}),yield(yield k.create({message:"Request rejected successfully!",duration:2e3,color:"warning"})).present(),p.value=p.value.filter(i=>i.name!==a)}catch(e){console.error("Error rejecting request:",e),yield(yield k.create({message:((t=e.messages)==null?void 0:t[0])||"Failed to reject request",duration:3e3,color:"danger"})).present()}finally{m.value=""}})}function G(a){return g(this,null,function*(){var t;y.value=a;try{yield w("smart_pro.smart_pro.api.projects.approve_timesheet",{timesheet_name:a}),yield(yield k.create({message:"Time sheet approved successfully!",duration:2e3,color:"success"})).present(),c.value=c.value.filter(i=>i.name!==a)}catch(e){console.error("Error approving time sheet:",e),yield(yield k.create({message:((t=e.messages)==null?void 0:t[0])||"Failed to approve time sheet",duration:3e3,color:"danger"})).present()}finally{y.value=""}})}function J(a){return g(this,null,function*(){var t;y.value=a;try{yield w("smart_pro.smart_pro.api.projects.reject_timesheet",{timesheet_name:a}),yield(yield k.create({message:"Time sheet rejected successfully!",duration:2e3,color:"warning"})).present(),c.value=c.value.filter(i=>i.name!==a)}catch(e){console.error("Error rejecting time sheet:",e),yield(yield k.create({message:((t=e.messages)==null?void 0:t[0])||"Failed to reject time sheet",duration:3e3,color:"danger"})).present()}finally{y.value=""}})}function K(a){alert(`Request Details:
Employee: ${a.employee_name}
Type: ${a.request_type}
Dates: ${h(a.from_date)} to ${h(a.to_date)}
Reason: ${a.reason||"None"}`)}function Q(a){alert(`Time Sheet Details:
Employee: ${a.employee}
Date: ${h(a.date)}
Hours: ${a.hours_worked}
Task: ${a.task||"None"}
Project: ${a.project||"None"}`)}function h(a){return a?new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"-"}function X(a){return a?a.replace(/<[^>]*>/g,""):""}function Y(a){return{Draft:"planning",Submitted:"pending",Approved:"completed",Rejected:"cancelled"}[a]||""}function Z(a){$().finally(()=>{a.target.complete()})}function ee(){$()}return ve(f,()=>{}),_e(()=>{$()}),te(()=>{$()}),(a,t)=>(n(),j(s(de),null,{default:r(()=>[l(s(ae),null,{default:r(()=>[l(s(B),null,{default:r(()=>[l(s(z),{slot:"start"},{default:r(()=>[l(s(se),{"default-href":"/smart-pro/home",text:""})]),_:1}),l(s(oe),null,{default:r(()=>[...t[1]||(t[1]=[u("Approvals",-1)])]),_:1}),l(s(z),{slot:"end"},{default:r(()=>[l(s(x),{onClick:ee},{default:r(()=>[l(s(C),{icon:s(le)},null,8,["icon"])]),_:1})]),_:1})]),_:1}),l(s(B),null,{default:r(()=>[l(s(ne),{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=e=>f.value=e)},{default:r(()=>[l(s(F),{value:"date_requests"},{default:r(()=>[l(s(O),null,{default:r(()=>[...t[2]||(t[2]=[u("Date Requests",-1)])]),_:1})]),_:1}),l(s(F),{value:"timesheets"},{default:r(()=>[l(s(O),null,{default:r(()=>[...t[3]||(t[3]=[u("Time Sheets",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(s(re),{fullscreen:!0},{default:r(()=>[l(s(ie),{slot:"fixed",onIonRefresh:Z},{default:r(()=>[l(s(ce))]),_:1}),R.value?(n(),d("div",ye,[(n(),d(I,null,N(3,e=>o("div",{key:e,class:"app-card mb-4 p-4"},[...t[4]||(t[4]=[o("div",{class:"skeleton h-5 w-3/4 mb-2"},null,-1),o("div",{class:"skeleton h-4 w-1/2 mb-2"},null,-1),o("div",{class:"skeleton h-3 w-full"},null,-1)])])),64))])):f.value==="date_requests"&&p.value.length===0?(n(),d("div",ge,[l(s(C),{icon:s(ue),class:"empty-state-icon"},null,8,["icon"]),t[5]||(t[5]=o("div",{class:"empty-state-title"}," No pending date requests ",-1)),t[6]||(t[6]=o("div",{class:"empty-state-description"}," All date requests have been approved or rejected ",-1))])):f.value==="timesheets"&&c.value.length===0?(n(),d("div",ke,[l(s(C),{icon:s(q),class:"empty-state-icon"},null,8,["icon"]),t[7]||(t[7]=o("div",{class:"empty-state-title"}," No pending time sheets ",-1)),t[8]||(t[8]=o("div",{class:"empty-state-description"}," All time sheets have been approved or rejected ",-1))])):f.value==="date_requests"?(n(),d("div",we,[(n(!0),d(I,null,N(p.value,e=>(n(),d("div",{key:e.name,class:"app-card mb-4 p-4"},[o("div",be,[o("div",null,[o("h3",xe,v(e.employee_name),1),o("div",je,v(e.request_type),1)]),t[9]||(t[9]=o("span",{class:"status-badge pending"}," Pending ",-1))]),o("div",he,[o("div",Ce,[l(s(C),{icon:s(L),class:"mr-2"},null,8,["icon"]),u(" "+v(h(e.from_date))+" - "+v(h(e.to_date)),1)]),e.project_title?(n(),d("div",De,[t[10]||(t[10]=o("strong",null,"Project:",-1)),u(" "+v(e.project_title),1)])):_("",!0),e.reason?(n(),d("div",Re,[t[11]||(t[11]=o("strong",null,"Reason:",-1)),u(" "+v(X(e.reason)),1)])):_("",!0),e.auto_create_tasks?(n(),d("div",Te," Tasks will be auto-created on approval ")):_("",!0)]),o("div",$e,[l(s(x),{expand:"block",color:"success",size:"small",disabled:m.value===e.name,onClick:i=>M(e.name)},{default:r(()=>[m.value===e.name?(n(),j(s(A),{key:0,name:"crescent",class:"mr-2"})):_("",!0),t[12]||(t[12]=u(" Approve ",-1))]),_:2},1032,["disabled","onClick"]),l(s(x),{expand:"block",color:"danger",size:"small",disabled:m.value===e.name,onClick:i=>U(e.name)},{default:r(()=>[m.value===e.name?(n(),j(s(A),{key:0,name:"crescent",class:"mr-2"})):_("",!0),t[13]||(t[13]=u(" Reject ",-1))]),_:2},1032,["disabled","onClick"]),l(s(x),{expand:"block",color:"medium",size:"small",onClick:i=>K(e)},{default:r(()=>[...t[14]||(t[14]=[u(" Details ",-1)])]),_:1},8,["onClick"])])]))),128))])):(n(),d("div",Ae,[(n(!0),d(I,null,N(c.value,e=>(n(),d("div",{key:e.name,class:"app-card mb-4 p-4"},[o("div",Se,[o("div",null,[o("h3",Ee,v(e.employee||"Employee"),1),o("div",Pe,v(e.task||"General Work"),1)]),o("span",{class:fe(["status-badge",Y(e.status)])},v(e.status),3)]),o("div",Ie,[o("div",Ne,[l(s(C),{icon:s(L),class:"mr-2"},null,8,["icon"]),u(" "+v(h(e.date)),1)]),o("div",Ve,[l(s(C),{icon:s(q),class:"mr-2"},null,8,["icon"]),u(" "+v(e.hours_worked)+" hours ",1)]),e.project?(n(),d("div",Be,[t[15]||(t[15]=o("strong",null,"Project:",-1)),u(" "+v(e.project),1)])):_("",!0)]),o("div",ze,[e.status==="Submitted"&&P(e)?(n(),j(s(x),{key:0,expand:"block",color:"success",size:"small",disabled:y.value===e.name,onClick:i=>G(e.name)},{default:r(()=>[y.value===e.name?(n(),j(s(A),{key:0,name:"crescent",class:"mr-2"})):_("",!0),t[16]||(t[16]=u(" Approve ",-1))]),_:2},1032,["disabled","onClick"])):_("",!0),e.status==="Submitted"&&P(e)?(n(),j(s(x),{key:1,expand:"block",color:"danger",size:"small",disabled:y.value===e.name,onClick:i=>J(e.name)},{default:r(()=>[y.value===e.name?(n(),j(s(A),{key:0,name:"crescent",class:"mr-2"})):_("",!0),t[17]||(t[17]=u(" Reject ",-1))]),_:2},1032,["disabled","onClick"])):_("",!0),l(s(x),{expand:"block",color:"medium",size:"small",onClick:i=>Q(e)},{default:r(()=>[...t[18]||(t[18]=[u(" Details ",-1)])]),_:1},8,["onClick"])]),e.status==="Submitted"&&!P(e)?(n(),d("div",Fe," View only - not your project ")):_("",!0)]))),128))]))]),_:1})]),_:1}))}},Me=me(Oe,[["__scopeId","data-v-3ddc90c4"]]);export{Me as default};
//# sourceMappingURL=Approvals-CLval9g5.js.map
