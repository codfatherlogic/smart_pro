var P=(D,A,y)=>new Promise((S,r)=>{var j=i=>{try{v(y.next(i))}catch(p){r(p)}},U=i=>{try{v(y.throw(i))}catch(p){r(p)}},v=i=>i.done?S(i.value):Promise.resolve(i.value).then(j,U);v((y=y.apply(D,A)).next())});import{u as H,r as f,c as M,i as z,a as J,A as g,q as s,t,z as I,M as K,l as u,n as o,v as n,x as d,k as b,N as T,R as G,F as B,O as N,y as x}from"./frappe-ui-5f3Xtay5.js";import{j as Q,k as W,m as X,A as Z,l as h,u as ee,L,e as c,M as V,J as C,K as _,N as te,n as le,i as ae,O as oe}from"./index-C-hcTcxK.js";const se={class:"p-4"},ne={key:0,class:"text-center py-8"},ue={class:"mb-4"},re={class:"mb-4"},de={class:"mb-4"},ie={class:"mb-4"},me={class:"mb-4"},pe={class:"mb-4"},ve={class:"mb-4"},ce={class:"mb-4"},fe={class:"mb-4"},ye={key:2,class:"mt-4 p-3 bg-red-50 text-red-600 rounded-lg text-sm"},xe={__name:"CreateAssignment",setup(D){const A=H(),y=K(),S=z("$dayjs"),r=A.query.project||"",j=f(""),U=M(()=>r?`/smart-pro/project/${encodeURIComponent(r)}`:"/smart-pro/projects"),v=f(!1),i=f(!0),p=f(""),k=f([]),O=f([]),R=f([]),l=f({project:r,employee:"",role:"",allocation_percentage:"100",status:"Active",start_date:S().format("YYYY-MM-DD"),end_date:"",approver:"",project_scope:""}),F=M(()=>l.value.project&&l.value.employee&&l.value.role&&l.value.start_date);function Y(){return P(this,null,function*(){i.value=!0;try{const[m,e,a]=yield Promise.all([I("frappe.client.get_list",{doctype:"Employee",filters:{status:"Active"},fields:["name","employee_name","user_id"],limit_page_length:0,order_by:"employee_name asc"}),I("frappe.client.get_list",{doctype:"Smart Role",fields:["name"],limit_page_length:0,order_by:"name asc"}),I("frappe.client.get_list",{doctype:"Smart Project",filters:{status:["!=","Cancelled"]},fields:["name","title"],limit_page_length:0,order_by:"title asc"})]);if(k.value=m||[],O.value=e||[],R.value=a||[],r){const E=R.value.find(w=>w.name===r);E&&(j.value=E.title)}}catch(m){console.error("Error loading options:",m),p.value="Failed to load form options"}finally{i.value=!1}})}function $(){const m=k.value.find(e=>e.name===l.value.employee);m&&m.user_id?l.value.approver=m.user_id:l.value.approver=""}function q(){return P(this,null,function*(){var m;if(!F.value){p.value="Please fill in all required fields";return}v.value=!0,p.value="";try{const e=k.value.find(w=>w.name===l.value.employee),a=yield I("frappe.client.insert",{doc:{doctype:"Employee Project Assignment",project:l.value.project,employee:l.value.employee,employee_name:(e==null?void 0:e.employee_name)||"",role:l.value.role,allocation_percentage:parseFloat(l.value.allocation_percentage)||100,status:l.value.status,start_date:l.value.start_date,end_date:l.value.end_date||null,approver:l.value.approver||null,project_scope:l.value.project_scope||null}});yield(yield oe.create({message:"Assignment created successfully!",duration:2e3,color:"success"})).present(),r?y.replace(`/smart-pro/project/${encodeURIComponent(r)}`):y.replace("/smart-pro/projects")}catch(e){console.error("Error creating assignment:",e),p.value=((m=e.messages)==null?void 0:m[0])||e.message||"Failed to create assignment"}finally{v.value=!1}})}return J(()=>{Y()}),(m,e)=>(u(),g(t(ae),null,{default:s(()=>[o(t(Q),null,{default:s(()=>[o(t(W),null,{default:s(()=>[o(t(X),{slot:"start"},{default:s(()=>[o(t(Z),{"default-href":U.value,text:""},null,8,["default-href"])]),_:1}),o(t(h),null,{default:s(()=>[...e[9]||(e[9]=[n("New Assignment",-1)])]),_:1})]),_:1})]),_:1}),o(t(ee),{fullscreen:!0},{default:s(()=>[d("div",se,[i.value?(u(),b("div",ne,[o(t(L),{name:"crescent"}),e[10]||(e[10]=d("p",{class:"text-gray-500 mt-2"},"Loading...",-1))])):(u(),b("form",{key:1,onSubmit:G(q,["prevent"])},[d("div",ue,[o(t(c),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:s(()=>[...e[11]||(e[11]=[n(" Project * ",-1)])]),_:1}),t(r)?(u(),g(t(V),{key:0,value:j.value||t(r),type:"text",fill:"outline",readonly:"",disabled:""},null,8,["value"])):(u(),g(t(C),{key:1,modelValue:l.value.project,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.project=a),fill:"outline",interface:"action-sheet",placeholder:"Select Project"},{default:s(()=>[(u(!0),b(B,null,N(R.value,a=>(u(),g(t(_),{key:a.name,value:a.name},{default:s(()=>[n(x(a.title||a.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]))]),d("div",re,[o(t(c),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:s(()=>[...e[12]||(e[12]=[n(" Employee * ",-1)])]),_:1}),o(t(C),{modelValue:l.value.employee,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.employee=a),fill:"outline",interface:"action-sheet",placeholder:"Select Employee",onIonChange:$},{default:s(()=>[(u(!0),b(B,null,N(k.value,a=>(u(),g(t(_),{key:a.name,value:a.name},{default:s(()=>[n(x(a.employee_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),d("div",de,[o(t(c),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:s(()=>[...e[13]||(e[13]=[n(" Role * ",-1)])]),_:1}),o(t(C),{modelValue:l.value.role,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.role=a),fill:"outline",interface:"action-sheet",placeholder:"Select Role"},{default:s(()=>[(u(!0),b(B,null,N(O.value,a=>(u(),g(t(_),{key:a.name,value:a.name},{default:s(()=>[n(x(a.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),d("div",ie,[o(t(c),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:s(()=>[...e[14]||(e[14]=[n(" Allocation Percentage ",-1)])]),_:1}),o(t(V),{modelValue:l.value.allocation_percentage,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.allocation_percentage=a),type:"number",placeholder:"100",fill:"outline",min:"0",max:"100"},null,8,["modelValue"])]),d("div",me,[o(t(c),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:s(()=>[...e[15]||(e[15]=[n(" Status ",-1)])]),_:1}),o(t(C),{modelValue:l.value.status,"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.status=a),fill:"outline",interface:"action-sheet"},{default:s(()=>[o(t(_),{value:"Active"},{default:s(()=>[...e[16]||(e[16]=[n("Active",-1)])]),_:1}),o(t(_),{value:"On Hold"},{default:s(()=>[...e[17]||(e[17]=[n("On Hold",-1)])]),_:1}),o(t(_),{value:"Completed"},{default:s(()=>[...e[18]||(e[18]=[n("Completed",-1)])]),_:1}),o(t(_),{value:"Cancelled"},{default:s(()=>[...e[19]||(e[19]=[n("Cancelled",-1)])]),_:1})]),_:1},8,["modelValue"])]),d("div",pe,[o(t(c),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:s(()=>[...e[20]||(e[20]=[n(" Start Date * ",-1)])]),_:1}),o(t(V),{modelValue:l.value.start_date,"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.start_date=a),type:"date",fill:"outline"},null,8,["modelValue"])]),d("div",ve,[o(t(c),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:s(()=>[...e[21]||(e[21]=[n(" End Date ",-1)])]),_:1}),o(t(V),{modelValue:l.value.end_date,"onUpdate:modelValue":e[6]||(e[6]=a=>l.value.end_date=a),type:"date",fill:"outline"},null,8,["modelValue"])]),d("div",ce,[o(t(c),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:s(()=>[...e[22]||(e[22]=[n(" Approver ",-1)])]),_:1}),o(t(V),{modelValue:l.value.approver,"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.approver=a),type:"text",placeholder:"Email of approver (optional)",fill:"outline",readonly:""},null,8,["modelValue"]),e[23]||(e[23]=d("p",{class:"text-xs text-gray-500 mt-1"}," Auto-filled from employee's user ID ",-1))]),d("div",fe,[o(t(c),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:s(()=>[...e[24]||(e[24]=[n(" Project Scope ",-1)])]),_:1}),o(t(te),{modelValue:l.value.project_scope,"onUpdate:modelValue":e[8]||(e[8]=a=>l.value.project_scope=a),placeholder:"Detailed description of the project scope and deliverables for this assignment",fill:"outline",rows:4,"auto-grow":!0},null,8,["modelValue"])]),o(t(le),{expand:"block",type:"submit",disabled:v.value||!F.value,class:"mt-6"},{default:s(()=>[v.value?(u(),g(t(L),{key:0,name:"crescent",class:"mr-2"})):T("",!0),n(" "+x(v.value?"Creating...":"Create Assignment"),1)]),_:1},8,["disabled"])],32)),p.value?(u(),b("div",ye,x(p.value),1)):T("",!0)])]),_:1})]),_:1}))}};export{xe as default};
//# sourceMappingURL=CreateAssignment-qRqD-lxO.js.map
