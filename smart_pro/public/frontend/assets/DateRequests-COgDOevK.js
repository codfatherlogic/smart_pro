var T=(G,_,j)=>new Promise((q,w)=>{var R=v=>{try{y(j.next(v))}catch(g){w(g)}},V=v=>{try{y(j.throw(v))}catch(g){w(g)}},y=v=>v.done?q(v.value):Promise.resolve(v.value).then(R,V);y((j=j.apply(G,_)).next())});import{f as fe,r as b,c as E,a as ve,A as O,q as l,t,z as I,i as ce,l as d,n as a,v as r,k as i,F as $,O as H,x as n,y as p,N as c,P as _e,R as h}from"./frappe-ui-5f3Xtay5.js";import{j as L,k as A,m as F,y as ye,l as z,n as x,d as D,z as ge,F as be,G as S,e as k,r as W,g as ee,p as ke,f as xe,Q as je,R as we,S as De,w as qe,x as Re,H as te,N as B,O as ae,M as se,K as le,L as C,T as Ve,U as Ie,i as Ce,P as M}from"./index-BT8PkI2H.js";const Ue={key:0,class:"p-4"},Pe={key:1,class:"empty-state h-full"},Te={class:"empty-state-description"},Me={key:2,class:"p-4"},Oe={class:"flex justify-between items-start mb-2"},Ae={class:"text-xs text-gray-500 uppercase"},Fe={class:"font-semibold text-gray-800"},Se={class:"flex items-center text-sm text-gray-600 mb-2"},Be={class:"ml-2 text-blue-600"},Ne={key:0,class:"text-sm text-gray-600 mb-2 line-clamp-2"},Ye={key:1,class:"mb-2 p-2 bg-blue-50 rounded text-sm"},Ee=["innerHTML"],$e={key:2,class:"text-xs text-gray-500"},He={key:3,class:"mt-2 p-2 bg-gray-50 rounded text-sm"},Le={key:4,class:"mt-2 text-xs text-green-600"},ze={key:5,class:"mt-3 pt-3 border-t border-gray-100"},We={class:"flex flex-wrap gap-2"},Ge={class:"mb-4"},Ke={class:"mb-4"},Qe={key:0,class:"mb-4 p-3 bg-blue-50 rounded-lg"},Je={class:"text-blue-800 font-medium"},Xe={class:"mb-4"},Ze={key:1,class:"mt-4 p-3 bg-red-50 text-red-600 rounded-lg text-sm"},he={class:"mb-4"},et={key:0,class:"mb-4"},tt={key:0,class:"mt-1 text-xs text-orange-600"},at={class:"mb-4"},st={class:"mb-4"},lt={key:1,class:"mb-4 p-3 bg-blue-50 rounded-lg"},ot={class:"text-blue-800 font-medium"},rt={class:"mb-4"},ut={key:2,class:"mb-4"},nt={key:3,class:"mt-4 p-3 bg-red-50 text-red-600 rounded-lg text-sm"},dt={__name:"DateRequests",setup(G){const _=ce("$dayjs"),j=b(!0),q=b(!1),w=b(!1),R=b(!1),V=b(!1),y=b(""),v=b(""),g=b("all"),U=b([]),N=b([]),oe=b(""),K=E(()=>g.value==="all"?U.value:g.value==="pending"?U.value.filter(o=>o.status==="Pending Approval"):g.value==="approved"?U.value.filter(o=>o.status==="Approved"):g.value==="rejected"?U.value.filter(o=>o.status==="Rejected"):U.value),u=b({request_type:"Project Date Update",project:"",from_date:"",to_date:"",reason:"",auto_create_tasks:!0}),m=b({name:"",from_date:"",to_date:"",reason:""}),Q=E(()=>{if(!u.value.from_date||!u.value.to_date)return 0;const o=_(u.value.from_date),e=_(u.value.to_date);return e.isBefore(o)?0:e.diff(o,"day")+1}),J=E(()=>{if(!m.value.from_date||!m.value.to_date)return 0;const o=_(m.value.from_date),e=_(m.value.to_date);return e.isBefore(o)?0:e.diff(o,"day")+1});function P(){return T(this,null,function*(){var o;j.value=!0;try{const[e,s,f]=yield Promise.all([I("smart_pro.smart_pro.api.projects.get_my_date_requests"),I("smart_pro.smart_pro.api.projects.get_employee_assigned_projects"),I("frappe.auth.get_logged_user")]);U.value=e||[],N.value=s||[],oe.value=f||""}catch(e){console.error("Error loading data:",e),y.value=((o=e.messages)==null?void 0:o[0])||e.message||"Failed to load data"}finally{j.value=!1}})}function X(){u.value={request_type:"Project Date Update",project:"",from_date:_().format("YYYY-MM-DD"),to_date:_().add(7,"day").format("YYYY-MM-DD"),reason:"",auto_create_tasks:!0},y.value="",q.value=!0}function re(){return T(this,null,function*(){var s;if(!u.value.from_date||!u.value.to_date||!u.value.reason){y.value="From date, to date, and reason are required";return}if(u.value.request_type==="Project Date Update"&&!u.value.project){y.value="Please select a project";return}const o=_(u.value.from_date);if(_(u.value.to_date).isBefore(o)){y.value="To date cannot be before from date";return}R.value=!0,y.value="";try{yield I("smart_pro.smart_pro.api.projects.create_date_request",{project:u.value.project||null,from_date:u.value.from_date,to_date:u.value.to_date,reason:u.value.reason,request_type:u.value.request_type,auto_create_tasks:u.value.auto_create_tasks?1:0}),yield(yield M.create({message:"Date request submitted successfully!",duration:2e3,color:"success"})).present(),q.value=!1,yield P()}catch(f){console.error("Error submitting request:",f),y.value=((s=f.messages)==null?void 0:s[0])||f.message||"Failed to submit request"}finally{R.value=!1}})}function ue(o){P().finally(()=>{o.target.complete()})}function Z(o){return o?_(o).format("MMM D, YYYY"):"-"}function Y(o){return o?o.replace(/<[^>]*>/g,""):""}function ne(o){return{Draft:"planning","Pending Approval":"on-hold",Approved:"completed",Rejected:"cancelled",Cancelled:"cancelled"}[o]||""}function de(o){m.value={name:o.name,from_date:o.from_date,to_date:o.to_date,reason:Y(o.reason||"")},v.value="",w.value=!0}function ie(){return T(this,null,function*(){var s;if(!m.value.from_date||!m.value.to_date){v.value="From date and to date are required";return}const o=_(m.value.from_date);if(_(m.value.to_date).isBefore(o)){v.value="To date cannot be before from date";return}V.value=!0,v.value="";try{yield I("smart_pro.smart_pro.api.projects.update_date_request",{request_id:m.value.name,from_date:m.value.from_date,to_date:m.value.to_date,reason:m.value.reason||null}),yield(yield M.create({message:"Date request updated successfully!",duration:2e3,color:"success"})).present(),w.value=!1,yield P()}catch(f){console.error("Error updating request:",f),v.value=((s=f.messages)==null?void 0:s[0])||f.message||"Failed to update request"}finally{V.value=!1}})}function me(o){return T(this,null,function*(){var e;try{yield I("smart_pro.smart_pro.api.projects.approve_date_request",{request_id:o.name,status:"Approved"}),yield(yield M.create({message:"Request approved successfully!",duration:2e3,color:"success"})).present(),yield P()}catch(s){console.error("Error approving request:",s),yield(yield M.create({message:((e=s.messages)==null?void 0:e[0])||s.message||"Failed to approve request",duration:3e3,color:"danger"})).present()}})}function pe(o){return T(this,null,function*(){var e;try{yield I("smart_pro.smart_pro.api.projects.approve_date_request",{request_id:o.name,status:"Rejected"}),yield(yield M.create({message:"Request rejected",duration:2e3,color:"warning"})).present(),yield P()}catch(s){console.error("Error rejecting request:",s),yield(yield M.create({message:((e=s.messages)==null?void 0:e[0])||s.message||"Failed to reject request",duration:3e3,color:"danger"})).present()}})}return ve(()=>{P()}),(o,e)=>(d(),O(t(Ce),null,{default:l(()=>[a(t(L),null,{default:l(()=>[a(t(A),null,{default:l(()=>[a(t(F),{slot:"start"},{default:l(()=>[a(t(ye),{"default-href":"/smart-pro/home",text:""})]),_:1}),a(t(z),null,{default:l(()=>[...e[14]||(e[14]=[r("Date Requests",-1)])]),_:1}),a(t(F),{slot:"end"},{default:l(()=>[a(t(x),{onClick:X},{default:l(()=>[a(t(D),{icon:t(ge)},null,8,["icon"])]),_:1})]),_:1})]),_:1}),a(t(A),null,{default:l(()=>[a(t(be),{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=s=>g.value=s),scrollable:""},{default:l(()=>[a(t(S),{value:"all"},{default:l(()=>[a(t(k),null,{default:l(()=>[...e[15]||(e[15]=[r("All",-1)])]),_:1})]),_:1}),a(t(S),{value:"pending"},{default:l(()=>[a(t(k),null,{default:l(()=>[...e[16]||(e[16]=[r("Pending",-1)])]),_:1})]),_:1}),a(t(S),{value:"approved"},{default:l(()=>[a(t(k),null,{default:l(()=>[...e[17]||(e[17]=[r("Approved",-1)])]),_:1})]),_:1}),a(t(S),{value:"rejected"},{default:l(()=>[a(t(k),null,{default:l(()=>[...e[18]||(e[18]=[r("Rejected",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(t(W),{fullscreen:!0},{fixed:l(()=>[a(t(qe),{onIonRefresh:ue},{default:l(()=>[a(t(Re))]),_:1})]),default:l(()=>[j.value?(d(),i("div",Ue,[(d(),i($,null,H(3,s=>n("div",{key:s,class:"app-card mb-4 p-4"},[...e[19]||(e[19]=[n("div",{class:"skeleton h-5 w-3/4 mb-2"},null,-1),n("div",{class:"skeleton h-4 w-1/2 mb-2"},null,-1),n("div",{class:"skeleton h-3 w-full"},null,-1)])])),64))])):K.value.length===0?(d(),i("div",Pe,[a(t(D),{icon:t(ee),class:"empty-state-icon"},null,8,["icon"]),e[21]||(e[21]=n("div",{class:"empty-state-title"},"No date requests",-1)),n("div",Te,p(g.value==="pending"?"No pending requests":g.value==="approved"?"No approved requests":g.value==="rejected"?"No rejected requests":"Submit a date request to update your project dates"),1),a(t(x),{class:"mt-4",onClick:X},{default:l(()=>[...e[20]||(e[20]=[r(" New Request ",-1)])]),_:1})])):(d(),i("div",Me,[(d(!0),i($,null,H(K.value,s=>(d(),i("div",{key:s.name,class:"app-card mb-4 p-4"},[n("div",Oe,[n("div",null,[n("span",Ae,p(s.request_type),1),n("h3",Fe,p(s.project_title||s.project||"General Request"),1)]),n("span",{class:_e(["status-badge",ne(s.status)])},p(s.status),3)]),n("div",Se,[a(t(D),{icon:t(ee),class:"mr-1"},null,8,["icon"]),r(" "+p(Z(s.from_date))+" - "+p(Z(s.to_date))+" ",1),n("span",Be,"("+p(s.total_days)+" days)",1)]),s.reason?(d(),i("div",Ne,p(Y(s.reason)),1)):c("",!0),s.project_scope?(d(),i("div",Ye,[e[22]||(e[22]=n("div",{class:"text-xs text-blue-600 font-semibold mb-1"},"Project Scope:",-1)),n("div",{class:"text-gray-700 line-clamp-3",innerHTML:s.project_scope},null,8,Ee)])):c("",!0),s.approver?(d(),i("div",$e,[a(t(D),{icon:t(ke),class:"mr-1"},null,8,["icon"]),r(" Approver: "+p(s.approver),1)])):c("",!0),s.comments&&s.status!=="Pending Approval"?(d(),i("div",He,[e[23]||(e[23]=n("span",{class:"font-medium"},"Comments:",-1)),r(" "+p(Y(s.comments)),1)])):c("",!0),s.auto_create_tasks&&s.request_type==="Project Date Update"?(d(),i("div",Le,[a(t(D),{icon:t(xe),class:"mr-1"},null,8,["icon"]),e[24]||(e[24]=r(" Tasks will be auto-created on approval ",-1))])):c("",!0),s.status==="Pending Approval"?(d(),i("div",ze,[n("div",We,[a(t(x),{size:"small",fill:"outline",color:"primary",onClick:f=>de(s)},{default:l(()=>[a(t(D),{icon:t(je),slot:"start"},null,8,["icon"]),e[25]||(e[25]=r(" Edit Dates ",-1))]),_:1},8,["onClick"]),a(t(x),{size:"small",fill:"solid",color:"success",onClick:f=>me(s)},{default:l(()=>[a(t(D),{icon:t(we),slot:"start"},null,8,["icon"]),e[26]||(e[26]=r(" Approve ",-1))]),_:1},8,["onClick"]),a(t(x),{size:"small",fill:"outline",color:"danger",onClick:f=>pe(s)},{default:l(()=>[a(t(D),{icon:t(De),slot:"start"},null,8,["icon"]),e[27]||(e[27]=r(" Reject ",-1))]),_:1},8,["onClick"])])])):c("",!0)]))),128))]))]),_:1}),a(t(te),{"is-open":w.value,onDidDismiss:e[5]||(e[5]=s=>w.value=!1)},{default:l(()=>[a(t(L),null,{default:l(()=>[a(t(A),null,{default:l(()=>[a(t(z),null,{default:l(()=>[...e[28]||(e[28]=[r("Edit Dates",-1)])]),_:1}),a(t(F),{slot:"end"},{default:l(()=>[a(t(x),{onClick:e[1]||(e[1]=s=>w.value=!1)},{default:l(()=>[...e[29]||(e[29]=[r("Close",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),a(t(W),{class:"ion-padding"},{default:l(()=>[n("form",{onSubmit:h(ie,["prevent"])},[n("div",Ge,[a(t(k),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[30]||(e[30]=[r(" From Date * ",-1)])]),_:1}),a(t(B),{modelValue:m.value.from_date,"onUpdate:modelValue":e[2]||(e[2]=s=>m.value.from_date=s),type:"date",fill:"outline",required:""},null,8,["modelValue"])]),n("div",Ke,[a(t(k),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[31]||(e[31]=[r(" To Date * ",-1)])]),_:1}),a(t(B),{modelValue:m.value.to_date,"onUpdate:modelValue":e[3]||(e[3]=s=>m.value.to_date=s),type:"date",fill:"outline",required:""},null,8,["modelValue"])]),J.value>0?(d(),i("div",Qe,[n("span",Je,"Total: "+p(J.value)+" days",1)])):c("",!0),n("div",Xe,[a(t(k),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[32]||(e[32]=[r(" Reason / Work Description ",-1)])]),_:1}),a(t(ae),{modelValue:m.value.reason,"onUpdate:modelValue":e[4]||(e[4]=s=>m.value.reason=s),placeholder:"Update reason if needed...",fill:"outline",rows:4},null,8,["modelValue"])]),a(t(x),{expand:"block",type:"submit",disabled:V.value,class:"mt-6"},{default:l(()=>[V.value?(d(),O(t(se),{key:0,name:"crescent",class:"mr-2"})):c("",!0),r(" "+p(V.value?"Updating...":"Update Request"),1)]),_:1},8,["disabled"]),v.value?(d(),i("div",Ze,p(v.value),1)):c("",!0)],32)]),_:1})]),_:1},8,["is-open"]),a(t(te),{"is-open":q.value,onDidDismiss:e[13]||(e[13]=s=>q.value=!1)},{default:l(()=>[a(t(L),null,{default:l(()=>[a(t(A),null,{default:l(()=>[a(t(z),null,{default:l(()=>[...e[33]||(e[33]=[r("New Date Request",-1)])]),_:1}),a(t(F),{slot:"end"},{default:l(()=>[a(t(x),{onClick:e[6]||(e[6]=s=>q.value=!1)},{default:l(()=>[...e[34]||(e[34]=[r("Close",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),a(t(W),{class:"ion-padding"},{default:l(()=>[n("form",{onSubmit:h(re,["prevent"])},[n("div",he,[a(t(k),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[35]||(e[35]=[r(" Request Type * ",-1)])]),_:1}),a(t(le),{modelValue:u.value.request_type,"onUpdate:modelValue":e[7]||(e[7]=s=>u.value.request_type=s),interface:"action-sheet",fill:"outline"},{default:l(()=>[a(t(C),{value:"Project Date Update"},{default:l(()=>[...e[36]||(e[36]=[r("Project Date Update",-1)])]),_:1}),a(t(C),{value:"Leave"},{default:l(()=>[...e[37]||(e[37]=[r("Leave",-1)])]),_:1}),a(t(C),{value:"Time Off"},{default:l(()=>[...e[38]||(e[38]=[r("Time Off",-1)])]),_:1}),a(t(C),{value:"Work From Home"},{default:l(()=>[...e[39]||(e[39]=[r("Work From Home",-1)])]),_:1}),a(t(C),{value:"Overtime"},{default:l(()=>[...e[40]||(e[40]=[r("Overtime",-1)])]),_:1}),a(t(C),{value:"Other"},{default:l(()=>[...e[41]||(e[41]=[r("Other",-1)])]),_:1})]),_:1},8,["modelValue"])]),u.value.request_type==="Project Date Update"?(d(),i("div",et,[a(t(k),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[42]||(e[42]=[r(" Project * ",-1)])]),_:1}),a(t(le),{modelValue:u.value.project,"onUpdate:modelValue":e[8]||(e[8]=s=>u.value.project=s),placeholder:"Select a project",interface:"action-sheet",fill:"outline"},{default:l(()=>[(d(!0),i($,null,H(N.value,s=>(d(),O(t(C),{key:s.project,value:s.project},{default:l(()=>[r(p(s.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),N.value.length===0?(d(),i("div",tt," No projects assigned to you yet. ")):c("",!0)])):c("",!0),n("div",at,[a(t(k),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[43]||(e[43]=[r(" From Date * ",-1)])]),_:1}),a(t(B),{modelValue:u.value.from_date,"onUpdate:modelValue":e[9]||(e[9]=s=>u.value.from_date=s),type:"date",fill:"outline",required:""},null,8,["modelValue"])]),n("div",st,[a(t(k),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[44]||(e[44]=[r(" To Date * ",-1)])]),_:1}),a(t(B),{modelValue:u.value.to_date,"onUpdate:modelValue":e[10]||(e[10]=s=>u.value.to_date=s),type:"date",fill:"outline",required:""},null,8,["modelValue"])]),Q.value>0?(d(),i("div",lt,[n("span",ot,"Total: "+p(Q.value)+" days",1)])):c("",!0),n("div",rt,[a(t(k),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[45]||(e[45]=[r(" Reason / Work Description * ",-1)])]),_:1}),a(t(ae),{modelValue:u.value.reason,"onUpdate:modelValue":e[11]||(e[11]=s=>u.value.reason=s),placeholder:"Describe the reason for this request or work plan...",fill:"outline",rows:4,required:""},null,8,["modelValue"])]),u.value.request_type==="Project Date Update"?(d(),i("div",ut,[a(t(Ve),{lines:"none"},{default:l(()=>[a(t(Ie),{modelValue:u.value.auto_create_tasks,"onUpdate:modelValue":e[12]||(e[12]=s=>u.value.auto_create_tasks=s),slot:"start"},null,8,["modelValue"]),a(t(k),null,{default:l(()=>[...e[46]||(e[46]=[r("Auto-create tasks on approval",-1)])]),_:1})]),_:1}),e[47]||(e[47]=n("div",{class:"text-xs text-gray-500 ml-8"}," Tasks will be automatically created and assigned to you when approved ",-1))])):c("",!0),a(t(x),{expand:"block",type:"submit",disabled:R.value,class:"mt-6"},{default:l(()=>[R.value?(d(),O(t(se),{key:0,name:"crescent",class:"mr-2"})):c("",!0),r(" "+p(R.value?"Submitting...":"Submit Request"),1)]),_:1},8,["disabled"]),y.value?(d(),i("div",nt,p(y.value),1)):c("",!0)],32)]),_:1})]),_:1},8,["is-open"])]),_:1}))}},ft=fe(dt,[["__scopeId","data-v-f6ad80d7"]]);export{ft as default};
//# sourceMappingURL=DateRequests-COgDOevK.js.map
