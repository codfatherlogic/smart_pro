var g=(M,b,R)=>new Promise((D,C)=>{var w=d=>{try{v(R.next(d))}catch(m){C(m)}},k=d=>{try{v(R.throw(d))}catch(m){C(m)}},v=d=>d.done?D(d.value):Promise.resolve(d.value).then(w,k);v((R=R.apply(M,b)).next())});import{f as ue,r as y,c as N,a as de,A as S,q as l,t as a,z as A,i as ie,l as i,n as s,v as u,k as c,F as $,O as L,x as n,y as p,N as _,P as z,R as ce}from"./frappe-ui-5f3Xtay5.js";import{o as pe,j as H,k as B,m as Y,A as me,l as G,D as fe,E as T,e as j,u as W,v as ve,w as _e,d as x,g as Q,Q as ge,R as ye,p as xe,f as be,n as V,S as we,T as ke,U as je,G as Re,M as J,N as Ce,L as Ie,i as Ae,P as K,O as q}from"./index-CfzjP1Tk.js";import{u as De}from"./usePermissions-DkJGg_er.js";const Ve={key:0,class:"p-4"},qe={key:1,class:"empty-state h-full"},he={class:"empty-state-description"},Te={key:2,class:"p-4"},Ee={class:"flex justify-between items-start mb-2"},Pe={class:"text-xs text-gray-500 uppercase"},Be={class:"font-semibold text-gray-800"},Me={class:"flex items-center text-sm text-gray-600 mb-2"},Ue={class:"ml-2 text-blue-600"},Oe={key:0,class:"text-sm text-gray-600 mb-2 line-clamp-2"},Fe={key:1,class:"mb-2 bg-blue-50 rounded text-sm overflow-hidden"},Ne=["onClick"],Se=["innerHTML"],$e={key:2,class:"text-xs text-gray-500"},Le={key:3,class:"mt-2 p-2 bg-gray-50 rounded text-sm"},ze={key:4,class:"mt-2 text-xs text-green-600"},He={key:5,class:"mt-3 pt-3 border-t border-gray-100"},Ye={class:"flex flex-wrap gap-2"},Ge={key:6,class:"mt-3 pt-3 border-t border-gray-100"},We={class:"mb-4"},Qe={class:"mb-4"},Je={key:0,class:"mb-4 p-3 bg-blue-50 rounded-lg"},Ke={class:"text-blue-800 font-medium"},Xe={class:"mb-4"},Ze={key:1,class:"mt-4 p-3 bg-red-50 text-red-600 rounded-lg text-sm"},et=3e4,tt={__name:"DateRequests",setup(M){const b=ie("$dayjs"),{fetchPermissions:R,hasFullAccess:D}=De(),C=y(!0),w=y(!1),k=y(!1),v=y(""),d=y("pending"),m=y([]),X=y(""),h=y({});function Z(o){h.value[o]=!h.value[o]}const U=N(()=>d.value==="all"?m.value:d.value==="pending"?m.value.filter(o=>o.status==="Pending Approval"):d.value==="approved"?m.value.filter(o=>o.status==="Approved"):d.value==="rejected"?m.value.filter(o=>o.status==="Rejected"):m.value),r=y({name:"",from_date:"",to_date:"",reason:""}),O=N(()=>{if(!r.value.from_date||!r.value.to_date)return 0;const o=b(r.value.from_date),e=b(r.value.to_date);return e.isBefore(o)?0:e.diff(o,"day")+1});let E=0;function I(o=!1){return g(this,null,function*(){const e=Date.now();if(!(!o&&E&&e-E<et&&m.value.length>0)){C.value=m.value.length===0;try{yield R();let t;D.value?t=yield A("smart_pro.smart_pro.api.projects.get_all_date_requests"):t=yield A("smart_pro.smart_pro.api.projects.get_my_date_requests");const f=yield A("frappe.auth.get_logged_user");m.value=t||[],X.value=f||"",E=e}catch(t){console.error("Error loading data:",t)}finally{C.value=!1}}})}function ee(o){I(!0).finally(()=>{o.target.complete()})}function F(o){return o?b(o).format("MMM D, YYYY"):"-"}function P(o){return o?o.replace(/<[^>]*>/g,""):""}function te(o){return{Draft:"planning","Pending Approval":"on-hold",Approved:"completed",Rejected:"cancelled",Cancelled:"cancelled"}[o]||""}function ae(o){r.value={name:o.name,from_date:o.from_date,to_date:o.to_date,reason:P(o.reason||"")},v.value="",w.value=!0}function se(){return g(this,null,function*(){var t;if(!r.value.from_date||!r.value.to_date){v.value="From date and to date are required";return}const o=b(r.value.from_date);if(b(r.value.to_date).isBefore(o)){v.value="To date cannot be before from date";return}k.value=!0,v.value="";try{yield A("smart_pro.smart_pro.api.projects.update_date_request",{request_id:r.value.name,from_date:r.value.from_date,to_date:r.value.to_date,reason:r.value.reason||null}),yield(yield q.create({message:"Date request updated successfully!",duration:2e3,color:"success"})).present(),w.value=!1,yield I()}catch(f){console.error("Error updating request:",f),v.value=((t=f.messages)==null?void 0:t[0])||f.message||"Failed to update request"}finally{k.value=!1}})}function oe(o){return g(this,null,function*(){yield(yield K.create({header:"Approve Request",message:"Are you sure you want to approve this date request?",buttons:[{text:"Cancel",role:"cancel"},{text:"Approve",handler:()=>g(this,null,function*(){yield le(o)})}]})).present()})}function le(o){return g(this,null,function*(){var e;try{yield A("smart_pro.smart_pro.api.projects.approve_date_request",{request_id:o.name,status:"Approved"}),yield(yield q.create({message:"Request approved successfully!",duration:2e3,color:"success"})).present(),yield I()}catch(t){console.error("Error approving request:",t),yield(yield q.create({message:((e=t.messages)==null?void 0:e[0])||t.message||"Failed to approve request",duration:3e3,color:"danger"})).present()}})}function ne(o){return g(this,null,function*(){yield(yield K.create({header:"Reject Request",message:"Are you sure you want to reject this date request?",buttons:[{text:"Cancel",role:"cancel"},{text:"Reject",cssClass:"alert-button-danger",handler:()=>g(this,null,function*(){yield re(o)})}]})).present()})}function re(o){return g(this,null,function*(){var e;try{yield A("smart_pro.smart_pro.api.projects.approve_date_request",{request_id:o.name,status:"Rejected"}),yield(yield q.create({message:"Request rejected",duration:2e3,color:"warning"})).present(),yield I()}catch(t){console.error("Error rejecting request:",t),yield(yield q.create({message:((e=t.messages)==null?void 0:e[0])||t.message||"Failed to reject request",duration:3e3,color:"danger"})).present()}})}return de(()=>{I()}),pe(()=>{I()}),(o,e)=>(i(),S(a(Ae),null,{default:l(()=>[s(a(H),null,{default:l(()=>[s(a(B),null,{default:l(()=>[s(a(Y),{slot:"start"},{default:l(()=>[s(a(me),{"default-href":"/smart-pro/home",text:""})]),_:1}),s(a(G),null,{default:l(()=>[...e[6]||(e[6]=[u("Date Requests",-1)])]),_:1})]),_:1}),s(a(B),null,{default:l(()=>[s(a(fe),{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=t=>d.value=t),scrollable:""},{default:l(()=>[s(a(T),{value:"all"},{default:l(()=>[s(a(j),null,{default:l(()=>[...e[7]||(e[7]=[u("All",-1)])]),_:1})]),_:1}),s(a(T),{value:"pending"},{default:l(()=>[s(a(j),null,{default:l(()=>[...e[8]||(e[8]=[u("Pending",-1)])]),_:1})]),_:1}),s(a(T),{value:"approved"},{default:l(()=>[s(a(j),null,{default:l(()=>[...e[9]||(e[9]=[u("Approved",-1)])]),_:1})]),_:1}),s(a(T),{value:"rejected"},{default:l(()=>[s(a(j),null,{default:l(()=>[...e[10]||(e[10]=[u("Rejected",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(a(W),{fullscreen:!0},{default:l(()=>[s(a(ve),{slot:"fixed",onIonRefresh:ee},{default:l(()=>[s(a(_e))]),_:1}),C.value?(i(),c("div",Ve,[(i(),c($,null,L(3,t=>n("div",{key:t,class:"app-card mb-4 p-4"},[...e[11]||(e[11]=[n("div",{class:"skeleton h-5 w-3/4 mb-2"},null,-1),n("div",{class:"skeleton h-4 w-1/2 mb-2"},null,-1),n("div",{class:"skeleton h-3 w-full"},null,-1)])])),64))])):U.value.length===0?(i(),c("div",qe,[s(a(x),{icon:a(Q),class:"empty-state-icon"},null,8,["icon"]),e[12]||(e[12]=n("div",{class:"empty-state-title"},"No date requests",-1)),n("div",he,p(d.value==="pending"?"No pending requests":d.value==="approved"?"No approved requests":d.value==="rejected"?"No rejected requests":"Your date requests will appear here"),1)])):(i(),c("div",Te,[(i(!0),c($,null,L(U.value,t=>(i(),c("div",{key:t.name,class:"app-card mb-4 p-4"},[n("div",Ee,[n("div",null,[n("span",Pe,p(t.request_type),1),n("h3",Be,p(t.project_title||t.project||"General Request"),1)]),n("span",{class:z(["status-badge",te(t.status)])},p(t.status),3)]),n("div",Me,[s(a(x),{icon:a(Q),class:"mr-1"},null,8,["icon"]),u(" "+p(F(t.from_date))+" - "+p(F(t.to_date))+" ",1),n("span",Ue,"("+p(t.total_days)+" days)",1)]),t.reason?(i(),c("div",Oe,p(P(t.reason)),1)):_("",!0),t.project_scope?(i(),c("div",Fe,[n("div",{class:"flex items-center justify-between p-2 cursor-pointer",onClick:f=>Z(t.name)},[e[13]||(e[13]=n("div",{class:"text-xs text-blue-600 font-semibold"},"Project Scope:",-1)),s(a(x),{icon:h.value[t.name]?a(ge):a(ye),class:"text-blue-600"},null,8,["icon"])],8,Ne),n("div",{class:z(["scope-content px-2 pb-2",{expanded:h.value[t.name]}])},[n("div",{class:"text-gray-700 whitespace-pre-wrap",innerHTML:t.project_scope},null,8,Se)],2)])):_("",!0),t.approver?(i(),c("div",$e,[s(a(x),{icon:a(xe),class:"mr-1"},null,8,["icon"]),u(" Approver: "+p(t.approver),1)])):_("",!0),t.comments&&t.status!=="Pending Approval"?(i(),c("div",Le,[e[14]||(e[14]=n("span",{class:"font-medium"},"Comments:",-1)),u(" "+p(P(t.comments)),1)])):_("",!0),t.auto_create_tasks&&t.request_type==="Project Date Update"?(i(),c("div",ze,[s(a(x),{icon:a(be),class:"mr-1"},null,8,["icon"]),e[15]||(e[15]=u(" Tasks will be auto-created on approval ",-1))])):_("",!0),t.status==="Pending Approval"&&!a(D)?(i(),c("div",He,[n("div",Ye,[s(a(V),{size:"small",fill:"outline",color:"primary",onClick:f=>ae(t)},{default:l(()=>[s(a(x),{icon:a(we),slot:"start"},null,8,["icon"]),e[16]||(e[16]=u(" Edit Dates ",-1))]),_:1},8,["onClick"]),s(a(V),{size:"small",fill:"solid",color:"success",onClick:f=>oe(t)},{default:l(()=>[s(a(x),{icon:a(ke),slot:"start"},null,8,["icon"]),e[17]||(e[17]=u(" Approve ",-1))]),_:1},8,["onClick"]),s(a(V),{size:"small",fill:"outline",color:"danger",onClick:f=>ne(t)},{default:l(()=>[s(a(x),{icon:a(je),slot:"start"},null,8,["icon"]),e[18]||(e[18]=u(" Reject ",-1))]),_:1},8,["onClick"])])])):_("",!0),t.status==="Pending Approval"&&a(D)?(i(),c("div",Ge,[...e[19]||(e[19]=[n("div",{class:"text-xs text-gray-500 italic"}," View only mode - Full access users cannot approve/reject date requests ",-1)])])):_("",!0)]))),128))]))]),_:1}),s(a(Re),{"is-open":w.value,onDidDismiss:e[5]||(e[5]=t=>w.value=!1)},{default:l(()=>[s(a(H),null,{default:l(()=>[s(a(B),null,{default:l(()=>[s(a(G),null,{default:l(()=>[...e[20]||(e[20]=[u("Edit Dates",-1)])]),_:1}),s(a(Y),{slot:"end"},{default:l(()=>[s(a(V),{onClick:e[1]||(e[1]=t=>w.value=!1)},{default:l(()=>[...e[21]||(e[21]=[u("Close",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),s(a(W),{class:"ion-padding"},{default:l(()=>[n("form",{onSubmit:ce(se,["prevent"])},[n("div",We,[s(a(j),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[22]||(e[22]=[u(" From Date * ",-1)])]),_:1}),s(a(J),{modelValue:r.value.from_date,"onUpdate:modelValue":e[2]||(e[2]=t=>r.value.from_date=t),type:"date",fill:"outline",required:""},null,8,["modelValue"])]),n("div",Qe,[s(a(j),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[23]||(e[23]=[u(" To Date * ",-1)])]),_:1}),s(a(J),{modelValue:r.value.to_date,"onUpdate:modelValue":e[3]||(e[3]=t=>r.value.to_date=t),type:"date",fill:"outline",required:""},null,8,["modelValue"])]),O.value>0?(i(),c("div",Je,[n("span",Ke,"Total: "+p(O.value)+" days",1)])):_("",!0),n("div",Xe,[s(a(j),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[24]||(e[24]=[u(" Reason / Work Description ",-1)])]),_:1}),s(a(Ce),{modelValue:r.value.reason,"onUpdate:modelValue":e[4]||(e[4]=t=>r.value.reason=t),placeholder:"Update reason if needed...",fill:"outline",rows:4},null,8,["modelValue"])]),s(a(V),{expand:"block",type:"submit",disabled:k.value,class:"mt-6"},{default:l(()=>[k.value?(i(),S(a(Ie),{key:0,name:"crescent",class:"mr-2"})):_("",!0),u(" "+p(k.value?"Updating...":"Update Request"),1)]),_:1},8,["disabled"]),v.value?(i(),c("div",Ze,p(v.value),1)):_("",!0)],32)]),_:1})]),_:1},8,["is-open"])]),_:1}))}},nt=ue(tt,[["__scopeId","data-v-bd4b14d4"]]);export{nt as default};
//# sourceMappingURL=DateRequests-Cav1STJc.js.map
