var D=(O,j,x)=>new Promise((R,b)=>{var v=_=>{try{c(x.next(_))}catch(k){b(k)}},f=_=>{try{c(x.throw(_))}catch(k){b(k)}},c=_=>_.done?R(_.value):Promise.resolve(_.value).then(v,f);c((x=x.apply(O,j)).next())});import{f as se,r as g,c as h,a as le,A as N,q as o,t as a,z as V,i as oe,l as u,n as s,v as d,k as i,F as $,O as F,x as n,y as p,N as y,P as L,R as ne}from"./frappe-ui-5f3Xtay5.js";import{o as re,j as z,k as P,m as H,z as de,l as Y,B as ue,C as T,e as C,u as W,v as ie,w as pe,d as w,g as G,O as ce,P as me,p as fe,f as ve,n as A,Q as _e,R as ge,S as ye,E as xe,K as J,L as be,J as ke,i as we,M as E}from"./index-Cn4F0kH1.js";const je={key:0,class:"p-4"},Re={key:1,class:"empty-state h-full"},Ce={class:"empty-state-description"},Ie={key:2,class:"p-4"},De={class:"flex justify-between items-start mb-2"},Ve={class:"text-xs text-gray-500 uppercase"},Ae={class:"font-semibold text-gray-800"},Ee={class:"flex items-center text-sm text-gray-600 mb-2"},Te={class:"ml-2 text-blue-600"},Be={key:0,class:"text-sm text-gray-600 mb-2 line-clamp-2"},Me={key:1,class:"mb-2 bg-blue-50 rounded text-sm overflow-hidden"},Pe=["onClick"],Oe=["innerHTML"],Ue={key:2,class:"text-xs text-gray-500"},qe={key:3,class:"mt-2 p-2 bg-gray-50 rounded text-sm"},Se={key:4,class:"mt-2 text-xs text-green-600"},he={key:5,class:"mt-3 pt-3 border-t border-gray-100"},Ne={class:"flex flex-wrap gap-2"},$e={class:"mb-4"},Fe={class:"mb-4"},Le={key:0,class:"mb-4 p-3 bg-blue-50 rounded-lg"},ze={class:"text-blue-800 font-medium"},He={class:"mb-4"},Ye={key:1,class:"mt-4 p-3 bg-red-50 text-red-600 rounded-lg text-sm"},We=3e4,Ge={__name:"DateRequests",setup(O){const j=oe("$dayjs"),x=g(!0),R=g(!1),b=g(!1),v=g(""),f=g("pending"),c=g([]),_=g(""),k=g({});function K(l){k.value[l]=!k.value[l]}const U=h(()=>f.value==="all"?c.value:f.value==="pending"?c.value.filter(l=>l.status==="Pending Approval"):f.value==="approved"?c.value.filter(l=>l.status==="Approved"):f.value==="rejected"?c.value.filter(l=>l.status==="Rejected"):c.value),r=g({name:"",from_date:"",to_date:"",reason:""}),q=h(()=>{if(!r.value.from_date||!r.value.to_date)return 0;const l=j(r.value.from_date),e=j(r.value.to_date);return e.isBefore(l)?0:e.diff(l,"day")+1});let B=0;function I(l=!1){return D(this,null,function*(){const e=Date.now();if(!(!l&&B&&e-B<We&&c.value.length>0)){x.value=c.value.length===0;try{const[t,m]=yield Promise.all([V("smart_pro.smart_pro.api.projects.get_my_date_requests"),V("frappe.auth.get_logged_user")]);c.value=t||[],_.value=m||"",B=e}catch(t){console.error("Error loading data:",t)}finally{x.value=!1}}})}function Q(l){I(!0).finally(()=>{l.target.complete()})}function S(l){return l?j(l).format("MMM D, YYYY"):"-"}function M(l){return l?l.replace(/<[^>]*>/g,""):""}function X(l){return{Draft:"planning","Pending Approval":"on-hold",Approved:"completed",Rejected:"cancelled",Cancelled:"cancelled"}[l]||""}function Z(l){r.value={name:l.name,from_date:l.from_date,to_date:l.to_date,reason:M(l.reason||"")},v.value="",R.value=!0}function ee(){return D(this,null,function*(){var t;if(!r.value.from_date||!r.value.to_date){v.value="From date and to date are required";return}const l=j(r.value.from_date);if(j(r.value.to_date).isBefore(l)){v.value="To date cannot be before from date";return}b.value=!0,v.value="";try{yield V("smart_pro.smart_pro.api.projects.update_date_request",{request_id:r.value.name,from_date:r.value.from_date,to_date:r.value.to_date,reason:r.value.reason||null}),yield(yield E.create({message:"Date request updated successfully!",duration:2e3,color:"success"})).present(),R.value=!1,yield I()}catch(m){console.error("Error updating request:",m),v.value=((t=m.messages)==null?void 0:t[0])||m.message||"Failed to update request"}finally{b.value=!1}})}function te(l){return D(this,null,function*(){var e;try{yield V("smart_pro.smart_pro.api.projects.approve_date_request",{request_id:l.name,status:"Approved"}),yield(yield E.create({message:"Request approved successfully!",duration:2e3,color:"success"})).present(),yield I()}catch(t){console.error("Error approving request:",t),yield(yield E.create({message:((e=t.messages)==null?void 0:e[0])||t.message||"Failed to approve request",duration:3e3,color:"danger"})).present()}})}function ae(l){return D(this,null,function*(){var e;try{yield V("smart_pro.smart_pro.api.projects.approve_date_request",{request_id:l.name,status:"Rejected"}),yield(yield E.create({message:"Request rejected",duration:2e3,color:"warning"})).present(),yield I()}catch(t){console.error("Error rejecting request:",t),yield(yield E.create({message:((e=t.messages)==null?void 0:e[0])||t.message||"Failed to reject request",duration:3e3,color:"danger"})).present()}})}return le(()=>{I()}),re(()=>{I()}),(l,e)=>(u(),N(a(we),null,{default:o(()=>[s(a(z),null,{default:o(()=>[s(a(P),null,{default:o(()=>[s(a(H),{slot:"start"},{default:o(()=>[s(a(de),{"default-href":"/smart-pro/home",text:""})]),_:1}),s(a(Y),null,{default:o(()=>[...e[6]||(e[6]=[d("Date Requests",-1)])]),_:1})]),_:1}),s(a(P),null,{default:o(()=>[s(a(ue),{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=t=>f.value=t),scrollable:""},{default:o(()=>[s(a(T),{value:"all"},{default:o(()=>[s(a(C),null,{default:o(()=>[...e[7]||(e[7]=[d("All",-1)])]),_:1})]),_:1}),s(a(T),{value:"pending"},{default:o(()=>[s(a(C),null,{default:o(()=>[...e[8]||(e[8]=[d("Pending",-1)])]),_:1})]),_:1}),s(a(T),{value:"approved"},{default:o(()=>[s(a(C),null,{default:o(()=>[...e[9]||(e[9]=[d("Approved",-1)])]),_:1})]),_:1}),s(a(T),{value:"rejected"},{default:o(()=>[s(a(C),null,{default:o(()=>[...e[10]||(e[10]=[d("Rejected",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(a(W),{fullscreen:!0},{default:o(()=>[s(a(ie),{slot:"fixed",onIonRefresh:Q},{default:o(()=>[s(a(pe))]),_:1}),x.value?(u(),i("div",je,[(u(),i($,null,F(3,t=>n("div",{key:t,class:"app-card mb-4 p-4"},[...e[11]||(e[11]=[n("div",{class:"skeleton h-5 w-3/4 mb-2"},null,-1),n("div",{class:"skeleton h-4 w-1/2 mb-2"},null,-1),n("div",{class:"skeleton h-3 w-full"},null,-1)])])),64))])):U.value.length===0?(u(),i("div",Re,[s(a(w),{icon:a(G),class:"empty-state-icon"},null,8,["icon"]),e[12]||(e[12]=n("div",{class:"empty-state-title"},"No date requests",-1)),n("div",Ce,p(f.value==="pending"?"No pending requests":f.value==="approved"?"No approved requests":f.value==="rejected"?"No rejected requests":"Your date requests will appear here"),1)])):(u(),i("div",Ie,[(u(!0),i($,null,F(U.value,t=>(u(),i("div",{key:t.name,class:"app-card mb-4 p-4"},[n("div",De,[n("div",null,[n("span",Ve,p(t.request_type),1),n("h3",Ae,p(t.project_title||t.project||"General Request"),1)]),n("span",{class:L(["status-badge",X(t.status)])},p(t.status),3)]),n("div",Ee,[s(a(w),{icon:a(G),class:"mr-1"},null,8,["icon"]),d(" "+p(S(t.from_date))+" - "+p(S(t.to_date))+" ",1),n("span",Te,"("+p(t.total_days)+" days)",1)]),t.reason?(u(),i("div",Be,p(M(t.reason)),1)):y("",!0),t.project_scope?(u(),i("div",Me,[n("div",{class:"flex items-center justify-between p-2 cursor-pointer",onClick:m=>K(t.name)},[e[13]||(e[13]=n("div",{class:"text-xs text-blue-600 font-semibold"},"Project Scope:",-1)),s(a(w),{icon:k.value[t.name]?a(ce):a(me),class:"text-blue-600"},null,8,["icon"])],8,Pe),n("div",{class:L(["scope-content px-2 pb-2",{expanded:k.value[t.name]}])},[n("div",{class:"text-gray-700 whitespace-pre-wrap",innerHTML:t.project_scope},null,8,Oe)],2)])):y("",!0),t.approver?(u(),i("div",Ue,[s(a(w),{icon:a(fe),class:"mr-1"},null,8,["icon"]),d(" Approver: "+p(t.approver),1)])):y("",!0),t.comments&&t.status!=="Pending Approval"?(u(),i("div",qe,[e[14]||(e[14]=n("span",{class:"font-medium"},"Comments:",-1)),d(" "+p(M(t.comments)),1)])):y("",!0),t.auto_create_tasks&&t.request_type==="Project Date Update"?(u(),i("div",Se,[s(a(w),{icon:a(ve),class:"mr-1"},null,8,["icon"]),e[15]||(e[15]=d(" Tasks will be auto-created on approval ",-1))])):y("",!0),t.status==="Pending Approval"?(u(),i("div",he,[n("div",Ne,[s(a(A),{size:"small",fill:"outline",color:"primary",onClick:m=>Z(t)},{default:o(()=>[s(a(w),{icon:a(_e),slot:"start"},null,8,["icon"]),e[16]||(e[16]=d(" Edit Dates ",-1))]),_:1},8,["onClick"]),s(a(A),{size:"small",fill:"solid",color:"success",onClick:m=>te(t)},{default:o(()=>[s(a(w),{icon:a(ge),slot:"start"},null,8,["icon"]),e[17]||(e[17]=d(" Approve ",-1))]),_:1},8,["onClick"]),s(a(A),{size:"small",fill:"outline",color:"danger",onClick:m=>ae(t)},{default:o(()=>[s(a(w),{icon:a(ye),slot:"start"},null,8,["icon"]),e[18]||(e[18]=d(" Reject ",-1))]),_:1},8,["onClick"])])])):y("",!0)]))),128))]))]),_:1}),s(a(xe),{"is-open":R.value,onDidDismiss:e[5]||(e[5]=t=>R.value=!1)},{default:o(()=>[s(a(z),null,{default:o(()=>[s(a(P),null,{default:o(()=>[s(a(Y),null,{default:o(()=>[...e[19]||(e[19]=[d("Edit Dates",-1)])]),_:1}),s(a(H),{slot:"end"},{default:o(()=>[s(a(A),{onClick:e[1]||(e[1]=t=>R.value=!1)},{default:o(()=>[...e[20]||(e[20]=[d("Close",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),s(a(W),{class:"ion-padding"},{default:o(()=>[n("form",{onSubmit:ne(ee,["prevent"])},[n("div",$e,[s(a(C),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:o(()=>[...e[21]||(e[21]=[d(" From Date * ",-1)])]),_:1}),s(a(J),{modelValue:r.value.from_date,"onUpdate:modelValue":e[2]||(e[2]=t=>r.value.from_date=t),type:"date",fill:"outline",required:""},null,8,["modelValue"])]),n("div",Fe,[s(a(C),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:o(()=>[...e[22]||(e[22]=[d(" To Date * ",-1)])]),_:1}),s(a(J),{modelValue:r.value.to_date,"onUpdate:modelValue":e[3]||(e[3]=t=>r.value.to_date=t),type:"date",fill:"outline",required:""},null,8,["modelValue"])]),q.value>0?(u(),i("div",Le,[n("span",ze,"Total: "+p(q.value)+" days",1)])):y("",!0),n("div",He,[s(a(C),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:o(()=>[...e[23]||(e[23]=[d(" Reason / Work Description ",-1)])]),_:1}),s(a(be),{modelValue:r.value.reason,"onUpdate:modelValue":e[4]||(e[4]=t=>r.value.reason=t),placeholder:"Update reason if needed...",fill:"outline",rows:4},null,8,["modelValue"])]),s(a(A),{expand:"block",type:"submit",disabled:b.value,class:"mt-6"},{default:o(()=>[b.value?(u(),N(a(ke),{key:0,name:"crescent",class:"mr-2"})):y("",!0),d(" "+p(b.value?"Updating...":"Update Request"),1)]),_:1},8,["disabled"]),v.value?(u(),i("div",Ye,p(v.value),1)):y("",!0)],32)]),_:1})]),_:1},8,["is-open"])]),_:1}))}},Xe=se(Ge,[["__scopeId","data-v-e7dd01c9"]]);export{Xe as default};
//# sourceMappingURL=DateRequests-D8yi1jLe.js.map
