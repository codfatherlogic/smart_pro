var O=(K,y,w)=>new Promise((R,D)=>{var V=v=>{try{g(w.next(v))}catch(b){D(b)}},q=v=>{try{g(w.throw(v))}catch(b){D(b)}},g=v=>v.done?R(v.value):Promise.resolve(v.value).then(V,q);g((w=w.apply(K,y)).next())});import{f as _e,r as _,c as $,a as ye,A as S,q as l,t,z as C,i as ge,l as d,n as s,v as r,k as i,F as H,O as L,x as u,y as f,N as c,P as ee,R as te}from"./frappe-ui-5f3Xtay5.js";import{j as z,k as A,m as B,y as be,l as W,n as x,d as j,z as ke,B as xe,C as F,e as k,r as G,g as ae,Q as je,R as we,p as De,f as Re,S as Ve,T as qe,U as Ce,w as Ie,x as Ue,H as se,N,O as le,M as oe,K as re,L as I,V as Pe,W as Oe,i as Te,P as T}from"./index-DT4P12y0.js";const Me={key:0,class:"p-4"},Se={key:1,class:"empty-state h-full"},Ae={class:"empty-state-description"},Be={key:2,class:"p-4"},Fe={class:"flex justify-between items-start mb-2"},Ne={class:"text-xs text-gray-500 uppercase"},Ye={class:"font-semibold text-gray-800"},Ee={class:"flex items-center text-sm text-gray-600 mb-2"},$e={class:"ml-2 text-blue-600"},He={key:0,class:"text-sm text-gray-600 mb-2 line-clamp-2"},Le={key:1,class:"mb-2 bg-blue-50 rounded text-sm overflow-hidden"},ze=["onClick"],We=["innerHTML"],Ge={key:2,class:"text-xs text-gray-500"},Ke={key:3,class:"mt-2 p-2 bg-gray-50 rounded text-sm"},Qe={key:4,class:"mt-2 text-xs text-green-600"},Je={key:5,class:"mt-3 pt-3 border-t border-gray-100"},Xe={class:"flex flex-wrap gap-2"},Ze={class:"mb-4"},he={class:"mb-4"},et={key:0,class:"mb-4 p-3 bg-blue-50 rounded-lg"},tt={class:"text-blue-800 font-medium"},at={class:"mb-4"},st={key:1,class:"mt-4 p-3 bg-red-50 text-red-600 rounded-lg text-sm"},lt={class:"mb-4"},ot={key:0,class:"mb-4"},rt={key:0,class:"mt-1 text-xs text-orange-600"},nt={class:"mb-4"},ut={class:"mb-4"},dt={key:1,class:"mb-4 p-3 bg-blue-50 rounded-lg"},it={class:"text-blue-800 font-medium"},mt={class:"mb-4"},pt={key:2,class:"mb-4"},ft={key:3,class:"mt-4 p-3 bg-red-50 text-red-600 rounded-lg text-sm"},vt={__name:"DateRequests",setup(K){const y=ge("$dayjs"),w=_(!0),R=_(!1),D=_(!1),V=_(!1),q=_(!1),g=_(""),v=_(""),b=_("all"),U=_([]),Y=_([]),ne=_(""),M=_({});function ue(o){M.value[o]=!M.value[o]}const Q=$(()=>b.value==="all"?U.value:b.value==="pending"?U.value.filter(o=>o.status==="Pending Approval"):b.value==="approved"?U.value.filter(o=>o.status==="Approved"):b.value==="rejected"?U.value.filter(o=>o.status==="Rejected"):U.value),n=_({request_type:"Project Date Update",project:"",from_date:"",to_date:"",reason:"",auto_create_tasks:!0}),m=_({name:"",from_date:"",to_date:"",reason:""}),J=$(()=>{if(!n.value.from_date||!n.value.to_date)return 0;const o=y(n.value.from_date),e=y(n.value.to_date);return e.isBefore(o)?0:e.diff(o,"day")+1}),X=$(()=>{if(!m.value.from_date||!m.value.to_date)return 0;const o=y(m.value.from_date),e=y(m.value.to_date);return e.isBefore(o)?0:e.diff(o,"day")+1});function P(){return O(this,null,function*(){var o;w.value=!0;try{const[e,a,p]=yield Promise.all([C("smart_pro.smart_pro.api.projects.get_my_date_requests"),C("smart_pro.smart_pro.api.projects.get_employee_assigned_projects"),C("frappe.auth.get_logged_user")]);U.value=e||[],Y.value=a||[],ne.value=p||""}catch(e){console.error("Error loading data:",e),g.value=((o=e.messages)==null?void 0:o[0])||e.message||"Failed to load data"}finally{w.value=!1}})}function Z(){n.value={request_type:"Project Date Update",project:"",from_date:y().format("YYYY-MM-DD"),to_date:y().add(7,"day").format("YYYY-MM-DD"),reason:"",auto_create_tasks:!0},g.value="",R.value=!0}function de(){return O(this,null,function*(){var a;if(!n.value.from_date||!n.value.to_date||!n.value.reason){g.value="From date, to date, and reason are required";return}if(n.value.request_type==="Project Date Update"&&!n.value.project){g.value="Please select a project";return}const o=y(n.value.from_date);if(y(n.value.to_date).isBefore(o)){g.value="To date cannot be before from date";return}V.value=!0,g.value="";try{yield C("smart_pro.smart_pro.api.projects.create_date_request",{project:n.value.project||null,from_date:n.value.from_date,to_date:n.value.to_date,reason:n.value.reason,request_type:n.value.request_type,auto_create_tasks:n.value.auto_create_tasks?1:0}),yield(yield T.create({message:"Date request submitted successfully!",duration:2e3,color:"success"})).present(),R.value=!1,yield P()}catch(p){console.error("Error submitting request:",p),g.value=((a=p.messages)==null?void 0:a[0])||p.message||"Failed to submit request"}finally{V.value=!1}})}function ie(o){P().finally(()=>{o.target.complete()})}function h(o){return o?y(o).format("MMM D, YYYY"):"-"}function E(o){return o?o.replace(/<[^>]*>/g,""):""}function me(o){return{Draft:"planning","Pending Approval":"on-hold",Approved:"completed",Rejected:"cancelled",Cancelled:"cancelled"}[o]||""}function pe(o){m.value={name:o.name,from_date:o.from_date,to_date:o.to_date,reason:E(o.reason||"")},v.value="",D.value=!0}function fe(){return O(this,null,function*(){var a;if(!m.value.from_date||!m.value.to_date){v.value="From date and to date are required";return}const o=y(m.value.from_date);if(y(m.value.to_date).isBefore(o)){v.value="To date cannot be before from date";return}q.value=!0,v.value="";try{yield C("smart_pro.smart_pro.api.projects.update_date_request",{request_id:m.value.name,from_date:m.value.from_date,to_date:m.value.to_date,reason:m.value.reason||null}),yield(yield T.create({message:"Date request updated successfully!",duration:2e3,color:"success"})).present(),D.value=!1,yield P()}catch(p){console.error("Error updating request:",p),v.value=((a=p.messages)==null?void 0:a[0])||p.message||"Failed to update request"}finally{q.value=!1}})}function ve(o){return O(this,null,function*(){var e;try{yield C("smart_pro.smart_pro.api.projects.approve_date_request",{request_id:o.name,status:"Approved"}),yield(yield T.create({message:"Request approved successfully!",duration:2e3,color:"success"})).present(),yield P()}catch(a){console.error("Error approving request:",a),yield(yield T.create({message:((e=a.messages)==null?void 0:e[0])||a.message||"Failed to approve request",duration:3e3,color:"danger"})).present()}})}function ce(o){return O(this,null,function*(){var e;try{yield C("smart_pro.smart_pro.api.projects.approve_date_request",{request_id:o.name,status:"Rejected"}),yield(yield T.create({message:"Request rejected",duration:2e3,color:"warning"})).present(),yield P()}catch(a){console.error("Error rejecting request:",a),yield(yield T.create({message:((e=a.messages)==null?void 0:e[0])||a.message||"Failed to reject request",duration:3e3,color:"danger"})).present()}})}return ye(()=>{P()}),(o,e)=>(d(),S(t(Te),null,{default:l(()=>[s(t(z),null,{default:l(()=>[s(t(A),null,{default:l(()=>[s(t(B),{slot:"start"},{default:l(()=>[s(t(be),{"default-href":"/smart-pro/home",text:""})]),_:1}),s(t(W),null,{default:l(()=>[...e[14]||(e[14]=[r("Date Requests",-1)])]),_:1}),s(t(B),{slot:"end"},{default:l(()=>[s(t(x),{onClick:Z},{default:l(()=>[s(t(j),{icon:t(ke)},null,8,["icon"])]),_:1})]),_:1})]),_:1}),s(t(A),null,{default:l(()=>[s(t(xe),{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=a=>b.value=a),scrollable:""},{default:l(()=>[s(t(F),{value:"all"},{default:l(()=>[s(t(k),null,{default:l(()=>[...e[15]||(e[15]=[r("All",-1)])]),_:1})]),_:1}),s(t(F),{value:"pending"},{default:l(()=>[s(t(k),null,{default:l(()=>[...e[16]||(e[16]=[r("Pending",-1)])]),_:1})]),_:1}),s(t(F),{value:"approved"},{default:l(()=>[s(t(k),null,{default:l(()=>[...e[17]||(e[17]=[r("Approved",-1)])]),_:1})]),_:1}),s(t(F),{value:"rejected"},{default:l(()=>[s(t(k),null,{default:l(()=>[...e[18]||(e[18]=[r("Rejected",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(t(G),{fullscreen:!0},{fixed:l(()=>[s(t(Ie),{onIonRefresh:ie},{default:l(()=>[s(t(Ue))]),_:1})]),default:l(()=>[w.value?(d(),i("div",Me,[(d(),i(H,null,L(3,a=>u("div",{key:a,class:"app-card mb-4 p-4"},[...e[19]||(e[19]=[u("div",{class:"skeleton h-5 w-3/4 mb-2"},null,-1),u("div",{class:"skeleton h-4 w-1/2 mb-2"},null,-1),u("div",{class:"skeleton h-3 w-full"},null,-1)])])),64))])):Q.value.length===0?(d(),i("div",Se,[s(t(j),{icon:t(ae),class:"empty-state-icon"},null,8,["icon"]),e[21]||(e[21]=u("div",{class:"empty-state-title"},"No date requests",-1)),u("div",Ae,f(b.value==="pending"?"No pending requests":b.value==="approved"?"No approved requests":b.value==="rejected"?"No rejected requests":"Submit a date request to update your project dates"),1),s(t(x),{class:"mt-4",onClick:Z},{default:l(()=>[...e[20]||(e[20]=[r(" New Request ",-1)])]),_:1})])):(d(),i("div",Be,[(d(!0),i(H,null,L(Q.value,a=>(d(),i("div",{key:a.name,class:"app-card mb-4 p-4"},[u("div",Fe,[u("div",null,[u("span",Ne,f(a.request_type),1),u("h3",Ye,f(a.project_title||a.project||"General Request"),1)]),u("span",{class:ee(["status-badge",me(a.status)])},f(a.status),3)]),u("div",Ee,[s(t(j),{icon:t(ae),class:"mr-1"},null,8,["icon"]),r(" "+f(h(a.from_date))+" - "+f(h(a.to_date))+" ",1),u("span",$e,"("+f(a.total_days)+" days)",1)]),a.reason?(d(),i("div",He,f(E(a.reason)),1)):c("",!0),a.project_scope?(d(),i("div",Le,[u("div",{class:"flex items-center justify-between p-2 cursor-pointer",onClick:p=>ue(a.name)},[e[22]||(e[22]=u("div",{class:"text-xs text-blue-600 font-semibold"},"Project Scope:",-1)),s(t(j),{icon:M.value[a.name]?t(je):t(we),class:"text-blue-600"},null,8,["icon"])],8,ze),u("div",{class:ee(["scope-content px-2 pb-2",{expanded:M.value[a.name]}])},[u("div",{class:"text-gray-700 whitespace-pre-wrap",innerHTML:a.project_scope},null,8,We)],2)])):c("",!0),a.approver?(d(),i("div",Ge,[s(t(j),{icon:t(De),class:"mr-1"},null,8,["icon"]),r(" Approver: "+f(a.approver),1)])):c("",!0),a.comments&&a.status!=="Pending Approval"?(d(),i("div",Ke,[e[23]||(e[23]=u("span",{class:"font-medium"},"Comments:",-1)),r(" "+f(E(a.comments)),1)])):c("",!0),a.auto_create_tasks&&a.request_type==="Project Date Update"?(d(),i("div",Qe,[s(t(j),{icon:t(Re),class:"mr-1"},null,8,["icon"]),e[24]||(e[24]=r(" Tasks will be auto-created on approval ",-1))])):c("",!0),a.status==="Pending Approval"?(d(),i("div",Je,[u("div",Xe,[s(t(x),{size:"small",fill:"outline",color:"primary",onClick:p=>pe(a)},{default:l(()=>[s(t(j),{icon:t(Ve),slot:"start"},null,8,["icon"]),e[25]||(e[25]=r(" Edit Dates ",-1))]),_:1},8,["onClick"]),s(t(x),{size:"small",fill:"solid",color:"success",onClick:p=>ve(a)},{default:l(()=>[s(t(j),{icon:t(qe),slot:"start"},null,8,["icon"]),e[26]||(e[26]=r(" Approve ",-1))]),_:1},8,["onClick"]),s(t(x),{size:"small",fill:"outline",color:"danger",onClick:p=>ce(a)},{default:l(()=>[s(t(j),{icon:t(Ce),slot:"start"},null,8,["icon"]),e[27]||(e[27]=r(" Reject ",-1))]),_:1},8,["onClick"])])])):c("",!0)]))),128))]))]),_:1}),s(t(se),{"is-open":D.value,onDidDismiss:e[5]||(e[5]=a=>D.value=!1)},{default:l(()=>[s(t(z),null,{default:l(()=>[s(t(A),null,{default:l(()=>[s(t(W),null,{default:l(()=>[...e[28]||(e[28]=[r("Edit Dates",-1)])]),_:1}),s(t(B),{slot:"end"},{default:l(()=>[s(t(x),{onClick:e[1]||(e[1]=a=>D.value=!1)},{default:l(()=>[...e[29]||(e[29]=[r("Close",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),s(t(G),{class:"ion-padding"},{default:l(()=>[u("form",{onSubmit:te(fe,["prevent"])},[u("div",Ze,[s(t(k),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[30]||(e[30]=[r(" From Date * ",-1)])]),_:1}),s(t(N),{modelValue:m.value.from_date,"onUpdate:modelValue":e[2]||(e[2]=a=>m.value.from_date=a),type:"date",fill:"outline",required:""},null,8,["modelValue"])]),u("div",he,[s(t(k),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[31]||(e[31]=[r(" To Date * ",-1)])]),_:1}),s(t(N),{modelValue:m.value.to_date,"onUpdate:modelValue":e[3]||(e[3]=a=>m.value.to_date=a),type:"date",fill:"outline",required:""},null,8,["modelValue"])]),X.value>0?(d(),i("div",et,[u("span",tt,"Total: "+f(X.value)+" days",1)])):c("",!0),u("div",at,[s(t(k),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[32]||(e[32]=[r(" Reason / Work Description ",-1)])]),_:1}),s(t(le),{modelValue:m.value.reason,"onUpdate:modelValue":e[4]||(e[4]=a=>m.value.reason=a),placeholder:"Update reason if needed...",fill:"outline",rows:4},null,8,["modelValue"])]),s(t(x),{expand:"block",type:"submit",disabled:q.value,class:"mt-6"},{default:l(()=>[q.value?(d(),S(t(oe),{key:0,name:"crescent",class:"mr-2"})):c("",!0),r(" "+f(q.value?"Updating...":"Update Request"),1)]),_:1},8,["disabled"]),v.value?(d(),i("div",st,f(v.value),1)):c("",!0)],32)]),_:1})]),_:1},8,["is-open"]),s(t(se),{"is-open":R.value,onDidDismiss:e[13]||(e[13]=a=>R.value=!1)},{default:l(()=>[s(t(z),null,{default:l(()=>[s(t(A),null,{default:l(()=>[s(t(W),null,{default:l(()=>[...e[33]||(e[33]=[r("New Date Request",-1)])]),_:1}),s(t(B),{slot:"end"},{default:l(()=>[s(t(x),{onClick:e[6]||(e[6]=a=>R.value=!1)},{default:l(()=>[...e[34]||(e[34]=[r("Close",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),s(t(G),{class:"ion-padding"},{default:l(()=>[u("form",{onSubmit:te(de,["prevent"])},[u("div",lt,[s(t(k),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[35]||(e[35]=[r(" Request Type * ",-1)])]),_:1}),s(t(re),{modelValue:n.value.request_type,"onUpdate:modelValue":e[7]||(e[7]=a=>n.value.request_type=a),interface:"action-sheet",fill:"outline"},{default:l(()=>[s(t(I),{value:"Project Date Update"},{default:l(()=>[...e[36]||(e[36]=[r("Project Date Update",-1)])]),_:1}),s(t(I),{value:"Leave"},{default:l(()=>[...e[37]||(e[37]=[r("Leave",-1)])]),_:1}),s(t(I),{value:"Time Off"},{default:l(()=>[...e[38]||(e[38]=[r("Time Off",-1)])]),_:1}),s(t(I),{value:"Work From Home"},{default:l(()=>[...e[39]||(e[39]=[r("Work From Home",-1)])]),_:1}),s(t(I),{value:"Overtime"},{default:l(()=>[...e[40]||(e[40]=[r("Overtime",-1)])]),_:1}),s(t(I),{value:"Other"},{default:l(()=>[...e[41]||(e[41]=[r("Other",-1)])]),_:1})]),_:1},8,["modelValue"])]),n.value.request_type==="Project Date Update"?(d(),i("div",ot,[s(t(k),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[42]||(e[42]=[r(" Project * ",-1)])]),_:1}),s(t(re),{modelValue:n.value.project,"onUpdate:modelValue":e[8]||(e[8]=a=>n.value.project=a),placeholder:"Select a project",interface:"action-sheet",fill:"outline"},{default:l(()=>[(d(!0),i(H,null,L(Y.value,a=>(d(),S(t(I),{key:a.project,value:a.project},{default:l(()=>[r(f(a.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),Y.value.length===0?(d(),i("div",rt," No projects assigned to you yet. ")):c("",!0)])):c("",!0),u("div",nt,[s(t(k),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[43]||(e[43]=[r(" From Date * ",-1)])]),_:1}),s(t(N),{modelValue:n.value.from_date,"onUpdate:modelValue":e[9]||(e[9]=a=>n.value.from_date=a),type:"date",fill:"outline",required:""},null,8,["modelValue"])]),u("div",ut,[s(t(k),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[44]||(e[44]=[r(" To Date * ",-1)])]),_:1}),s(t(N),{modelValue:n.value.to_date,"onUpdate:modelValue":e[10]||(e[10]=a=>n.value.to_date=a),type:"date",fill:"outline",required:""},null,8,["modelValue"])]),J.value>0?(d(),i("div",dt,[u("span",it,"Total: "+f(J.value)+" days",1)])):c("",!0),u("div",mt,[s(t(k),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[45]||(e[45]=[r(" Reason / Work Description * ",-1)])]),_:1}),s(t(le),{modelValue:n.value.reason,"onUpdate:modelValue":e[11]||(e[11]=a=>n.value.reason=a),placeholder:"Describe the reason for this request or work plan...",fill:"outline",rows:4,required:""},null,8,["modelValue"])]),n.value.request_type==="Project Date Update"?(d(),i("div",pt,[s(t(Pe),{lines:"none"},{default:l(()=>[s(t(Oe),{modelValue:n.value.auto_create_tasks,"onUpdate:modelValue":e[12]||(e[12]=a=>n.value.auto_create_tasks=a),slot:"start"},null,8,["modelValue"]),s(t(k),null,{default:l(()=>[...e[46]||(e[46]=[r("Auto-create tasks on approval",-1)])]),_:1})]),_:1}),e[47]||(e[47]=u("div",{class:"text-xs text-gray-500 ml-8"}," Tasks will be automatically created and assigned to you when approved ",-1))])):c("",!0),s(t(x),{expand:"block",type:"submit",disabled:V.value,class:"mt-6"},{default:l(()=>[V.value?(d(),S(t(oe),{key:0,name:"crescent",class:"mr-2"})):c("",!0),r(" "+f(V.value?"Submitting...":"Submit Request"),1)]),_:1},8,["disabled"]),g.value?(d(),i("div",ft,f(g.value),1)):c("",!0)],32)]),_:1})]),_:1},8,["is-open"])]),_:1}))}},gt=_e(vt,[["__scopeId","data-v-124a18a2"]]);export{gt as default};
//# sourceMappingURL=DateRequests-uQau54cF.js.map
