var P=(M,g,x)=>new Promise((R,_)=>{var b=v=>{try{c(x.next(v))}catch(r){_(r)}},i=v=>{try{c(x.throw(v))}catch(r){_(r)}},c=v=>v.done?R(v.value):Promise.resolve(v.value).then(b,i);c((x=x.apply(M,g)).next())});import{o as K,j as X,k as Z,l as tt,m as et,n as C,d as j,s as st,q as ot,r as at,u as lt,v as nt,w as it,x as rt,y as dt,z as ct,i as ut}from"./index-C-hcTcxK.js";import{f as pt,r as f,L as Y,a as vt,A as mt,t as o,z as I,i as gt,M as ft,l as u,q as m,n as d,v as H,y as l,k as p,N as z,x as t,F as B,O as V,P as A,Q as xt}from"./frappe-ui-5f3Xtay5.js";import{u as _t}from"./usePermissions-DkJGg_er.js";const yt={key:0,class:"notification-badge"},bt={class:"p-4"},kt={class:"grid grid-cols-2 gap-4 mb-6"},ht={class:"app-card p-4"},jt={class:"text-3xl font-bold text-primary-500"},Tt={class:"app-card p-4"},wt={class:"text-3xl font-bold text-orange-500"},Pt={class:"app-card mb-6"},Ct={class:"app-card-header flex justify-between items-center"},It={key:0,class:"p-4"},Rt={key:1,class:"empty-state py-8"},Dt={key:2},Lt=["onClick"],Ot={class:"flex-1"},Ht={class:"font-medium text-gray-800"},At={class:"text-sm text-gray-500"},Mt={class:"flex items-center justify-between"},Nt={class:"flex items-center"},St={class:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center mr-3"},$t={key:0,class:"app-card mb-6"},Et={class:"app-card-header flex items-center"},Yt={class:"p-4"},zt={class:"mb-4"},Bt={class:"grid grid-cols-2 gap-2"},Vt={class:"bg-green-50 rounded-lg p-3 text-center"},Ft={class:"text-xl font-bold text-green-600"},Wt={class:"bg-blue-50 rounded-lg p-3 text-center"},qt={class:"text-xl font-bold text-blue-600"},Ut={class:"bg-yellow-50 rounded-lg p-3 text-center"},Qt={class:"text-xl font-bold text-yellow-600"},Gt={class:"bg-gray-50 rounded-lg p-3 text-center"},Jt={class:"text-xl font-bold text-gray-600"},Kt={class:"mb-4"},Xt={class:"grid grid-cols-3 gap-2"},Zt={class:"bg-blue-50 rounded-lg p-3 text-center"},te={class:"text-xl font-bold text-blue-600"},ee={class:"bg-orange-50 rounded-lg p-3 text-center"},se={class:"text-xl font-bold text-orange-600"},oe={class:"bg-green-50 rounded-lg p-3 text-center"},ae={class:"text-xl font-bold text-green-600"},le={class:"space-y-2"},ne={class:"flex justify-between items-center py-2 border-b border-gray-100"},ie={class:"font-semibold text-gray-800"},re={class:"flex justify-between items-center py-2 border-b border-gray-100"},de={class:"font-semibold text-gray-800"},ce={class:"flex justify-between items-center py-2 border-b border-gray-100"},ue={class:"font-semibold text-green-600"},pe={class:"flex justify-between items-center py-2"},ve={class:"app-card"},me={class:"app-card-header flex justify-between items-center"},ge={key:0,class:"p-4"},fe={key:1,class:"empty-state py-8"},xe={key:2},_e=["onClick"],ye={class:"flex-1"},be={class:"font-medium text-gray-800"},ke={class:"text-sm text-gray-500"},he={class:"progress-bar mt-2"},je=3e4,Te={__name:"Home",setup(M){const g=ft(),x=gt("$dayjs"),{fetchPermissions:R,hasFullAccess:_}=_t(),b=f(!0),i=f([]),c=f([]),v=f({projects:0,tasks:0}),r=f({totalProjects:0,activeProjects:0,planningProjects:0,onHoldProjects:0,completedProjects:0,totalTasks:0,openTasks:0,workingTasks:0,completedTasks:0,overdueTasks:0,completionRate:0}),h=f(0),N=f("Smart Pro"),y=f(!1),T=Y({url:"smart_pro.smart_pro.api.projects.get_user_projects",auto:!1}),w=Y({url:"smart_pro.smart_pro.api.projects.get_user_tasks",auto:!1});let D=0;function L(a=!1){return P(this,null,function*(){const e=Date.now();if(!(!a&&D&&e-D<je&&i.value.length>0)){b.value=i.value.length===0;try{if(yield R(),console.log("Home.vue - hasFullAccess:",_.value),_.value)try{const[s,k]=yield Promise.all([I("smart_pro.smart_pro.api.projects.get_all_projects"),I("smart_pro.smart_pro.api.projects.get_all_tasks")]);i.value=s||[],c.value=k||[],console.log("Home.vue - Loaded all projects:",i.value.length)}catch(s){console.error("Error loading all data (falling back to user data):",s),yield Promise.all([T.fetch(),w.fetch()]),i.value=T.data||[],c.value=w.data||[]}else yield Promise.all([T.fetch(),w.fetch()]),i.value=T.data||[],c.value=w.data||[],console.log("Home.vue - Loaded user projects:",i.value.length);if(v.value={projects:i.value.filter(s=>s.status==="Active").length,tasks:c.value.filter(s=>s.status!=="Completed").length},_.value){const s=x().format("YYYY-MM-DD"),k=c.value.filter(n=>n.status==="Completed").length,O=c.value.length;r.value={totalProjects:i.value.length,activeProjects:i.value.filter(n=>n.status==="Active").length,planningProjects:i.value.filter(n=>n.status==="Planning").length,onHoldProjects:i.value.filter(n=>n.status==="On Hold").length,completedProjects:i.value.filter(n=>n.status==="Completed").length,totalTasks:O,openTasks:c.value.filter(n=>n.status==="Open").length,workingTasks:c.value.filter(n=>n.status==="Working"||n.status==="Pending Review").length,completedTasks:k,overdueTasks:c.value.filter(n=>n.due_date&&n.due_date<s&&n.status!=="Completed").length,completionRate:O>0?Math.round(k/O*100):0}}D=e}catch(s){console.error("Error loading data:",s)}finally{b.value=!1}}})}function F(a){L(!0).finally(()=>{a.target.complete()})}function S(a){return a?x(a).format("MMM D, YYYY"):"-"}function $(a){return{Active:"active",Planning:"planning",Completed:"completed","On Hold":"on-hold",Cancelled:"cancelled",Open:"planning",Working:"on-hold"}[a]||""}function W(a){g.push(`/smart-pro/project/${encodeURIComponent(a)}`)}function q(a){g.push(`/smart-pro/task/${encodeURIComponent(a)}`)}function U(){g.push("/smart-pro/notifications")}function E(){return P(this,null,function*(){try{const a=yield I("frappe.client.get_count",{doctype:"Notification Log",filters:{for_user:["like","%"],read:0}});h.value=a||0}catch(a){console.error("Error loading notification count:",a),h.value=0}})}function Q(){return P(this,null,function*(){try{const a=yield I("smart_pro.smart_pro.api.projects.get_app_settings");a&&a.app_name&&(N.value=a.app_name)}catch(a){console.error("Error loading app settings:",a)}})}function G(){const a=localStorage.getItem("smart-pro-theme");if(a==="dark")y.value=!0,document.body.classList.add("dark"),document.body.classList.remove("light");else if(a==="light")y.value=!1,document.body.classList.add("light"),document.body.classList.remove("dark");else{const e=window.matchMedia("(prefers-color-scheme: dark)").matches;y.value=e}}function J(){y.value=!y.value,y.value?(document.body.classList.add("dark"),document.body.classList.remove("light"),localStorage.setItem("smart-pro-theme","dark")):(document.body.classList.remove("dark"),document.body.classList.add("light"),localStorage.setItem("smart-pro-theme","light"))}return vt(()=>{G(),Q(),L(),E()}),K(()=>{L(),E()}),(a,e)=>(u(),mt(o(ut),null,{default:m(()=>[d(o(X),null,{default:m(()=>[d(o(Z),null,{default:m(()=>[d(o(tt),null,{default:m(()=>[H(l(N.value),1)]),_:1}),d(o(et),{slot:"end"},{default:m(()=>[d(o(C),{onClick:J,class:"theme-btn"},{default:m(()=>[d(o(j),{icon:y.value?o(st):o(ot)},null,8,["icon"])]),_:1}),d(o(C),{onClick:U,class:"notification-btn"},{default:m(()=>[d(o(j),{icon:o(at)},null,8,["icon"]),h.value>0?(u(),p("span",yt,l(h.value>9?"9+":h.value),1)):z("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),d(o(lt),{fullscreen:!0},{default:m(()=>[d(o(nt),{slot:"fixed",onIonRefresh:F},{default:m(()=>[d(o(it))]),_:1}),t("div",bt,[e[29]||(e[29]=t("div",{class:"mb-6"},[t("h1",{class:"text-2xl font-bold text-gray-800"}," Welcome back! "),t("p",{class:"text-gray-500"}," Here's your overview ")],-1)),t("div",kt,[t("div",ht,[t("div",jt,l(v.value.projects),1),e[3]||(e[3]=t("div",{class:"text-sm text-gray-500"}," Active Projects ",-1))]),t("div",Tt,[t("div",wt,l(v.value.tasks),1),e[4]||(e[4]=t("div",{class:"text-sm text-gray-500"}," Pending Tasks ",-1))])]),t("div",Pt,[t("div",Ct,[e[6]||(e[6]=t("span",null,"Recent Projects",-1)),d(o(C),{fill:"clear",size:"small",onClick:e[0]||(e[0]=s=>o(g).push("/smart-pro/projects"))},{default:m(()=>[...e[5]||(e[5]=[H(" See All ",-1)])]),_:1})]),b.value?(u(),p("div",It,[...e[7]||(e[7]=[t("div",{class:"skeleton h-16 mb-3"},null,-1),t("div",{class:"skeleton h-16 mb-3"},null,-1)])])):i.value.length===0?(u(),p("div",Rt,[...e[8]||(e[8]=[t("div",{class:"empty-state-title"}," No projects yet ",-1),t("div",{class:"empty-state-description"}," Create your first project to get started ",-1)])])):(u(),p("div",Dt,[(u(!0),p(B,null,V(i.value.slice(0,3),s=>(u(),p("div",{key:s.name,class:"app-list-item",onClick:k=>W(s.name)},[t("div",Ot,[t("div",Ht,l(s.title||s.name),1),t("div",At,l(S(s.end_date)),1)]),t("span",{class:A(["status-badge",$(s.status)])},l(s.status),3)],8,Lt))),128))]))]),t("div",{class:"app-card mb-6 p-4 cursor-pointer",onClick:e[1]||(e[1]=s=>o(g).push("/smart-pro/connections"))},[t("div",Mt,[t("div",Nt,[t("div",St,[d(o(j),{icon:o(rt),class:"text-xl text-purple-600"},null,8,["icon"])]),e[9]||(e[9]=t("div",null,[t("div",{class:"font-semibold text-gray-800"},"Connections Dashboard"),t("div",{class:"text-sm text-gray-500"},"View all doctypes & relationships")],-1))]),d(o(j),{icon:o(dt),class:"text-gray-400"},null,8,["icon"])])]),o(_)?(u(),p("div",$t,[t("div",Et,[d(o(j),{icon:o(ct),class:"text-lg text-blue-600 mr-2"},null,8,["icon"]),e[10]||(e[10]=t("span",null,"Insights Dashboard",-1))]),t("div",Yt,[t("div",zt,[e[15]||(e[15]=t("div",{class:"text-sm font-medium text-gray-700 mb-2"},"Project Status",-1)),t("div",Bt,[t("div",Vt,[t("div",Ft,l(r.value.activeProjects),1),e[11]||(e[11]=t("div",{class:"text-xs text-green-700"},"Active",-1))]),t("div",Wt,[t("div",qt,l(r.value.planningProjects),1),e[12]||(e[12]=t("div",{class:"text-xs text-blue-700"},"Planning",-1))]),t("div",Ut,[t("div",Qt,l(r.value.onHoldProjects),1),e[13]||(e[13]=t("div",{class:"text-xs text-yellow-700"},"On Hold",-1))]),t("div",Gt,[t("div",Jt,l(r.value.completedProjects),1),e[14]||(e[14]=t("div",{class:"text-xs text-gray-700"},"Completed",-1))])])]),t("div",Kt,[e[19]||(e[19]=t("div",{class:"text-sm font-medium text-gray-700 mb-2"},"Task Overview",-1)),t("div",Xt,[t("div",Zt,[t("div",te,l(r.value.openTasks),1),e[16]||(e[16]=t("div",{class:"text-xs text-blue-700"},"Open",-1))]),t("div",ee,[t("div",se,l(r.value.workingTasks),1),e[17]||(e[17]=t("div",{class:"text-xs text-orange-700"},"Working",-1))]),t("div",oe,[t("div",ae,l(r.value.completedTasks),1),e[18]||(e[18]=t("div",{class:"text-xs text-green-700"},"Done",-1))])])]),t("div",null,[e[24]||(e[24]=t("div",{class:"text-sm font-medium text-gray-700 mb-2"},"Summary",-1)),t("div",le,[t("div",ne,[e[20]||(e[20]=t("span",{class:"text-sm text-gray-600"},"Total Projects",-1)),t("span",ie,l(r.value.totalProjects),1)]),t("div",re,[e[21]||(e[21]=t("span",{class:"text-sm text-gray-600"},"Total Tasks",-1)),t("span",de,l(r.value.totalTasks),1)]),t("div",ce,[e[22]||(e[22]=t("span",{class:"text-sm text-gray-600"},"Completion Rate",-1)),t("span",ue,l(r.value.completionRate)+"%",1)]),t("div",pe,[e[23]||(e[23]=t("span",{class:"text-sm text-gray-600"},"Overdue Tasks",-1)),t("span",{class:A(["font-semibold",r.value.overdueTasks>0?"text-red-600":"text-gray-800"])},l(r.value.overdueTasks),3)])])])])])):z("",!0),t("div",ve,[t("div",me,[e[26]||(e[26]=t("span",null,"My Tasks",-1)),d(o(C),{fill:"clear",size:"small",onClick:e[2]||(e[2]=s=>o(g).push("/smart-pro/tasks"))},{default:m(()=>[...e[25]||(e[25]=[H(" See All ",-1)])]),_:1})]),b.value?(u(),p("div",ge,[...e[27]||(e[27]=[t("div",{class:"skeleton h-16 mb-3"},null,-1),t("div",{class:"skeleton h-16 mb-3"},null,-1)])])):c.value.length===0?(u(),p("div",fe,[...e[28]||(e[28]=[t("div",{class:"empty-state-title"}," No tasks assigned ",-1),t("div",{class:"empty-state-description"}," Tasks assigned to you will appear here ",-1)])])):(u(),p("div",xe,[(u(!0),p(B,null,V(c.value.slice(0,3),s=>(u(),p("div",{key:s.name,class:"app-list-item",onClick:k=>q(s.name)},[t("div",ye,[t("div",be,l(s.title||s.name),1),t("div",ke," Due: "+l(S(s.due_date)),1),t("div",he,[t("div",{class:"progress-bar-fill",style:xt({width:(s.progress||0)+"%"})},null,4)])]),t("span",{class:A(["status-badge",$(s.status)])},l(s.status),3)],8,_e))),128))]))])])]),_:1})]),_:1}))}},Re=pt(Te,[["__scopeId","data-v-004fca5a"]]);export{Re as default};
//# sourceMappingURL=Home-Bj1W530U.js.map
