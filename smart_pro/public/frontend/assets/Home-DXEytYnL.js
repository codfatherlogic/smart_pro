var b=(A,v,_)=>new Promise((I,h)=>{var y=r=>{try{u(_.next(r))}catch(m){h(m)}},n=r=>{try{u(_.throw(r))}catch(m){h(m)}},u=r=>r.done?I(r.value):Promise.resolve(r.value).then(y,n);u((_=_.apply(A,v)).next())});import{o as U,j as Q,k as G,l as J,m as K,n as C,d as j,s as X,q as Z,r as tt,u as et,v as st,w as at,x as ot,y as lt,i as nt}from"./index-BdT8h_5n.js";import{f as it,r as g,L as S,a as rt,A as ct,t as o,z as w,M as dt,i as ut,l as i,q as c,n as l,v as N,y as p,k as d,N as pt,x as t,F as $,O as E,P as O,Q as mt}from"./frappe-ui-5f3Xtay5.js";import{u as vt}from"./usePermissions-DkJGg_er.js";const ft={key:0,class:"notification-badge"},gt={class:"p-4"},_t={class:"grid grid-cols-2 gap-4 mb-6"},yt={class:"app-card p-4"},ht={class:"text-3xl font-bold text-primary-500"},kt={class:"app-card p-4"},xt={class:"text-3xl font-bold text-orange-500"},bt={class:"app-card mb-6"},Ct={class:"app-card-header flex justify-between items-center"},jt={key:0,class:"p-4"},wt={key:1,class:"empty-state py-8"},It={key:2},Lt=["onClick"],Tt={class:"flex-1"},Pt={class:"font-medium text-gray-800"},Nt={class:"text-sm text-gray-500"},At={class:"flex items-center justify-between"},Dt={class:"flex items-center"},Rt={class:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center mr-3"},Mt={class:"app-card"},Ht={class:"app-card-header flex justify-between items-center"},St={key:0,class:"p-4"},$t={key:1,class:"empty-state py-8"},Et={key:2},Ot=["onClick"],Bt={class:"flex-1"},Vt={class:"font-medium text-gray-800"},zt={class:"text-sm text-gray-500"},Ft={class:"progress-bar mt-2"},Yt=3e4,Wt={__name:"Home",setup(A){const v=dt(),_=ut("$dayjs"),{fetchPermissions:I,hasFullAccess:h}=vt(),y=g(!0),n=g([]),u=g([]),r=g({projects:0,tasks:0}),m=g(0),D=g("Smart Pro"),f=g(!1),k=S({url:"smart_pro.smart_pro.api.projects.get_user_projects",auto:!1}),x=S({url:"smart_pro.smart_pro.api.projects.get_user_tasks",auto:!1});let L=0;function T(a=!1){return b(this,null,function*(){const e=Date.now();if(!(!a&&L&&e-L<Yt&&n.value.length>0)){y.value=n.value.length===0;try{if(yield I(),console.log("Home.vue - hasFullAccess:",h.value),h.value)try{const[s,P]=yield Promise.all([w("smart_pro.smart_pro.api.projects.get_all_projects"),w("smart_pro.smart_pro.api.projects.get_all_tasks")]);n.value=s||[],u.value=P||[],console.log("Home.vue - Loaded all projects:",n.value.length)}catch(s){console.error("Error loading all data (falling back to user data):",s),yield Promise.all([k.fetch(),x.fetch()]),n.value=k.data||[],u.value=x.data||[]}else yield Promise.all([k.fetch(),x.fetch()]),n.value=k.data||[],u.value=x.data||[],console.log("Home.vue - Loaded user projects:",n.value.length);r.value={projects:n.value.filter(s=>s.status==="Active").length,tasks:u.value.filter(s=>s.status!=="Completed").length},L=e}catch(s){console.error("Error loading data:",s)}finally{y.value=!1}}})}function B(a){T(!0).finally(()=>{a.target.complete()})}function R(a){return a?_(a).format("MMM D, YYYY"):"-"}function M(a){return{Active:"active",Planning:"planning",Completed:"completed","On Hold":"on-hold",Cancelled:"cancelled",Open:"planning",Working:"on-hold"}[a]||""}function V(a){v.push(`/smart-pro/project/${encodeURIComponent(a)}`)}function z(a){v.push(`/smart-pro/task/${encodeURIComponent(a)}`)}function F(){v.push("/smart-pro/notifications")}function H(){return b(this,null,function*(){try{const a=yield w("frappe.client.get_count",{doctype:"Notification Log",filters:{for_user:["like","%"],read:0}});m.value=a||0}catch(a){console.error("Error loading notification count:",a),m.value=0}})}function Y(){return b(this,null,function*(){try{const a=yield w("smart_pro.smart_pro.api.projects.get_app_settings");a&&a.app_name&&(D.value=a.app_name)}catch(a){console.error("Error loading app settings:",a)}})}function W(){const a=localStorage.getItem("smart-pro-theme");if(a==="dark")f.value=!0,document.body.classList.add("dark"),document.body.classList.remove("light");else if(a==="light")f.value=!1,document.body.classList.add("light"),document.body.classList.remove("dark");else{const e=window.matchMedia("(prefers-color-scheme: dark)").matches;f.value=e}}function q(){f.value=!f.value,f.value?(document.body.classList.add("dark"),document.body.classList.remove("light"),localStorage.setItem("smart-pro-theme","dark")):(document.body.classList.remove("dark"),document.body.classList.add("light"),localStorage.setItem("smart-pro-theme","light"))}return rt(()=>{W(),Y(),T(),H()}),U(()=>{T(),H()}),(a,e)=>(i(),ct(o(nt),null,{default:c(()=>[l(o(Q),null,{default:c(()=>[l(o(G),null,{default:c(()=>[l(o(J),null,{default:c(()=>[N(p(D.value),1)]),_:1}),l(o(K),{slot:"end"},{default:c(()=>[l(o(C),{onClick:q,class:"theme-btn"},{default:c(()=>[l(o(j),{icon:f.value?o(X):o(Z)},null,8,["icon"])]),_:1}),l(o(C),{onClick:F,class:"notification-btn"},{default:c(()=>[l(o(j),{icon:o(tt)},null,8,["icon"]),m.value>0?(i(),d("span",ft,p(m.value>9?"9+":m.value),1)):pt("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),l(o(et),{fullscreen:!0},{default:c(()=>[l(o(st),{slot:"fixed",onIonRefresh:B},{default:c(()=>[l(o(at))]),_:1}),t("div",gt,[e[14]||(e[14]=t("div",{class:"mb-6"},[t("h1",{class:"text-2xl font-bold text-gray-800"}," Welcome back! "),t("p",{class:"text-gray-500"}," Here's your overview ")],-1)),t("div",_t,[t("div",yt,[t("div",ht,p(r.value.projects),1),e[3]||(e[3]=t("div",{class:"text-sm text-gray-500"}," Active Projects ",-1))]),t("div",kt,[t("div",xt,p(r.value.tasks),1),e[4]||(e[4]=t("div",{class:"text-sm text-gray-500"}," Pending Tasks ",-1))])]),t("div",bt,[t("div",Ct,[e[6]||(e[6]=t("span",null,"Recent Projects",-1)),l(o(C),{fill:"clear",size:"small",onClick:e[0]||(e[0]=s=>o(v).push("/smart-pro/projects"))},{default:c(()=>[...e[5]||(e[5]=[N(" See All ",-1)])]),_:1})]),y.value?(i(),d("div",jt,[...e[7]||(e[7]=[t("div",{class:"skeleton h-16 mb-3"},null,-1),t("div",{class:"skeleton h-16 mb-3"},null,-1)])])):n.value.length===0?(i(),d("div",wt,[...e[8]||(e[8]=[t("div",{class:"empty-state-title"}," No projects yet ",-1),t("div",{class:"empty-state-description"}," Create your first project to get started ",-1)])])):(i(),d("div",It,[(i(!0),d($,null,E(n.value.slice(0,3),s=>(i(),d("div",{key:s.name,class:"app-list-item",onClick:P=>V(s.name)},[t("div",Tt,[t("div",Pt,p(s.title||s.name),1),t("div",Nt,p(R(s.end_date)),1)]),t("span",{class:O(["status-badge",M(s.status)])},p(s.status),3)],8,Lt))),128))]))]),t("div",{class:"app-card mb-6 p-4 cursor-pointer",onClick:e[1]||(e[1]=s=>o(v).push("/smart-pro/connections"))},[t("div",At,[t("div",Dt,[t("div",Rt,[l(o(j),{icon:o(ot),class:"text-xl text-purple-600"},null,8,["icon"])]),e[9]||(e[9]=t("div",null,[t("div",{class:"font-semibold text-gray-800"},"Connections Dashboard"),t("div",{class:"text-sm text-gray-500"},"View all doctypes & relationships")],-1))]),l(o(j),{icon:o(lt),class:"text-gray-400"},null,8,["icon"])])]),t("div",Mt,[t("div",Ht,[e[11]||(e[11]=t("span",null,"My Tasks",-1)),l(o(C),{fill:"clear",size:"small",onClick:e[2]||(e[2]=s=>o(v).push("/smart-pro/tasks"))},{default:c(()=>[...e[10]||(e[10]=[N(" See All ",-1)])]),_:1})]),y.value?(i(),d("div",St,[...e[12]||(e[12]=[t("div",{class:"skeleton h-16 mb-3"},null,-1),t("div",{class:"skeleton h-16 mb-3"},null,-1)])])):u.value.length===0?(i(),d("div",$t,[...e[13]||(e[13]=[t("div",{class:"empty-state-title"}," No tasks assigned ",-1),t("div",{class:"empty-state-description"}," Tasks assigned to you will appear here ",-1)])])):(i(),d("div",Et,[(i(!0),d($,null,E(u.value.slice(0,3),s=>(i(),d("div",{key:s.name,class:"app-list-item",onClick:P=>z(s.name)},[t("div",Bt,[t("div",Vt,p(s.title||s.name),1),t("div",zt," Due: "+p(R(s.due_date)),1),t("div",Ft,[t("div",{class:"progress-bar-fill",style:mt({width:(s.progress||0)+"%"})},null,4)])]),t("span",{class:O(["status-badge",M(s.status)])},p(s.status),3)],8,Ot))),128))]))])])]),_:1})]),_:1}))}},Jt=it(Wt,[["__scopeId","data-v-93ebf7ad"]]);export{Jt as default};
//# sourceMappingURL=Home-DXEytYnL.js.map
