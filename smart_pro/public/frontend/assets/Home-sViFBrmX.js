var P=(M,g,_)=>new Promise((R,y)=>{var h=v=>{try{c(_.next(v))}catch(r){y(r)}},i=v=>{try{c(_.throw(v))}catch(r){y(r)}},c=v=>v.done?R(v.value):Promise.resolve(v.value).then(h,i);c((_=_.apply(M,g)).next())});import{o as K,j as X,k as Z,l as tt,m as st,n as C,d as j,s as et,q as at,r as ot,u as lt,v as nt,w as it,x as rt,y as dt,z as ct,i as ut}from"./index-CfzjP1Tk.js";import{f as pt,r as f,L as Y,a as vt,A as mt,t as a,z as I,i as gt,M as ft,l as u,q as m,n as d,v as H,y as l,k as p,N as z,x as t,F as B,O as V,P as A,Q as _t}from"./frappe-ui-5f3Xtay5.js";import{u as yt}from"./usePermissions-DkJGg_er.js";const xt={key:0,class:"notification-badge"},ht={class:"p-4"},kt={class:"grid grid-cols-2 gap-4 mb-6"},bt={class:"app-card p-4"},jt={class:"text-3xl font-bold text-primary-500"},Tt={class:"app-card p-4"},wt={class:"text-3xl font-bold text-orange-500"},Pt={class:"app-card mb-6"},Ct={class:"app-card-header flex justify-between items-center"},It={key:0,class:"p-4"},Rt={key:1,class:"empty-state py-8"},Dt={key:2},Lt=["onClick"],Ot={class:"flex-1"},Ht={class:"font-medium text-gray-800"},At={class:"text-sm text-gray-500"},Mt={class:"flex items-center justify-between"},Nt={class:"flex items-center"},St={class:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center mr-3"},$t={key:0,class:"app-card mb-6"},Et={class:"app-card-header flex items-center"},Yt={class:"p-4"},zt={class:"mb-4"},Bt={class:"grid grid-cols-2 gap-2"},Vt={class:"insight-card insight-card-green"},Ft={class:"text-xl font-bold"},Wt={class:"insight-card insight-card-blue"},qt={class:"text-xl font-bold"},Ut={class:"insight-card insight-card-yellow"},Qt={class:"text-xl font-bold"},Gt={class:"insight-card insight-card-gray"},Jt={class:"text-xl font-bold"},Kt={class:"mb-4"},Xt={class:"grid grid-cols-3 gap-2"},Zt={class:"insight-card insight-card-blue"},ts={class:"text-xl font-bold"},ss={class:"insight-card insight-card-orange"},es={class:"text-xl font-bold"},as={class:"insight-card insight-card-green"},os={class:"text-xl font-bold"},ls={class:"space-y-2"},ns={class:"summary-row"},is={class:"font-semibold text-gray-800 dark:text-gray-200"},rs={class:"summary-row"},ds={class:"font-semibold text-gray-800 dark:text-gray-200"},cs={class:"summary-row"},us={class:"font-semibold text-green-500"},ps={class:"summary-row summary-row-last"},vs={class:"app-card"},ms={class:"app-card-header flex justify-between items-center"},gs={key:0,class:"p-4"},fs={key:1,class:"empty-state py-8"},_s={key:2},ys=["onClick"],xs={class:"flex-1"},hs={class:"font-medium text-gray-800"},ks={class:"text-sm text-gray-500"},bs={class:"progress-bar mt-2"},js=3e4,Ts={__name:"Home",setup(M){const g=ft(),_=gt("$dayjs"),{fetchPermissions:R,hasFullAccess:y}=yt(),h=f(!0),i=f([]),c=f([]),v=f({projects:0,tasks:0}),r=f({totalProjects:0,activeProjects:0,planningProjects:0,onHoldProjects:0,completedProjects:0,totalTasks:0,openTasks:0,workingTasks:0,completedTasks:0,overdueTasks:0,completionRate:0}),b=f(0),N=f("Smart Pro"),x=f(!1),T=Y({url:"smart_pro.smart_pro.api.projects.get_user_projects",auto:!1}),w=Y({url:"smart_pro.smart_pro.api.projects.get_user_tasks",auto:!1});let D=0;function L(o=!1){return P(this,null,function*(){const s=Date.now();if(!(!o&&D&&s-D<js&&i.value.length>0)){h.value=i.value.length===0;try{if(yield R(),console.log("Home.vue - hasFullAccess:",y.value),y.value)try{const[e,k]=yield Promise.all([I("smart_pro.smart_pro.api.projects.get_all_projects"),I("smart_pro.smart_pro.api.projects.get_all_tasks")]);i.value=e||[],c.value=k||[],console.log("Home.vue - Loaded all projects:",i.value.length)}catch(e){console.error("Error loading all data (falling back to user data):",e),yield Promise.all([T.fetch(),w.fetch()]),i.value=T.data||[],c.value=w.data||[]}else yield Promise.all([T.fetch(),w.fetch()]),i.value=T.data||[],c.value=w.data||[],console.log("Home.vue - Loaded user projects:",i.value.length);if(v.value={projects:i.value.filter(e=>e.status==="Active").length,tasks:c.value.filter(e=>e.status!=="Completed").length},y.value){const e=_().format("YYYY-MM-DD"),k=c.value.filter(n=>n.status==="Completed").length,O=c.value.length;r.value={totalProjects:i.value.length,activeProjects:i.value.filter(n=>n.status==="Active").length,planningProjects:i.value.filter(n=>n.status==="Planning").length,onHoldProjects:i.value.filter(n=>n.status==="On Hold").length,completedProjects:i.value.filter(n=>n.status==="Completed").length,totalTasks:O,openTasks:c.value.filter(n=>n.status==="Open").length,workingTasks:c.value.filter(n=>n.status==="Working"||n.status==="Pending Review").length,completedTasks:k,overdueTasks:c.value.filter(n=>n.due_date&&n.due_date<e&&n.status!=="Completed").length,completionRate:O>0?Math.round(k/O*100):0}}D=s}catch(e){console.error("Error loading data:",e)}finally{h.value=!1}}})}function F(o){L(!0).finally(()=>{o.target.complete()})}function S(o){return o?_(o).format("MMM D, YYYY"):"-"}function $(o){return{Active:"active",Planning:"planning",Completed:"completed","On Hold":"on-hold",Cancelled:"cancelled",Open:"planning",Working:"on-hold"}[o]||""}function W(o){g.push(`/smart-pro/project/${encodeURIComponent(o)}`)}function q(o){g.push(`/smart-pro/task/${encodeURIComponent(o)}`)}function U(){g.push("/smart-pro/notifications")}function E(){return P(this,null,function*(){try{const o=yield I("frappe.client.get_count",{doctype:"Notification Log",filters:{for_user:["like","%"],read:0}});b.value=o||0}catch(o){console.error("Error loading notification count:",o),b.value=0}})}function Q(){return P(this,null,function*(){try{const o=yield I("smart_pro.smart_pro.api.projects.get_app_settings");o&&o.app_name&&(N.value=o.app_name)}catch(o){console.error("Error loading app settings:",o)}})}function G(){const o=localStorage.getItem("smart-pro-theme");if(o==="dark")x.value=!0,document.body.classList.add("dark"),document.body.classList.remove("light");else if(o==="light")x.value=!1,document.body.classList.add("light"),document.body.classList.remove("dark");else{const s=window.matchMedia("(prefers-color-scheme: dark)").matches;x.value=s}}function J(){x.value=!x.value,x.value?(document.body.classList.add("dark"),document.body.classList.remove("light"),localStorage.setItem("smart-pro-theme","dark")):(document.body.classList.remove("dark"),document.body.classList.add("light"),localStorage.setItem("smart-pro-theme","light"))}return vt(()=>{G(),Q(),L(),E()}),K(()=>{L(),E()}),(o,s)=>(u(),mt(a(ut),null,{default:m(()=>[d(a(X),null,{default:m(()=>[d(a(Z),null,{default:m(()=>[d(a(tt),null,{default:m(()=>[H(l(N.value),1)]),_:1}),d(a(st),{slot:"end"},{default:m(()=>[d(a(C),{onClick:J,class:"theme-btn"},{default:m(()=>[d(a(j),{icon:x.value?a(et):a(at)},null,8,["icon"])]),_:1}),d(a(C),{onClick:U,class:"notification-btn"},{default:m(()=>[d(a(j),{icon:a(ot)},null,8,["icon"]),b.value>0?(u(),p("span",xt,l(b.value>9?"9+":b.value),1)):z("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),d(a(lt),{fullscreen:!0},{default:m(()=>[d(a(nt),{slot:"fixed",onIonRefresh:F},{default:m(()=>[d(a(it))]),_:1}),t("div",ht,[s[29]||(s[29]=t("div",{class:"mb-6"},[t("h1",{class:"text-2xl font-bold text-gray-800"}," Welcome back! "),t("p",{class:"text-gray-500"}," Here's your overview ")],-1)),t("div",kt,[t("div",bt,[t("div",jt,l(v.value.projects),1),s[3]||(s[3]=t("div",{class:"text-sm text-gray-500"}," Active Projects ",-1))]),t("div",Tt,[t("div",wt,l(v.value.tasks),1),s[4]||(s[4]=t("div",{class:"text-sm text-gray-500"}," Pending Tasks ",-1))])]),t("div",Pt,[t("div",Ct,[s[6]||(s[6]=t("span",null,"Recent Projects",-1)),d(a(C),{fill:"clear",size:"small",onClick:s[0]||(s[0]=e=>a(g).push("/smart-pro/projects"))},{default:m(()=>[...s[5]||(s[5]=[H(" See All ",-1)])]),_:1})]),h.value?(u(),p("div",It,[...s[7]||(s[7]=[t("div",{class:"skeleton h-16 mb-3"},null,-1),t("div",{class:"skeleton h-16 mb-3"},null,-1)])])):i.value.length===0?(u(),p("div",Rt,[...s[8]||(s[8]=[t("div",{class:"empty-state-title"}," No projects yet ",-1),t("div",{class:"empty-state-description"}," Create your first project to get started ",-1)])])):(u(),p("div",Dt,[(u(!0),p(B,null,V(i.value.slice(0,3),e=>(u(),p("div",{key:e.name,class:"app-list-item",onClick:k=>W(e.name)},[t("div",Ot,[t("div",Ht,l(e.title||e.name),1),t("div",At,l(S(e.end_date)),1)]),t("span",{class:A(["status-badge",$(e.status)])},l(e.status),3)],8,Lt))),128))]))]),t("div",{class:"app-card mb-6 p-4 cursor-pointer",onClick:s[1]||(s[1]=e=>a(g).push("/smart-pro/connections"))},[t("div",Mt,[t("div",Nt,[t("div",St,[d(a(j),{icon:a(rt),class:"text-xl text-purple-600"},null,8,["icon"])]),s[9]||(s[9]=t("div",null,[t("div",{class:"font-semibold text-gray-800"},"Connections Dashboard"),t("div",{class:"text-sm text-gray-500"},"View all doctypes & relationships")],-1))]),d(a(j),{icon:a(dt),class:"text-gray-400"},null,8,["icon"])])]),a(y)?(u(),p("div",$t,[t("div",Et,[d(a(j),{icon:a(ct),class:"text-lg text-blue-400 mr-2"},null,8,["icon"]),s[10]||(s[10]=t("span",null,"Insights Dashboard",-1))]),t("div",Yt,[t("div",zt,[s[15]||(s[15]=t("div",{class:"text-sm font-medium text-gray-600 dark:text-gray-300 mb-2"},"Project Status",-1)),t("div",Bt,[t("div",Vt,[t("div",Ft,l(r.value.activeProjects),1),s[11]||(s[11]=t("div",{class:"text-xs opacity-80"},"Active",-1))]),t("div",Wt,[t("div",qt,l(r.value.planningProjects),1),s[12]||(s[12]=t("div",{class:"text-xs opacity-80"},"Planning",-1))]),t("div",Ut,[t("div",Qt,l(r.value.onHoldProjects),1),s[13]||(s[13]=t("div",{class:"text-xs opacity-80"},"On Hold",-1))]),t("div",Gt,[t("div",Jt,l(r.value.completedProjects),1),s[14]||(s[14]=t("div",{class:"text-xs opacity-80"},"Completed",-1))])])]),t("div",Kt,[s[19]||(s[19]=t("div",{class:"text-sm font-medium text-gray-600 dark:text-gray-300 mb-2"},"Task Overview",-1)),t("div",Xt,[t("div",Zt,[t("div",ts,l(r.value.openTasks),1),s[16]||(s[16]=t("div",{class:"text-xs opacity-80"},"Open",-1))]),t("div",ss,[t("div",es,l(r.value.workingTasks),1),s[17]||(s[17]=t("div",{class:"text-xs opacity-80"},"Working",-1))]),t("div",as,[t("div",os,l(r.value.completedTasks),1),s[18]||(s[18]=t("div",{class:"text-xs opacity-80"},"Done",-1))])])]),t("div",null,[s[24]||(s[24]=t("div",{class:"text-sm font-medium text-gray-600 dark:text-gray-300 mb-2"},"Summary",-1)),t("div",ls,[t("div",ns,[s[20]||(s[20]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"Total Projects",-1)),t("span",is,l(r.value.totalProjects),1)]),t("div",rs,[s[21]||(s[21]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"Total Tasks",-1)),t("span",ds,l(r.value.totalTasks),1)]),t("div",cs,[s[22]||(s[22]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"Completion Rate",-1)),t("span",us,l(r.value.completionRate)+"%",1)]),t("div",ps,[s[23]||(s[23]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"Overdue Tasks",-1)),t("span",{class:A(["font-semibold",r.value.overdueTasks>0?"text-red-500":"text-gray-800 dark:text-gray-200"])},l(r.value.overdueTasks),3)])])])])])):z("",!0),t("div",vs,[t("div",ms,[s[26]||(s[26]=t("span",null,"My Tasks",-1)),d(a(C),{fill:"clear",size:"small",onClick:s[2]||(s[2]=e=>a(g).push("/smart-pro/tasks"))},{default:m(()=>[...s[25]||(s[25]=[H(" See All ",-1)])]),_:1})]),h.value?(u(),p("div",gs,[...s[27]||(s[27]=[t("div",{class:"skeleton h-16 mb-3"},null,-1),t("div",{class:"skeleton h-16 mb-3"},null,-1)])])):c.value.length===0?(u(),p("div",fs,[...s[28]||(s[28]=[t("div",{class:"empty-state-title"}," No tasks assigned ",-1),t("div",{class:"empty-state-description"}," Tasks assigned to you will appear here ",-1)])])):(u(),p("div",_s,[(u(!0),p(B,null,V(c.value.slice(0,3),e=>(u(),p("div",{key:e.name,class:"app-list-item",onClick:k=>q(e.name)},[t("div",xs,[t("div",hs,l(e.title||e.name),1),t("div",ks," Due: "+l(S(e.due_date)),1),t("div",bs,[t("div",{class:"progress-bar-fill",style:_t({width:(e.progress||0)+"%"})},null,4)])]),t("span",{class:A(["status-badge",$(e.status)])},l(e.status),3)],8,ys))),128))]))])])]),_:1})]),_:1}))}},Rs=pt(Ts,[["__scopeId","data-v-5aaec408"]]);export{Rs as default};
//# sourceMappingURL=Home-sViFBrmX.js.map
