var H=Object.defineProperty,U=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var A=(r,o,s)=>o in r?H(r,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[o]=s,E=(r,o)=>{for(var s in o||(o={}))Y.call(o,s)&&A(r,s,o[s]);if(j)for(var s of j(o))Z.call(o,s)&&A(r,s,o[s]);return r},M=(r,o)=>U(r,J(o));var N=(r,o,s)=>new Promise((y,p)=>{var g=d=>{try{v(s.next(d))}catch(h){p(h)}},k=d=>{try{v(s.throw(d))}catch(h){p(h)}},v=d=>d.done?y(d.value):Promise.resolve(d.value).then(g,k);v((s=s.apply(r,o)).next())});import{o as G,j as K,k as Q,m as x,A as X,l as ee,n as te,d as b,W as ae,u as se,v as oe,w as ne,Z as re,i as ie,O as T,g as ce,_ as le,p as B,$ as S,f as ue,a0 as de,a1 as me}from"./index-CfzjP1Tk.js";import{f as pe,r as C,a as fe,A as D,q as m,t as n,z as I,M as _e,i as ye,l,n as c,v as ge,N as O,k as _,F as P,O as $,x as u,P as V,y as R}from"./frappe-ui-5f3Xtay5.js";const ke={key:0,class:"p-4"},ve={key:1,class:"empty-state h-full"},he={key:2,class:"p-4"},Ne=["onClick"],Ie={class:"notification-content"},we={class:"notification-subject"},be={key:0,class:"notification-message"},Ce={class:"notification-time"},Oe={class:"notification-actions"},Re={key:0,class:"unread-dot"},je={__name:"Notifications",setup(r){const o=_e(),s=ye("$dayjs"),y=C(!0),p=C([]),g=C(!1);function k(){return N(this,null,function*(){y.value=!0;try{const t=((yield I("frappe.client.get_list",{doctype:"Smart Pro Notification",fields:["name","title","body","data","status","created_at"],filters:{},order_by:"created_at desc",limit_page_length:50}))||[]).map(i=>{let f={};try{f=i.data?JSON.parse(i.data):{}}catch(z){console.error("Error parsing notification data:",z)}return{name:i.name,subject:i.title,email_content:i.body,type:f.type||"Info",document_type:f.doctype,document_name:f.name,read:i.status==="read"?1:0,creation:i.created_at,source:"smart_pro"}});let a=[];try{a=((yield I("frappe.client.get_list",{doctype:"Notification Log",fields:["name","subject","email_content","type","document_type","document_name","read","creation"],filters:{},order_by:"creation desc",limit_page_length:50}))||[]).map(f=>M(E({},f),{source:"frappe"}))}catch(i){console.log("Frappe Notification Log not accessible:",i)}const w=[...t,...a];w.sort((i,f)=>new Date(f.creation)-new Date(i.creation)),p.value=w.slice(0,50)}catch(e){console.error("Error loading notifications:",e)}finally{y.value=!1}})}function v(e){k().finally(()=>{e.target.complete()})}function d(e){return N(this,null,function*(){if(!e.read)try{yield I("smart_pro.smart_pro.api.projects.mark_notification_as_read",{notification_name:e.name,source:e.source||"smart_pro"}),e.read=1}catch(t){console.error("Error marking notification as read:",t)}if(e.document_type&&e.document_name){const a={"Smart Project":`/smart-pro/project/${encodeURIComponent(e.document_name)}`,"Smart Task":`/smart-pro/task/${encodeURIComponent(e.document_name)}`,"Employee Date Request":"/smart-pro/date-requests"}[e.document_type];a&&o.push(a)}})}function h(){return N(this,null,function*(){g.value=!0;try{yield I("smart_pro.smart_pro.api.projects.mark_all_notifications_as_read"),p.value.forEach(t=>{t.read=1}),yield(yield T.create({message:"All notifications marked as read",duration:2e3,color:"success"})).present()}catch(e){console.error("Error marking all as read:",e),yield(yield T.create({message:"Failed to mark notifications as read",duration:2e3,color:"danger"})).present()}finally{g.value=!1}})}function F(e){return e?s(e).fromNow():""}function W(e){return e?e.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").trim():""}function q(e){return{Alert:me,Warning:de,Success:ue,Info:S,Assignment:B,Mention:B,Share:le,Event:ce}[e]||S}function L(e){return{Alert:"alert",Warning:"warning",Success:"success",Info:"info",Assignment:"assignment",Mention:"mention",Share:"share",Event:"event"}[e]||"info"}return fe(()=>{k()}),G(()=>{k()}),(e,t)=>(l(),D(n(ie),null,{default:m(()=>[c(n(K),null,{default:m(()=>[c(n(Q),null,{default:m(()=>[c(n(x),{slot:"start"},{default:m(()=>[c(n(X),{"default-href":"/smart-pro/home",text:""})]),_:1}),c(n(ee),null,{default:m(()=>[...t[0]||(t[0]=[ge("Notifications",-1)])]),_:1}),c(n(x),{slot:"end"},{default:m(()=>[p.value.length>0?(l(),D(n(te),{key:0,onClick:h,disabled:g.value},{default:m(()=>[c(n(b),{icon:n(ae)},null,8,["icon"])]),_:1},8,["disabled"])):O("",!0)]),_:1})]),_:1})]),_:1}),c(n(se),{fullscreen:!0},{default:m(()=>[c(n(oe),{slot:"fixed",onIonRefresh:v},{default:m(()=>[c(n(ne))]),_:1}),y.value?(l(),_("div",ke,[(l(),_(P,null,$(5,a=>u("div",{key:a,class:"app-card mb-4 p-4"},[...t[1]||(t[1]=[u("div",{class:"skeleton h-4 w-3/4 mb-2"},null,-1),u("div",{class:"skeleton h-3 w-1/2"},null,-1)])])),64))])):p.value.length===0?(l(),_("div",ve,[c(n(b),{icon:n(re),class:"empty-state-icon"},null,8,["icon"]),t[2]||(t[2]=u("div",{class:"empty-state-title"}," No notifications ",-1)),t[3]||(t[3]=u("div",{class:"empty-state-description"}," You're all caught up! ",-1))])):(l(),_("div",he,[(l(!0),_(P,null,$(p.value,a=>(l(),_("div",{key:a.name,class:V(["notification-card",{unread:!a.read}]),onClick:w=>d(a)},[u("div",{class:V(["notification-icon",L(a.type)])},[c(n(b),{icon:q(a.type)},null,8,["icon"])],2),u("div",Ie,[u("div",we,R(a.subject),1),a.email_content?(l(),_("div",be,R(W(a.email_content).substring(0,100))+"... ",1)):O("",!0),u("div",Ce,R(F(a.creation)),1)]),u("div",Oe,[a.read?O("",!0):(l(),_("span",Re))])],10,Ne))),128))]))]),_:1})]),_:1}))}},xe=pe(je,[["__scopeId","data-v-c922b1e4"]]);export{xe as default};
//# sourceMappingURL=Notifications-0MlrOvNg.js.map
