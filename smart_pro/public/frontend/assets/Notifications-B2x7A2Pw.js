var v=(w,g,d)=>new Promise((m,i)=>{var f=c=>{try{_(d.next(c))}catch(y){i(y)}},p=c=>{try{_(d.throw(c))}catch(y){i(y)}},_=c=>c.done?m(c.value):Promise.resolve(c.value).then(f,p);_((d=d.apply(w,g)).next())});import{E as P,j as V,k as D,m as b,y as L,l as W,n as q,d as k,W as F,r as z,Z as H,w as U,x as Y,i as Z,P as O,g as G,_ as J,p as R,$ as x,f as K,a0 as Q,a1 as X}from"./index-BT8PkI2H.js";import{f as ee,r as h,a as te,A as E,q as o,t as a,z as I,M as ae,i as ne,l as r,n as s,v as se,N,k as u,F as M,O as j,x as l,P as A,y as C}from"./frappe-ui-5f3Xtay5.js";const oe={key:0,class:"p-4"},re={key:1,class:"empty-state h-full"},le={key:2,class:"p-4"},ie=["onClick"],ce={class:"notification-content"},ue={class:"notification-subject"},de={key:0,class:"notification-message"},me={class:"notification-time"},fe={class:"notification-actions"},pe={key:0,class:"unread-dot"},_e={__name:"Notifications",setup(w){const g=ae(),d=ne("$dayjs"),m=h(!0),i=h([]),f=h(!1);function p(){return v(this,null,function*(){m.value=!0;try{const e=yield I("frappe.client.get_list",{doctype:"Notification Log",fields:["name","subject","email_content","type","document_type","document_name","read","creation"],filters:{},order_by:"creation desc",limit_page_length:50});i.value=e||[]}catch(e){console.error("Error loading notifications:",e)}finally{m.value=!1}})}function _(e){p().finally(()=>{e.target.complete()})}function c(e){return v(this,null,function*(){if(!e.read)try{yield I("frappe.client.set_value",{doctype:"Notification Log",name:e.name,fieldname:"read",value:1}),e.read=1}catch(n){console.error("Error marking notification as read:",n)}if(e.document_type&&e.document_name){const t={"Smart Project":`/smart-pro/project/${encodeURIComponent(e.document_name)}`,"Smart Task":`/smart-pro/task/${encodeURIComponent(e.document_name)}`,"Employee Date Request":"/smart-pro/date-requests"}[e.document_type];t&&g.push(t)}})}function y(){return v(this,null,function*(){f.value=!0;try{const e=i.value.filter(t=>!t.read);yield Promise.all(e.map(t=>I("frappe.client.set_value",{doctype:"Notification Log",name:t.name,fieldname:"read",value:1}))),i.value.forEach(t=>{t.read=1}),yield(yield O.create({message:"All notifications marked as read",duration:2e3,color:"success"})).present()}catch(e){console.error("Error marking all as read:",e),yield(yield O.create({message:"Failed to mark notifications as read",duration:2e3,color:"danger"})).present()}finally{f.value=!1}})}function T(e){return e?d(e).fromNow():""}function B(e){return e?e.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").trim():""}function S(e){return{Alert:X,Warning:Q,Success:K,Info:x,Assignment:R,Mention:R,Share:J,Event:G}[e]||x}function $(e){return{Alert:"alert",Warning:"warning",Success:"success",Info:"info",Assignment:"assignment",Mention:"mention",Share:"share",Event:"event"}[e]||"info"}return te(()=>{p()}),P(()=>{p()}),(e,n)=>(r(),E(a(Z),null,{default:o(()=>[s(a(V),null,{default:o(()=>[s(a(D),null,{default:o(()=>[s(a(b),{slot:"start"},{default:o(()=>[s(a(L),{"default-href":"/smart-pro/home",text:""})]),_:1}),s(a(W),null,{default:o(()=>[...n[0]||(n[0]=[se("Notifications",-1)])]),_:1}),s(a(b),{slot:"end"},{default:o(()=>[i.value.length>0?(r(),E(a(q),{key:0,onClick:y,disabled:f.value},{default:o(()=>[s(a(k),{icon:a(F)},null,8,["icon"])]),_:1},8,["disabled"])):N("",!0)]),_:1})]),_:1})]),_:1}),s(a(z),{fullscreen:!0},{fixed:o(()=>[s(a(U),{onIonRefresh:_},{default:o(()=>[s(a(Y))]),_:1})]),default:o(()=>[m.value?(r(),u("div",oe,[(r(),u(M,null,j(5,t=>l("div",{key:t,class:"app-card mb-4 p-4"},[...n[1]||(n[1]=[l("div",{class:"skeleton h-4 w-3/4 mb-2"},null,-1),l("div",{class:"skeleton h-3 w-1/2"},null,-1)])])),64))])):i.value.length===0?(r(),u("div",re,[s(a(k),{icon:a(H),class:"empty-state-icon"},null,8,["icon"]),n[2]||(n[2]=l("div",{class:"empty-state-title"}," No notifications ",-1)),n[3]||(n[3]=l("div",{class:"empty-state-description"}," You're all caught up! ",-1))])):(r(),u("div",le,[(r(!0),u(M,null,j(i.value,t=>(r(),u("div",{key:t.name,class:A(["notification-card",{unread:!t.read}]),onClick:ye=>c(t)},[l("div",{class:A(["notification-icon",$(t.type)])},[s(a(k),{icon:S(t.type)},null,8,["icon"])],2),l("div",ce,[l("div",ue,C(t.subject),1),t.email_content?(r(),u("div",de,C(B(t.email_content).substring(0,100))+"... ",1)):N("",!0),l("div",me,C(T(t.creation)),1)]),l("div",fe,[t.read?N("",!0):(r(),u("span",pe))])],10,ie))),128))]))]),_:1})]),_:1}))}},he=ee(_e,[["__scopeId","data-v-0107cf4b"]]);export{he as default};
//# sourceMappingURL=Notifications-B2x7A2Pw.js.map
