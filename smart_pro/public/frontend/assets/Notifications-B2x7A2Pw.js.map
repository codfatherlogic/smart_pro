{"version":3,"file":"Notifications-B2x7A2Pw.js","sources":["../../../frontend/src/views/Notifications.vue"],"sourcesContent":["<template>\n  <ion-page>\n    <ion-header>\n      <ion-toolbar>\n        <ion-buttons slot=\"start\">\n          <ion-back-button default-href=\"/smart-pro/home\" text=\"\" />\n        </ion-buttons>\n        <ion-title>Notifications</ion-title>\n        <ion-buttons slot=\"end\">\n          <ion-button\n            v-if=\"notifications.length > 0\"\n            @click=\"markAllAsRead\"\n            :disabled=\"markingAll\"\n          >\n            <ion-icon :icon=\"checkmarkDoneOutline\" />\n          </ion-button>\n        </ion-buttons>\n      </ion-toolbar>\n    </ion-header>\n\n    <ion-content :fullscreen=\"true\">\n      <template #fixed>\n        <ion-refresher @ion-refresh=\"handleRefresh\">\n          <ion-refresher-content />\n        </ion-refresher>\n      </template>\n\n      <!-- Loading State -->\n      <div\n        v-if=\"loading\"\n        class=\"p-4\"\n      >\n        <div\n          v-for=\"i in 5\"\n          :key=\"i\"\n          class=\"app-card mb-4 p-4\"\n        >\n          <div class=\"skeleton h-4 w-3/4 mb-2\" />\n          <div class=\"skeleton h-3 w-1/2\" />\n        </div>\n      </div>\n\n      <!-- Empty State -->\n      <div\n        v-else-if=\"notifications.length === 0\"\n        class=\"empty-state h-full\"\n      >\n        <ion-icon\n          :icon=\"notificationsOffOutline\"\n          class=\"empty-state-icon\"\n        />\n        <div class=\"empty-state-title\">\n          No notifications\n        </div>\n        <div class=\"empty-state-description\">\n          You're all caught up!\n        </div>\n      </div>\n\n      <!-- Notifications List -->\n      <div\n        v-else\n        class=\"p-4\"\n      >\n        <div\n          v-for=\"notification in notifications\"\n          :key=\"notification.name\"\n          class=\"notification-card\"\n          :class=\"{ unread: !notification.read }\"\n          @click=\"handleNotificationClick(notification)\"\n        >\n          <div class=\"notification-icon\" :class=\"getNotificationTypeClass(notification.type)\">\n            <ion-icon :icon=\"getNotificationIcon(notification.type)\" />\n          </div>\n          <div class=\"notification-content\">\n            <div class=\"notification-subject\">\n              {{ notification.subject }}\n            </div>\n            <div class=\"notification-message\" v-if=\"notification.email_content\">\n              {{ stripHtml(notification.email_content).substring(0, 100) }}...\n            </div>\n            <div class=\"notification-time\">\n              {{ formatTime(notification.creation) }}\n            </div>\n          </div>\n          <div class=\"notification-actions\">\n            <span\n              v-if=\"!notification.read\"\n              class=\"unread-dot\"\n            />\n          </div>\n        </div>\n      </div>\n    </ion-content>\n  </ion-page>\n</template>\n\n<script setup>\nimport { ref, onMounted, inject } from \"vue\"\nimport { onIonViewWillEnter } from \"@ionic/vue\"\nimport { useRouter } from \"vue-router\"\nimport {\n  IonPage,\n  IonHeader,\n  IonToolbar,\n  IonTitle,\n  IonContent,\n  IonRefresher,\n  IonRefresherContent,\n  IonIcon,\n  IonButton,\n  IonButtons,\n  IonBackButton,\n  toastController,\n} from \"@ionic/vue\"\nimport {\n  notificationsOffOutline,\n  checkmarkDoneOutline,\n  alertCircleOutline,\n  informationCircleOutline,\n  checkmarkCircleOutline,\n  warningOutline,\n  calendarOutline,\n  documentTextOutline,\n  personOutline,\n} from \"ionicons/icons\"\nimport { call } from \"frappe-ui\"\n\nconst router = useRouter()\nconst $dayjs = inject(\"$dayjs\")\n\nconst loading = ref(true)\nconst notifications = ref([])\nconst markingAll = ref(false)\n\nasync function loadData() {\n  loading.value = true\n  try {\n    const result = await call(\"frappe.client.get_list\", {\n      doctype: \"Notification Log\",\n      fields: [\"name\", \"subject\", \"email_content\", \"type\", \"document_type\", \"document_name\", \"read\", \"creation\"],\n      filters: {},\n      order_by: \"creation desc\",\n      limit_page_length: 50\n    })\n    notifications.value = result || []\n  } catch (err) {\n    console.error(\"Error loading notifications:\", err)\n  } finally {\n    loading.value = false\n  }\n}\n\nfunction handleRefresh(event) {\n  loadData().finally(() => {\n    event.target.complete()\n  })\n}\n\nasync function handleNotificationClick(notification) {\n  // Mark as read\n  if (!notification.read) {\n    try {\n      await call(\"frappe.client.set_value\", {\n        doctype: \"Notification Log\",\n        name: notification.name,\n        fieldname: \"read\",\n        value: 1\n      })\n      notification.read = 1\n    } catch (err) {\n      console.error(\"Error marking notification as read:\", err)\n    }\n  }\n\n  // Navigate to related document if possible\n  if (notification.document_type && notification.document_name) {\n    const docTypeRouteMap = {\n      \"Smart Project\": `/smart-pro/project/${encodeURIComponent(notification.document_name)}`,\n      \"Smart Task\": `/smart-pro/task/${encodeURIComponent(notification.document_name)}`,\n      \"Employee Date Request\": `/smart-pro/date-requests`,\n    }\n\n    const route = docTypeRouteMap[notification.document_type]\n    if (route) {\n      router.push(route)\n    }\n  }\n}\n\nasync function markAllAsRead() {\n  markingAll.value = true\n  try {\n    const unreadNotifications = notifications.value.filter(n => !n.read)\n    await Promise.all(\n      unreadNotifications.map(n =>\n        call(\"frappe.client.set_value\", {\n          doctype: \"Notification Log\",\n          name: n.name,\n          fieldname: \"read\",\n          value: 1\n        })\n      )\n    )\n\n    // Update local state\n    notifications.value.forEach(n => {\n      n.read = 1\n    })\n\n    const toast = await toastController.create({\n      message: \"All notifications marked as read\",\n      duration: 2000,\n      color: \"success\",\n    })\n    await toast.present()\n  } catch (err) {\n    console.error(\"Error marking all as read:\", err)\n    const toast = await toastController.create({\n      message: \"Failed to mark notifications as read\",\n      duration: 2000,\n      color: \"danger\",\n    })\n    await toast.present()\n  } finally {\n    markingAll.value = false\n  }\n}\n\nfunction formatTime(dateStr) {\n  if (!dateStr) return \"\"\n  return $dayjs(dateStr).fromNow()\n}\n\nfunction stripHtml(html) {\n  if (!html) return \"\"\n  return html.replace(/<[^>]*>/g, \"\").replace(/&nbsp;/g, \" \").trim()\n}\n\nfunction getNotificationIcon(type) {\n  const iconMap = {\n    Alert: alertCircleOutline,\n    Warning: warningOutline,\n    Success: checkmarkCircleOutline,\n    Info: informationCircleOutline,\n    Assignment: personOutline,\n    Mention: personOutline,\n    Share: documentTextOutline,\n    Event: calendarOutline,\n  }\n  return iconMap[type] || informationCircleOutline\n}\n\nfunction getNotificationTypeClass(type) {\n  const classMap = {\n    Alert: \"alert\",\n    Warning: \"warning\",\n    Success: \"success\",\n    Info: \"info\",\n    Assignment: \"assignment\",\n    Mention: \"mention\",\n    Share: \"share\",\n    Event: \"event\",\n  }\n  return classMap[type] || \"info\"\n}\n\nonMounted(() => {\n  loadData()\n})\n\nonIonViewWillEnter(() => {\n  loadData()\n})\n</script>\n\n<style scoped>\n.notification-card {\n  display: flex;\n  align-items: flex-start;\n  gap: 0.75rem;\n  padding: 1rem;\n  background: white;\n  border-radius: 0.75rem;\n  margin-bottom: 0.75rem;\n  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);\n  transition: all 0.2s ease;\n  cursor: pointer;\n}\n\n.notification-card:hover {\n  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n}\n\n.notification-card.unread {\n  background: linear-gradient(135deg, #eff6ff 0%, #fff 100%);\n  border-left: 3px solid var(--ion-color-primary);\n}\n\n.notification-icon {\n  width: 40px;\n  height: 40px;\n  border-radius: 10px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 1.25rem;\n  flex-shrink: 0;\n}\n\n.notification-icon.alert { background: #fecaca; color: #dc2626; }\n.notification-icon.warning { background: #fed7aa; color: #ea580c; }\n.notification-icon.success { background: #d1fae5; color: #059669; }\n.notification-icon.info { background: #dbeafe; color: #2563eb; }\n.notification-icon.assignment { background: #e9d5ff; color: #9333ea; }\n.notification-icon.mention { background: #fce7f3; color: #db2777; }\n.notification-icon.share { background: #ccfbf1; color: #0d9488; }\n.notification-icon.event { background: #fef3c7; color: #d97706; }\n\n.notification-content {\n  flex: 1;\n  min-width: 0;\n}\n\n.notification-subject {\n  font-weight: 600;\n  color: #1e293b;\n  font-size: 0.9375rem;\n  margin-bottom: 0.25rem;\n}\n\n.notification-message {\n  font-size: 0.8125rem;\n  color: #64748b;\n  margin-bottom: 0.5rem;\n  line-height: 1.4;\n}\n\n.notification-time {\n  font-size: 0.75rem;\n  color: #94a3b8;\n}\n\n.notification-actions {\n  display: flex;\n  align-items: center;\n}\n\n.unread-dot {\n  width: 10px;\n  height: 10px;\n  border-radius: 50%;\n  background: var(--ion-color-primary);\n}\n\n.empty-state {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 2rem;\n  text-align: center;\n}\n\n.empty-state-icon {\n  font-size: 4rem;\n  color: var(--ion-color-medium);\n  margin-bottom: 1rem;\n}\n\n.empty-state-title {\n  font-size: 1.25rem;\n  font-weight: 600;\n  color: var(--ion-color-dark);\n  margin-bottom: 0.5rem;\n}\n\n.empty-state-description {\n  color: var(--ion-color-medium);\n  max-width: 20rem;\n}\n\n.app-card {\n  background-color: white;\n  border-radius: 0.75rem;\n  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);\n}\n\n.skeleton {\n  background-color: #e5e7eb;\n  border-radius: 0.25rem;\n  animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;\n}\n\n@keyframes pulse {\n  0%, 100% {\n    opacity: 1;\n  }\n  50% {\n    opacity: 0.5;\n  }\n}\n</style>\n"],"names":["router","useRouter","$dayjs","inject","loading","ref","notifications","markingAll","loadData","__async","result","call","err","handleRefresh","event","handleNotificationClick","notification","route","markAllAsRead","unreadNotifications","n","toastController","formatTime","dateStr","stripHtml","html","getNotificationIcon","type","alertCircleOutline","warningOutline","checkmarkCircleOutline","informationCircleOutline","personOutline","documentTextOutline","calendarOutline","getNotificationTypeClass","onMounted","onIonViewWillEnter","_createBlock","_unref","IonPage","_createVNode","IonHeader","IonToolbar","IonButtons","IonBackButton","IonTitle","_cache","IonButton","IonIcon","checkmarkDoneOutline","IonContent","IonRefresher","IonRefresherContent","_openBlock","_createElementBlock","_hoisted_1","_Fragment","_renderList","i","_createElementVNode","_hoisted_2","notificationsOffOutline","_hoisted_3","_normalizeClass","$event","_hoisted_5","_hoisted_6","_toDisplayString","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10"],"mappings":"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"}