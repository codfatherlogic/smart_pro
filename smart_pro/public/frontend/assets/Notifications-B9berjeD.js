var H=Object.defineProperty,U=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var x=(r,s,a)=>s in r?H(r,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[s]=a,E=(r,s)=>{for(var a in s||(s={}))G.call(s,a)&&x(r,a,s[a]);if(j)for(var a of j(s))J.call(s,a)&&x(r,a,s[a]);return r},M=(r,s)=>U(r,Y(s));var I=(r,s,a)=>new Promise((g,m)=>{var v=p=>{try{h(a.next(p))}catch(N){m(N)}},k=p=>{try{h(a.throw(p))}catch(N){m(N)}},h=p=>p.done?g(p.value):Promise.resolve(p.value).then(v,k);h((a=a.apply(r,s)).next())});import{G as K,j as Q,k as X,m as P,y as Z,l as ee,n as te,d as b,Y as ae,r as ne,$ as se,w as oe,x as re,i as ie,P as S,g as le,a0 as ce,p as A,a1 as T,f as ue,a2 as de,a3 as me}from"./index-DT4P12y0.js";import{f as pe,r as C,a as fe,A as B,q as c,t as o,z as y,M as _e,i as ye,l as u,n as l,v as ge,N as R,k as _,F as D,O as $,x as d,P as L,y as O}from"./frappe-ui-5f3Xtay5.js";const ve={key:0,class:"p-4"},ke={key:1,class:"empty-state h-full"},he={key:2,class:"p-4"},Ne=["onClick"],Ie={class:"notification-content"},we={class:"notification-subject"},be={key:0,class:"notification-message"},Ce={class:"notification-time"},Re={class:"notification-actions"},Oe={key:0,class:"unread-dot"},je={__name:"Notifications",setup(r){const s=_e(),a=ye("$dayjs"),g=C(!0),m=C([]),v=C(!1);function k(){return I(this,null,function*(){g.value=!0;try{const n=((yield y("frappe.client.get_list",{doctype:"Smart Pro Notification",fields:["name","title","body","data","status","created_at"],filters:{},order_by:"created_at desc",limit_page_length:50}))||[]).map(i=>{let f={};try{f=i.data?JSON.parse(i.data):{}}catch(z){console.error("Error parsing notification data:",z)}return{name:i.name,subject:i.title,email_content:i.body,type:f.type||"Info",document_type:f.doctype,document_name:f.name,read:i.status==="read"?1:0,creation:i.created_at,source:"smart_pro"}});let t=[];try{t=((yield y("frappe.client.get_list",{doctype:"Notification Log",fields:["name","subject","email_content","type","document_type","document_name","read","creation"],filters:{},order_by:"creation desc",limit_page_length:50}))||[]).map(f=>M(E({},f),{source:"frappe"}))}catch(i){console.log("Frappe Notification Log not accessible:",i)}const w=[...n,...t];w.sort((i,f)=>new Date(f.creation)-new Date(i.creation)),m.value=w.slice(0,50)}catch(e){console.error("Error loading notifications:",e)}finally{g.value=!1}})}function h(e){k().finally(()=>{e.target.complete()})}function p(e){return I(this,null,function*(){if(!e.read)try{e.source==="smart_pro"?yield y("frappe.client.set_value",{doctype:"Smart Pro Notification",name:e.name,fieldname:"status",value:"read"}):yield y("frappe.client.set_value",{doctype:"Notification Log",name:e.name,fieldname:"read",value:1}),e.read=1}catch(n){console.error("Error marking notification as read:",n)}if(e.document_type&&e.document_name){const t={"Smart Project":`/smart-pro/project/${encodeURIComponent(e.document_name)}`,"Smart Task":`/smart-pro/task/${encodeURIComponent(e.document_name)}`,"Employee Date Request":"/smart-pro/date-requests"}[e.document_type];t&&s.push(t)}})}function N(){return I(this,null,function*(){v.value=!0;try{const e=m.value.filter(t=>!t.read);yield Promise.all(e.map(t=>t.source==="smart_pro"?y("frappe.client.set_value",{doctype:"Smart Pro Notification",name:t.name,fieldname:"status",value:"read"}):y("frappe.client.set_value",{doctype:"Notification Log",name:t.name,fieldname:"read",value:1}))),m.value.forEach(t=>{t.read=1}),yield(yield S.create({message:"All notifications marked as read",duration:2e3,color:"success"})).present()}catch(e){console.error("Error marking all as read:",e),yield(yield S.create({message:"Failed to mark notifications as read",duration:2e3,color:"danger"})).present()}finally{v.value=!1}})}function V(e){return e?a(e).fromNow():""}function F(e){return e?e.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").trim():""}function q(e){return{Alert:me,Warning:de,Success:ue,Info:T,Assignment:A,Mention:A,Share:ce,Event:le}[e]||T}function W(e){return{Alert:"alert",Warning:"warning",Success:"success",Info:"info",Assignment:"assignment",Mention:"mention",Share:"share",Event:"event"}[e]||"info"}return fe(()=>{k()}),K(()=>{k()}),(e,n)=>(u(),B(o(ie),null,{default:c(()=>[l(o(Q),null,{default:c(()=>[l(o(X),null,{default:c(()=>[l(o(P),{slot:"start"},{default:c(()=>[l(o(Z),{"default-href":"/smart-pro/home",text:""})]),_:1}),l(o(ee),null,{default:c(()=>[...n[0]||(n[0]=[ge("Notifications",-1)])]),_:1}),l(o(P),{slot:"end"},{default:c(()=>[m.value.length>0?(u(),B(o(te),{key:0,onClick:N,disabled:v.value},{default:c(()=>[l(o(b),{icon:o(ae)},null,8,["icon"])]),_:1},8,["disabled"])):R("",!0)]),_:1})]),_:1})]),_:1}),l(o(ne),{fullscreen:!0},{fixed:c(()=>[l(o(oe),{onIonRefresh:h},{default:c(()=>[l(o(re))]),_:1})]),default:c(()=>[g.value?(u(),_("div",ve,[(u(),_(D,null,$(5,t=>d("div",{key:t,class:"app-card mb-4 p-4"},[...n[1]||(n[1]=[d("div",{class:"skeleton h-4 w-3/4 mb-2"},null,-1),d("div",{class:"skeleton h-3 w-1/2"},null,-1)])])),64))])):m.value.length===0?(u(),_("div",ke,[l(o(b),{icon:o(se),class:"empty-state-icon"},null,8,["icon"]),n[2]||(n[2]=d("div",{class:"empty-state-title"}," No notifications ",-1)),n[3]||(n[3]=d("div",{class:"empty-state-description"}," You're all caught up! ",-1))])):(u(),_("div",he,[(u(!0),_(D,null,$(m.value,t=>(u(),_("div",{key:t.name,class:L(["notification-card",{unread:!t.read}]),onClick:w=>p(t)},[d("div",{class:L(["notification-icon",W(t.type)])},[l(o(b),{icon:q(t.type)},null,8,["icon"])],2),d("div",Ie,[d("div",we,O(t.subject),1),t.email_content?(u(),_("div",be,O(F(t.email_content).substring(0,100))+"... ",1)):R("",!0),d("div",Ce,O(V(t.creation)),1)]),d("div",Re,[t.read?R("",!0):(u(),_("span",Oe))])],10,Ne))),128))]))]),_:1})]),_:1}))}},Pe=pe(je,[["__scopeId","data-v-c1aae4e9"]]);export{Pe as default};
//# sourceMappingURL=Notifications-B9berjeD.js.map
