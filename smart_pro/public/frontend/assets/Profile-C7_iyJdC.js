var d=(C,y,u)=>new Promise((f,i)=>{var m=r=>{try{g(u.next(r))}catch(c){i(c)}},b=r=>{try{g(u.throw(r))}catch(c){i(c)}},g=r=>r.done?f(r.value):Promise.resolve(r.value).then(m,b);g((u=u.apply(C,y)).next())});import{r as j,c as E,L as k,a as R,A as H,q as o,t,z as P,M as N,l as V,n as a,v as x,x as s,y as _}from"./frappe-ui-5f3Xtay5.js";import{o as K,j as U,k as D,m as M,A as q,l as z,u as W,a2 as $,a3 as v,e as h,d as p,y as I,a4 as G,a5 as J,$ as Q,a6 as X,i as Y,P as w,a7 as Z,a8 as A}from"./index-C-hcTcxK.js";import{u as tt}from"./usePermissions-DkJGg_er.js";const et={class:"p-4"},at={class:"app-card p-6 mb-6 text-center"},ot={class:"w-20 h-20 rounded-full bg-primary-100 flex items-center justify-center mx-auto mb-4"},st={class:"text-3xl font-bold text-primary-600"},lt={class:"text-xl font-semibold text-gray-800"},rt={class:"text-gray-500"},nt={class:"grid grid-cols-3 gap-4 mb-6"},it={class:"app-card p-4 text-center"},ct={class:"text-2xl font-bold text-primary-500"},ut={class:"app-card p-4 text-center"},dt={class:"text-2xl font-bold text-orange-500"},pt={class:"app-card p-4 text-center"},ft={class:"text-2xl font-bold text-green-500"},mt={class:"app-card"},ht={__name:"Profile",setup(C){N();const{fetchPermissions:y,hasFullAccess:u}=tt(),f=j(""),i=j(""),m=j({projects:0,tasks:0,completed:0}),b=E(()=>f.value?f.value.split(" ").map(l=>l[0]).join("").toUpperCase().slice(0,2):"?"),g=k({url:"frappe.auth.get_logged_user",auto:!1}),r=k({url:"smart_pro.smart_pro.api.projects.get_user_projects",auto:!1}),c=k({url:"smart_pro.smart_pro.api.projects.get_user_tasks",auto:!1});function S(){return d(this,null,function*(){try{if(yield g.fetch(),i.value=g.data||"",i.value){const n=yield P("frappe.client.get_value",{doctype:"User",filters:{name:i.value},fieldname:"full_name"});f.value=(n==null?void 0:n.full_name)||i.value}yield y(),console.log("Profile.vue - hasFullAccess:",u.value);let l=[],e=[];if(u.value)try{const[n,F]=yield Promise.all([P("smart_pro.smart_pro.api.projects.get_all_projects"),P("smart_pro.smart_pro.api.projects.get_all_tasks")]);l=n||[],e=F||[],console.log("Profile.vue - Loaded all projects:",l.length)}catch(n){console.error("Error loading all data (falling back to user data):",n),yield Promise.all([r.fetch(),c.fetch()]),l=r.data||[],e=c.data||[]}else yield Promise.all([r.fetch(),c.fetch()]),l=r.data||[],e=c.data||[],console.log("Profile.vue - Loaded user projects:",l.length);m.value={projects:l.length,tasks:e.length,completed:e.filter(n=>n.status==="Completed").length}}catch(l){console.error("Error loading user data:",l)}})}function L(){return d(this,null,function*(){yield(yield w.create({header:"Settings",message:"Settings will be available in a future update.",buttons:["OK"]})).present()})}function O(){return d(this,null,function*(){yield(yield w.create({header:"Help & Support",message:"For support, please contact your administrator.",buttons:["OK"]})).present()})}function T(){return d(this,null,function*(){yield(yield w.create({header:"About Smart Pro",message:"Smart Pro is a project management application built on Frappe Framework.",buttons:["OK"]})).present()})}function B(){return d(this,null,function*(){yield(yield w.create({header:"Logout",message:"Are you sure you want to logout?",buttons:[{text:"Cancel",role:"cancel"},{text:"Logout",role:"destructive",handler:()=>d(this,null,function*(){const e=yield Z.create({message:"Logging out..."});yield e.present();try{yield fetch("/api/method/logout",{method:"POST",headers:{"Content-Type":"application/json"}}),A(),localStorage.removeItem("user_id"),sessionStorage.clear(),window.location.href="/smart-pro/login"}catch(n){console.error("Logout error:",n),A(),window.location.href="/smart-pro/login"}finally{yield e.dismiss()}})}]})).present()})}return R(()=>{S()}),K(()=>{S()}),(l,e)=>(V(),H(t(Y),null,{default:o(()=>[a(t(U),null,{default:o(()=>[a(t(D),null,{default:o(()=>[a(t(M),{slot:"start"},{default:o(()=>[a(t(q),{"default-href":"/smart-pro/home",text:""})]),_:1}),a(t(z),null,{default:o(()=>[...e[0]||(e[0]=[x("Profile",-1)])]),_:1})]),_:1})]),_:1}),a(t(W),{fullscreen:!0},{default:o(()=>[s("div",et,[s("div",at,[s("div",ot,[s("span",st,_(b.value),1)]),s("h2",lt,_(f.value),1),s("p",rt,_(i.value),1)]),s("div",nt,[s("div",it,[s("div",ct,_(m.value.projects),1),e[1]||(e[1]=s("div",{class:"text-xs text-gray-500"}," Projects ",-1))]),s("div",ut,[s("div",dt,_(m.value.tasks),1),e[2]||(e[2]=s("div",{class:"text-xs text-gray-500"}," Tasks ",-1))]),s("div",pt,[s("div",ft,_(m.value.completed),1),e[3]||(e[3]=s("div",{class:"text-xs text-gray-500"}," Done ",-1))])]),s("div",mt,[a(t($),{lines:"full"},{default:o(()=>[a(t(v),{button:"",onClick:L},{start:o(()=>[a(t(p),{icon:t(G)},null,8,["icon"])]),end:o(()=>[a(t(p),{icon:t(I)},null,8,["icon"])]),default:o(()=>[a(t(h),null,{default:o(()=>[...e[4]||(e[4]=[x("Settings",-1)])]),_:1})]),_:1}),a(t(v),{button:"",onClick:O},{start:o(()=>[a(t(p),{icon:t(J)},null,8,["icon"])]),end:o(()=>[a(t(p),{icon:t(I)},null,8,["icon"])]),default:o(()=>[a(t(h),null,{default:o(()=>[...e[5]||(e[5]=[x("Help & Support",-1)])]),_:1})]),_:1}),a(t(v),{button:"",onClick:T},{start:o(()=>[a(t(p),{icon:t(Q)},null,8,["icon"])]),end:o(()=>[a(t(p),{icon:t(I)},null,8,["icon"])]),default:o(()=>[a(t(h),null,{default:o(()=>[...e[6]||(e[6]=[x("About",-1)])]),_:1})]),_:1}),a(t(v),{button:"",class:"text-red-500",onClick:B},{default:o(()=>[a(t(p),{slot:"start",icon:t(X),color:"danger"},null,8,["icon"]),a(t(h),{color:"danger"},{default:o(()=>[...e[7]||(e[7]=[x(" Logout ",-1)])]),_:1})]),_:1})]),_:1})]),e[8]||(e[8]=s("div",{class:"text-center mt-6 text-sm text-gray-400"}," Smart Pro v1.0.0 ",-1))])]),_:1})]),_:1}))}};export{ht as default};
//# sourceMappingURL=Profile-C7_iyJdC.js.map
