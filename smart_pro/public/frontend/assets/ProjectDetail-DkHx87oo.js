var D=(C,g,m)=>new Promise((x,y)=>{var j=a=>{try{d(m.next(a))}catch(p){y(p)}},_=a=>{try{d(m.throw(a))}catch(p){y(p)}},d=a=>a.done?x(a.value):Promise.resolve(a.value).then(j,_);d((m=m.apply(C,g)).next())});import{r as v,L as b,a as L,A as P,q as u,t as l,u as U,M as S,i as q,l as n,n as c,v as T,k as r,N as f,x as t,y as o,P as M,F as A,O as E}from"./frappe-ui-5f3Xtay5.js";import{j as W,k as G,m as J,z as K,l as Q,u as X,v as Z,w as tt,n as F,d as et,A as st,i as at}from"./index-BdT8h_5n.js";import{u as ot}from"./usePermissions-DkJGg_er.js";const nt={key:0,class:"p-4"},lt={key:1,class:"empty-state h-full"},rt={class:"empty-state-description"},it={key:2,class:"p-4"},ct={class:"mb-6"},dt={class:"flex justify-between items-start mb-2"},ut={class:"text-2xl font-bold text-gray-800"},pt={key:0,class:"text-gray-600"},mt={class:"grid grid-cols-2 gap-4 mb-6"},_t={class:"app-card p-4"},vt={class:"font-medium"},ft={class:"app-card p-4"},gt={class:"font-medium"},yt={key:0,class:"app-card p-4"},ht={class:"font-medium"},xt={key:1,class:"app-card p-4"},jt={class:"font-medium"},kt={class:"app-card mb-6"},It={class:"app-card-header flex justify-between items-center"},bt={key:0,class:"p-4 text-center text-gray-500"},Ct={key:1},wt=["onClick"],Rt={class:"flex-1"},Nt={class:"font-medium text-gray-800"},Bt={class:"text-sm text-gray-500"},Dt={class:"app-card"},Pt={class:"app-card-header flex justify-between items-center"},Tt={key:0,class:"p-4 text-center text-gray-500"},Mt={key:1},At={class:"flex items-center"},Et={class:"w-10 h-10 rounded-full bg-primary-100 flex items-center justify-center mr-3"},Ft={class:"text-sm font-medium text-primary-600"},$t={class:"font-medium text-gray-800"},Ht={class:"text-sm text-gray-500"},Ot={class:"text-sm text-gray-500"},St={__name:"ProjectDetail",setup(C){const g=U(),m=S(),x=q("$dayjs"),{fetchPermissions:y,hasFullAccess:j}=ot(),_=v(!0),d=v(""),a=v(null),p=v([]),h=v([]),w=b({url:"smart_pro.smart_pro.api.projects.get_project_details",auto:!1}),R=b({url:"smart_pro.smart_pro.api.projects.get_project_tasks",auto:!1}),N=b({url:"smart_pro.smart_pro.api.projects.get_employee_assignments",auto:!1});function k(){return D(this,null,function*(){const s=g.params.id;if(!s){d.value="Project not found";return}_.value=!0,d.value="";try{yield y(),yield Promise.all([w.fetch({project_name:s}),R.fetch({project_name:s}),N.fetch({project_name:s})]),a.value=w.data,p.value=R.data||[],h.value=N.data||[]}catch(e){console.error("Error loading project:",e),d.value=e.message||"Failed to load project"}finally{_.value=!1}})}function $(s){k().finally(()=>{s.target.complete()})}function I(s){return s?x(s).format("MMM D, YYYY"):"-"}function H(s){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(s)}function B(s){return{Active:"active",Planning:"planning",Completed:"completed","On Hold":"on-hold",Cancelled:"cancelled",Open:"planning",Working:"on-hold"}[s]||""}function O(s){if(!s)return"";const e=document.createElement("div");return e.innerHTML=s,e.textContent||e.innerText||""}function V(s){return s?s.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2):"?"}function Y(s){m.push(`/smart-pro/task/${encodeURIComponent(s)}`)}function z(){const s=g.params.id;m.push(`/smart-pro/assignment/new?project=${encodeURIComponent(s)}`)}return L(()=>{k()}),(s,e)=>(n(),P(l(at),null,{default:u(()=>[c(l(W),null,{default:u(()=>[c(l(G),null,{default:u(()=>[c(l(J),{slot:"start"},{default:u(()=>[c(l(K),{"default-href":"/smart-pro/projects",text:""})]),_:1}),c(l(Q),null,{default:u(()=>[...e[0]||(e[0]=[T("Project Details",-1)])]),_:1})]),_:1})]),_:1}),c(l(X),{fullscreen:!0},{default:u(()=>[c(l(Z),{slot:"fixed",onIonRefresh:$},{default:u(()=>[c(l(tt))]),_:1}),_.value?(n(),r("div",nt,[...e[1]||(e[1]=[t("div",{class:"skeleton h-8 w-3/4 mb-4"},null,-1),t("div",{class:"skeleton h-4 w-1/2 mb-6"},null,-1),t("div",{class:"skeleton h-24 w-full mb-4"},null,-1),t("div",{class:"skeleton h-32 w-full"},null,-1)])])):d.value?(n(),r("div",lt,[e[3]||(e[3]=t("div",{class:"empty-state-title"}," Error loading project ",-1)),t("div",rt,o(d.value),1),c(l(F),{class:"mt-4",onClick:k},{default:u(()=>[...e[2]||(e[2]=[T(" Retry ",-1)])]),_:1})])):a.value?(n(),r("div",it,[t("div",ct,[t("div",dt,[t("h1",ut,o(a.value.title),1),t("span",{class:M(["status-badge",B(a.value.status)])},o(a.value.status),3)]),a.value.description?(n(),r("p",pt,o(O(a.value.description)),1)):f("",!0)]),t("div",mt,[t("div",_t,[e[4]||(e[4]=t("div",{class:"text-xs text-gray-500 mb-1"}," Start Date ",-1)),t("div",vt,o(I(a.value.start_date)),1)]),t("div",ft,[e[5]||(e[5]=t("div",{class:"text-xs text-gray-500 mb-1"}," End Date ",-1)),t("div",gt,o(I(a.value.end_date)),1)]),a.value.project_manager?(n(),r("div",yt,[e[6]||(e[6]=t("div",{class:"text-xs text-gray-500 mb-1"}," Manager ",-1)),t("div",ht,o(a.value.project_manager),1)])):f("",!0),a.value.budget_amount?(n(),r("div",xt,[e[7]||(e[7]=t("div",{class:"text-xs text-gray-500 mb-1"}," Budget ",-1)),t("div",jt,o(H(a.value.budget_amount)),1)])):f("",!0)]),t("div",kt,[t("div",It,[t("span",null,"Tasks ("+o(p.value.length)+")",1)]),p.value.length===0?(n(),r("div",bt," No tasks for this project ")):(n(),r("div",Ct,[(n(!0),r(A,null,E(p.value,i=>(n(),r("div",{key:i.name,class:"app-list-item",onClick:Vt=>Y(i.name)},[t("div",Rt,[t("div",Nt,o(i.title||i.name),1),t("div",Bt," Due: "+o(I(i.due_date)),1)]),t("span",{class:M(["status-badge",B(i.status)])},o(i.status),3)],8,wt))),128))]))]),t("div",Dt,[t("div",Pt,[t("span",null,"Team ("+o(h.value.length)+")",1),l(j)?(n(),P(l(F),{key:0,fill:"clear",size:"small",onClick:z},{default:u(()=>[c(l(et),{icon:l(st)},null,8,["icon"])]),_:1})):f("",!0)]),h.value.length===0?(n(),r("div",Tt," No team members assigned ")):(n(),r("div",Mt,[(n(!0),r(A,null,E(h.value,i=>(n(),r("div",{key:i.name,class:"app-list-item"},[t("div",At,[t("div",Et,[t("span",Ft,o(V(i.employee_name)),1)]),t("div",null,[t("div",$t,o(i.employee_name),1),t("div",Ht,o(i.role),1)])]),t("div",Ot,o(i.allocation_percentage)+"% ",1)]))),128))]))])])):f("",!0)]),_:1})]),_:1}))}};export{St as default};
//# sourceMappingURL=ProjectDetail-DkHx87oo.js.map
