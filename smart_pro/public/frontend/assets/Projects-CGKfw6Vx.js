var w=(P,b,p)=>new Promise((i,d)=>{var n=r=>{try{f(p.next(r))}catch(_){d(_)}},v=r=>{try{f(p.throw(r))}catch(_){d(_)}},f=r=>r.done?i(r.value):Promise.resolve(r.value).then(n,v);f((p=p.apply(P,b)).next())});import{r as C,L as M,c as T,w as F,a as Y,A as U,q as o,t as l,M as q,i as z,l as c,n as s,v as g,k as m,F as A,O as D,x as u,y,N as Q,P as W}from"./frappe-ui-5f3Xtay5.js";import{o as G,j as J,k as x,m as K,z as X,l as Z,A as ee,B as te,C as h,e as I,u as le,v as ae,w as se,d as oe,D as ne,i as re}from"./index-Cn4F0kH1.js";const ue={key:0,class:"p-4"},de={key:1,class:"empty-state h-full"},ce={class:"empty-state-description"},ie={key:2,class:"p-4"},fe=["onClick"],me={class:"flex justify-between items-start mb-2"},pe={class:"font-semibold text-gray-800"},ve={class:"text-sm text-gray-500 mb-3"},_e={key:0,class:"text-sm text-gray-600"},ge=3e4,Ie={__name:"Projects",setup(P){const b=q(),p=z("$dayjs"),i=C(!0),d=C(""),n=C("active"),v=C([]),f=C([]);let r=!1;const _=M({url:"smart_pro.smart_pro.api.projects.get_user_projects",auto:!1}),L=M({url:"smart_pro.smart_pro.api.projects.get_user_projects",auto:!1}),V=T(()=>{let t=n.value==="completed"?f.value:v.value;if(n.value!=="all"&&n.value!=="completed"){const a={active:"Active",planning:"Planning","on-hold":"On Hold",cancelled:"Cancelled"}[n.value];t=t.filter(R=>R.status===a)}if(d.value){const e=d.value.toLowerCase();t=t.filter(a=>(a.title||a.name).toLowerCase().includes(e)||(a.status||"").toLowerCase().includes(e))}return t}),E=T(()=>d.value?"Try a different search term":n.value!=="all"?`No ${{active:"active",planning:"planning",completed:"completed","on-hold":"on hold",cancelled:"cancelled"}[n.value]} projects`:"Create your first project");let j=0;function k(t=!1){return w(this,null,function*(){const e=Date.now();if(!(!t&&j&&e-j<ge&&v.value.length>0)){i.value=v.value.length===0;try{yield _.fetch(),v.value=_.data||[],j=e}catch(a){console.error("Error loading projects:",a)}finally{i.value=!1}}})}function B(){return w(this,null,function*(){if(!r){i.value=!0;try{yield L.fetch({include_completed:"true"});const t=L.data||[];f.value=t.filter(e=>e.status==="Completed"),r=!0}catch(t){console.error("Error loading completed projects:",t)}finally{i.value=!1}}})}F(n,t=>{t==="completed"&&!r&&B()});function S(t){r=!1,f.value=[],k(!0).finally(()=>{n.value==="completed"?B().finally(()=>{t.target.complete()}):t.target.complete()})}function N(t){return t?p(t).format("MMM D, YYYY"):"-"}function H(t){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(t)}function O(t){return{Active:"active",Planning:"planning",Completed:"completed","On Hold":"on-hold",Cancelled:"cancelled"}[t]||""}function $(t){b.push(`/smart-pro/project/${encodeURIComponent(t)}`)}return Y(()=>{k()}),G(()=>{k()}),(t,e)=>(c(),U(l(re),null,{default:o(()=>[s(l(J),null,{default:o(()=>[s(l(x),null,{default:o(()=>[s(l(K),{slot:"start"},{default:o(()=>[s(l(X),{"default-href":"/smart-pro/home",text:""})]),_:1}),s(l(Z),null,{default:o(()=>[...e[2]||(e[2]=[g("Projects",-1)])]),_:1})]),_:1}),s(l(x),null,{default:o(()=>[s(l(ee),{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=a=>d.value=a),placeholder:"Search projects...",debounce:300},null,8,["modelValue"])]),_:1}),s(l(x),null,{default:o(()=>[s(l(te),{modelValue:n.value,"onUpdate:modelValue":e[1]||(e[1]=a=>n.value=a),scrollable:""},{default:o(()=>[s(l(h),{value:"all"},{default:o(()=>[s(l(I),null,{default:o(()=>[...e[3]||(e[3]=[g("All",-1)])]),_:1})]),_:1}),s(l(h),{value:"active"},{default:o(()=>[s(l(I),null,{default:o(()=>[...e[4]||(e[4]=[g("Active",-1)])]),_:1})]),_:1}),s(l(h),{value:"planning"},{default:o(()=>[s(l(I),null,{default:o(()=>[...e[5]||(e[5]=[g("Planning",-1)])]),_:1})]),_:1}),s(l(h),{value:"completed"},{default:o(()=>[s(l(I),null,{default:o(()=>[...e[6]||(e[6]=[g("Completed",-1)])]),_:1})]),_:1}),s(l(h),{value:"on-hold"},{default:o(()=>[s(l(I),null,{default:o(()=>[...e[7]||(e[7]=[g("On Hold",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(l(le),{fullscreen:!0},{default:o(()=>[s(l(ae),{slot:"fixed",onIonRefresh:S},{default:o(()=>[s(l(se))]),_:1}),i.value?(c(),m("div",ue,[(c(),m(A,null,D(5,a=>u("div",{key:a,class:"app-card mb-4 p-4"},[...e[8]||(e[8]=[u("div",{class:"skeleton h-5 w-3/4 mb-2"},null,-1),u("div",{class:"skeleton h-4 w-1/2 mb-2"},null,-1),u("div",{class:"skeleton h-3 w-full"},null,-1)])])),64))])):V.value.length===0?(c(),m("div",de,[s(l(oe),{icon:l(ne),class:"empty-state-icon"},null,8,["icon"]),e[9]||(e[9]=u("div",{class:"empty-state-title"}," No projects found ",-1)),u("div",ce,y(E.value),1)])):(c(),m("div",ie,[(c(!0),m(A,null,D(V.value,a=>(c(),m("div",{key:a.name,class:"app-card mb-4 p-4",onClick:R=>$(a.name)},[u("div",me,[u("h3",pe,y(a.title||a.name),1),u("span",{class:W(["status-badge",O(a.status)])},y(a.status),3)]),u("div",ve,y(N(a.start_date))+" - "+y(N(a.end_date)),1),a.budget_amount?(c(),m("div",_e," Budget: "+y(H(a.budget_amount)),1)):Q("",!0)],8,fe))),128))]))]),_:1})]),_:1}))}};export{Ie as default};
//# sourceMappingURL=Projects-CGKfw6Vx.js.map
