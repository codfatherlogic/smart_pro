{"version":3,"file":"Projects-CGKfw6Vx.js","sources":["../../../frontend/src/views/Projects.vue"],"sourcesContent":["<template>\n  <ion-page>\n    <ion-header>\n      <ion-toolbar>\n        <ion-buttons slot=\"start\">\n          <ion-back-button default-href=\"/smart-pro/home\" text=\"\" />\n        </ion-buttons>\n        <ion-title>Projects</ion-title>\n      </ion-toolbar>\n      <ion-toolbar>\n        <ion-searchbar\n          v-model=\"searchQuery\"\n          placeholder=\"Search projects...\"\n          :debounce=\"300\"\n        />\n      </ion-toolbar>\n      <ion-toolbar>\n        <ion-segment v-model=\"statusFilter\" scrollable>\n          <ion-segment-button value=\"all\">\n            <ion-label>All</ion-label>\n          </ion-segment-button>\n          <ion-segment-button value=\"active\">\n            <ion-label>Active</ion-label>\n          </ion-segment-button>\n          <ion-segment-button value=\"planning\">\n            <ion-label>Planning</ion-label>\n          </ion-segment-button>\n          <ion-segment-button value=\"completed\">\n            <ion-label>Completed</ion-label>\n          </ion-segment-button>\n          <ion-segment-button value=\"on-hold\">\n            <ion-label>On Hold</ion-label>\n          </ion-segment-button>\n        </ion-segment>\n      </ion-toolbar>\n    </ion-header>\n\n    <ion-content :fullscreen=\"true\">\n      <ion-refresher\n        slot=\"fixed\"\n        @ion-refresh=\"handleRefresh\"\n      >\n        <ion-refresher-content />\n      </ion-refresher>\n\n      <!-- Loading State -->\n      <div\n        v-if=\"loading\"\n        class=\"p-4\"\n      >\n        <div\n          v-for=\"i in 5\"\n          :key=\"i\"\n          class=\"app-card mb-4 p-4\"\n        >\n          <div class=\"skeleton h-5 w-3/4 mb-2\" />\n          <div class=\"skeleton h-4 w-1/2 mb-2\" />\n          <div class=\"skeleton h-3 w-full\" />\n        </div>\n      </div>\n\n      <!-- Empty State -->\n      <div\n        v-else-if=\"filteredProjects.length === 0\"\n        class=\"empty-state h-full\"\n      >\n        <ion-icon\n          :icon=\"folderOutline\"\n          class=\"empty-state-icon\"\n        />\n        <div class=\"empty-state-title\">\n          No projects found\n        </div>\n        <div class=\"empty-state-description\">\n          {{ getEmptyMessage }}\n        </div>\n      </div>\n\n      <!-- Projects List -->\n      <div\n        v-else\n        class=\"p-4\"\n      >\n        <div\n          v-for=\"project in filteredProjects\"\n          :key=\"project.name\"\n          class=\"app-card mb-4 p-4\"\n          @click=\"goToProject(project.name)\"\n        >\n          <div class=\"flex justify-between items-start mb-2\">\n            <h3 class=\"font-semibold text-gray-800\">\n              {{ project.title || project.name }}\n            </h3>\n            <span :class=\"['status-badge', getStatusClass(project.status)]\">\n              {{ project.status }}\n            </span>\n          </div>\n          <div class=\"text-sm text-gray-500 mb-3\">\n            {{ formatDate(project.start_date) }} - {{ formatDate(project.end_date) }}\n          </div>\n          <div\n            v-if=\"project.budget_amount\"\n            class=\"text-sm text-gray-600\"\n          >\n            Budget: {{ formatCurrency(project.budget_amount) }}\n          </div>\n        </div>\n      </div>\n\n    </ion-content>\n  </ion-page>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted, inject, watch } from \"vue\"\nimport { useRouter } from \"vue-router\"\nimport {\n  IonPage,\n  IonHeader,\n  IonToolbar,\n  IonTitle,\n  IonContent,\n  IonSearchbar,\n  IonRefresher,\n  IonRefresherContent,\n  IonButtons,\n  IonBackButton,\n  IonIcon,\n  IonSegment,\n  IonSegmentButton,\n  IonLabel,\n  onIonViewWillEnter,\n} from \"@ionic/vue\"\nimport { folderOutline } from \"ionicons/icons\"\nimport { createResource } from \"frappe-ui\"\n\nconst router = useRouter()\nconst $dayjs = inject(\"$dayjs\")\n\nconst loading = ref(true)\nconst searchQuery = ref(\"\")\nconst statusFilter = ref(\"active\")\nconst projects = ref([])\nconst completedProjects = ref([])\nlet completedLoaded = false\n\nconst projectsResource = createResource({\n  url: \"smart_pro.smart_pro.api.projects.get_user_projects\",\n  auto: false,\n})\n\n// Separate resource for completed projects (only loaded when needed)\nconst completedProjectsResource = createResource({\n  url: \"smart_pro.smart_pro.api.projects.get_user_projects\",\n  auto: false,\n})\n\nconst filteredProjects = computed(() => {\n  // For completed filter, use completedProjects; otherwise use regular projects\n  let result = statusFilter.value === \"completed\" ? completedProjects.value : projects.value\n\n  // Apply status filter (except for completed which is already filtered)\n  if (statusFilter.value !== \"all\" && statusFilter.value !== \"completed\") {\n    const statusMap = {\n      \"active\": \"Active\",\n      \"planning\": \"Planning\",\n      \"on-hold\": \"On Hold\",\n      \"cancelled\": \"Cancelled\"\n    }\n    const targetStatus = statusMap[statusFilter.value]\n    result = result.filter(p => p.status === targetStatus)\n  }\n\n  // Apply search filter\n  if (searchQuery.value) {\n    const query = searchQuery.value.toLowerCase()\n    result = result.filter(\n      (p) =>\n        (p.title || p.name).toLowerCase().includes(query) ||\n        (p.status || \"\").toLowerCase().includes(query)\n    )\n  }\n\n  return result\n})\n\nconst getEmptyMessage = computed(() => {\n  if (searchQuery.value) {\n    return \"Try a different search term\"\n  }\n  if (statusFilter.value !== \"all\") {\n    const filterLabels = {\n      \"active\": \"active\",\n      \"planning\": \"planning\",\n      \"completed\": \"completed\",\n      \"on-hold\": \"on hold\",\n      \"cancelled\": \"cancelled\"\n    }\n    return `No ${filterLabels[statusFilter.value]} projects`\n  }\n  return \"Create your first project\"\n})\n\n// Cache timestamp to avoid unnecessary reloads\nlet lastLoadTime = 0\nconst CACHE_TTL = 30000 // 30 seconds\n\nasync function loadData(forceRefresh = false) {\n  const now = Date.now()\n\n  // Skip reload if data is fresh (unless forced)\n  if (!forceRefresh && lastLoadTime && (now - lastLoadTime) < CACHE_TTL && projects.value.length > 0) {\n    return\n  }\n\n  loading.value = projects.value.length === 0 // Only show loading on first load\n  try {\n    // Load active projects (excludes completed by default)\n    await projectsResource.fetch()\n    projects.value = projectsResource.data || []\n    lastLoadTime = now\n  } catch (error) {\n    console.error(\"Error loading projects:\", error)\n  } finally {\n    loading.value = false\n  }\n}\n\n// Load completed projects only when user clicks on Completed tab\nasync function loadCompletedProjects() {\n  if (completedLoaded) return\n\n  loading.value = true\n  try {\n    await completedProjectsResource.fetch({ include_completed: \"true\" })\n    const allProjects = completedProjectsResource.data || []\n    // Filter to only show completed projects\n    completedProjects.value = allProjects.filter(p => p.status === \"Completed\")\n    completedLoaded = true\n  } catch (error) {\n    console.error(\"Error loading completed projects:\", error)\n  } finally {\n    loading.value = false\n  }\n}\n\n// Watch for filter changes to load completed projects when needed\nwatch(statusFilter, (newValue) => {\n  if (newValue === \"completed\" && !completedLoaded) {\n    loadCompletedProjects()\n  }\n})\n\nfunction handleRefresh(event) {\n  // Reset completed cache on refresh\n  completedLoaded = false\n  completedProjects.value = []\n\n  loadData(true).finally(() => {\n    // If on completed tab, reload completed projects too\n    if (statusFilter.value === \"completed\") {\n      loadCompletedProjects().finally(() => {\n        event.target.complete()\n      })\n    } else {\n      event.target.complete()\n    }\n  })\n}\n\nfunction formatDate(dateStr) {\n  if (!dateStr) return \"-\"\n  return $dayjs(dateStr).format(\"MMM D, YYYY\")\n}\n\nfunction formatCurrency(amount) {\n  return new Intl.NumberFormat(\"en-IN\", {\n    style: \"currency\",\n    currency: \"INR\",\n  }).format(amount)\n}\n\nfunction getStatusClass(status) {\n  const map = {\n    Active: \"active\",\n    Planning: \"planning\",\n    Completed: \"completed\",\n    \"On Hold\": \"on-hold\",\n    Cancelled: \"cancelled\",\n  }\n  return map[status] || \"\"\n}\n\nfunction goToProject(id) {\n  router.push(`/smart-pro/project/${encodeURIComponent(id)}`)\n}\n\nonMounted(() => {\n  loadData()\n})\n\n// Reload data when navigating back to this tab\nonIonViewWillEnter(() => {\n  loadData()\n})\n</script>\n"],"names":["CACHE_TTL","router","useRouter","$dayjs","inject","loading","ref","searchQuery","statusFilter","projects","completedProjects","completedLoaded","projectsResource","createResource","completedProjectsResource","filteredProjects","computed","result","targetStatus","p","query","getEmptyMessage","lastLoadTime","loadData","forceRefresh","__async","now","error","loadCompletedProjects","allProjects","watch","newValue","handleRefresh","event","formatDate","dateStr","formatCurrency","amount","getStatusClass","status","goToProject","id","onMounted","onIonViewWillEnter","_createBlock","_unref","IonPage","_createVNode","IonHeader","IonToolbar","IonButtons","IonBackButton","IonTitle","_cache","IonSearchbar","$event","IonSegment","IonSegmentButton","IonLabel","IonContent","IonRefresher","IonRefresherContent","_openBlock","_createElementBlock","_hoisted_1","_Fragment","_renderList","i","_createElementVNode","_hoisted_2","IonIcon","folderOutline","_hoisted_3","_toDisplayString","_hoisted_4","project","_hoisted_6","_hoisted_7","_normalizeClass","_hoisted_8","_hoisted_9"],"mappings":"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"}