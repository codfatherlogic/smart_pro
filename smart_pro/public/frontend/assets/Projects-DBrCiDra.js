var x=(V,w,p)=>new Promise((b,g)=>{var i=r=>{try{n(p.next(r))}catch(d){g(d)}},f=r=>{try{n(p.throw(r))}catch(d){g(d)}},n=r=>r.done?b(r.value):Promise.resolve(r.value).then(i,f);n((p=p.apply(V,w)).next())});import{r as y,L as T,c as D,w as U,a as q,A as Q,q as o,t as a,z as E,M as W,i as G,l as c,n as s,v,k as m,F as S,O as F,x as u,y as _,N as J,P as K}from"./frappe-ui-5f3Xtay5.js";import{o as X,j as Z,k as L,m as ee,z as te,l as le,A as ae,B as se,C,e as h,u as oe,v as ne,w as re,d as ue,D as de,i as ce}from"./index-BtvF1KL1.js";import{u as ie}from"./usePermissions-DkJGg_er.js";const fe={key:0,class:"p-4"},me={key:1,class:"empty-state h-full"},pe={class:"empty-state-description"},ve={key:2,class:"p-4"},_e=["onClick"],ge={class:"flex justify-between items-start mb-2"},ye={class:"font-semibold text-gray-800"},Ce={class:"text-sm text-gray-500 mb-3"},he={key:0,class:"text-sm text-gray-600"},je=3e4,Pe={__name:"Projects",setup(V){const w=W(),p=G("$dayjs"),{fetchPermissions:b,hasFullAccess:g}=ie(),i=y(!0),f=y(""),n=y("active"),r=y([]),d=y([]);let j=!1;const B=T({url:"smart_pro.smart_pro.api.projects.get_user_projects",auto:!1}),N=T({url:"smart_pro.smart_pro.api.projects.get_user_projects",auto:!1}),R=D(()=>{let t=n.value==="completed"?d.value:r.value;if(n.value!=="all"&&n.value!=="completed"){const l={active:"Active",planning:"Planning","on-hold":"On Hold",cancelled:"Cancelled"}[n.value];t=t.filter(I=>I.status===l)}if(f.value){const e=f.value.toLowerCase();t=t.filter(l=>(l.title||l.name).toLowerCase().includes(e)||(l.status||"").toLowerCase().includes(e))}return t}),H=D(()=>f.value?"Try a different search term":n.value!=="all"?`No ${{active:"active",planning:"planning",completed:"completed","on-hold":"on hold",cancelled:"cancelled"}[n.value]} projects`:"Create your first project");let k=0;function P(t=!1){return x(this,null,function*(){const e=Date.now();if(!(!t&&k&&e-k<je&&r.value.length>0)){i.value=r.value.length===0;try{if(yield b(),g.value){const l=yield E("smart_pro.smart_pro.api.projects.get_all_projects");r.value=(l||[]).filter(I=>I.status!=="Completed")}else yield B.fetch(),r.value=B.data||[];k=e}catch(l){console.error("Error loading projects:",l)}finally{i.value=!1}}})}function A(){return x(this,null,function*(){if(!j){i.value=!0;try{if(g.value){const t=yield E("smart_pro.smart_pro.api.projects.get_all_projects");d.value=(t||[]).filter(e=>e.status==="Completed")}else{yield N.fetch({include_completed:"true"});const t=N.data||[];d.value=t.filter(e=>e.status==="Completed")}j=!0}catch(t){console.error("Error loading completed projects:",t)}finally{i.value=!1}}})}U(n,t=>{t==="completed"&&!j&&A()});function O(t){j=!1,d.value=[],P(!0).finally(()=>{n.value==="completed"?A().finally(()=>{t.target.complete()}):t.target.complete()})}function M(t){return t?p(t).format("MMM D, YYYY"):"-"}function $(t){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(t)}function Y(t){return{Active:"active",Planning:"planning",Completed:"completed","On Hold":"on-hold",Cancelled:"cancelled"}[t]||""}function z(t){w.push(`/smart-pro/project/${encodeURIComponent(t)}`)}return q(()=>{P()}),X(()=>{P()}),(t,e)=>(c(),Q(a(ce),null,{default:o(()=>[s(a(Z),null,{default:o(()=>[s(a(L),null,{default:o(()=>[s(a(ee),{slot:"start"},{default:o(()=>[s(a(te),{"default-href":"/smart-pro/home",text:""})]),_:1}),s(a(le),null,{default:o(()=>[...e[2]||(e[2]=[v("Projects",-1)])]),_:1})]),_:1}),s(a(L),null,{default:o(()=>[s(a(ae),{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=l=>f.value=l),placeholder:"Search projects...",debounce:300},null,8,["modelValue"])]),_:1}),s(a(L),null,{default:o(()=>[s(a(se),{modelValue:n.value,"onUpdate:modelValue":e[1]||(e[1]=l=>n.value=l),scrollable:""},{default:o(()=>[s(a(C),{value:"all"},{default:o(()=>[s(a(h),null,{default:o(()=>[...e[3]||(e[3]=[v("All",-1)])]),_:1})]),_:1}),s(a(C),{value:"active"},{default:o(()=>[s(a(h),null,{default:o(()=>[...e[4]||(e[4]=[v("Active",-1)])]),_:1})]),_:1}),s(a(C),{value:"planning"},{default:o(()=>[s(a(h),null,{default:o(()=>[...e[5]||(e[5]=[v("Planning",-1)])]),_:1})]),_:1}),s(a(C),{value:"completed"},{default:o(()=>[s(a(h),null,{default:o(()=>[...e[6]||(e[6]=[v("Completed",-1)])]),_:1})]),_:1}),s(a(C),{value:"on-hold"},{default:o(()=>[s(a(h),null,{default:o(()=>[...e[7]||(e[7]=[v("On Hold",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(a(oe),{fullscreen:!0},{default:o(()=>[s(a(ne),{slot:"fixed",onIonRefresh:O},{default:o(()=>[s(a(re))]),_:1}),i.value?(c(),m("div",fe,[(c(),m(S,null,F(5,l=>u("div",{key:l,class:"app-card mb-4 p-4"},[...e[8]||(e[8]=[u("div",{class:"skeleton h-5 w-3/4 mb-2"},null,-1),u("div",{class:"skeleton h-4 w-1/2 mb-2"},null,-1),u("div",{class:"skeleton h-3 w-full"},null,-1)])])),64))])):R.value.length===0?(c(),m("div",me,[s(a(ue),{icon:a(de),class:"empty-state-icon"},null,8,["icon"]),e[9]||(e[9]=u("div",{class:"empty-state-title"}," No projects found ",-1)),u("div",pe,_(H.value),1)])):(c(),m("div",ve,[(c(!0),m(S,null,F(R.value,l=>(c(),m("div",{key:l.name,class:"app-card mb-4 p-4",onClick:I=>z(l.name)},[u("div",ge,[u("h3",ye,_(l.title||l.name),1),u("span",{class:K(["status-badge",Y(l.status)])},_(l.status),3)]),u("div",Ce,_(M(l.start_date))+" - "+_(M(l.end_date)),1),l.budget_amount?(c(),m("div",he," Budget: "+_($(l.budget_amount)),1)):J("",!0)],8,_e))),128))]))]),_:1})]),_:1}))}};export{Pe as default};
//# sourceMappingURL=Projects-DBrCiDra.js.map
