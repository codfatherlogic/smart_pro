var x=(L,j,p)=>new Promise((b,v)=>{var i=r=>{try{n(p.next(r))}catch(d){v(d)}},f=r=>{try{n(p.throw(r))}catch(d){v(d)}},n=r=>r.done?b(r.value):Promise.resolve(r.value).then(i,f);n((p=p.apply(L,j)).next())});import{r as y,L as M,c as E,w as J,a as K,A as D,q as o,t,z as O,M as X,i as Z,l as c,n as s,N as S,v as _,k as m,F,O as H,x as u,y as g,P as ee}from"./frappe-ui-5f3Xtay5.js";import{o as te,j as le,k as B,m as $,z as ae,l as se,n as oe,d as Y,A as ne,B as re,C as ue,D as C,e as h,u as ce,v as de,w as ie,E as fe,i as me}from"./index-BdT8h_5n.js";import{u as pe}from"./usePermissions-DkJGg_er.js";const ve={key:0,class:"p-4"},_e={key:1,class:"empty-state h-full"},ge={class:"empty-state-description"},ye={key:2,class:"p-4"},Ce=["onClick"],he={class:"flex justify-between items-start mb-2"},je={class:"font-semibold text-gray-800"},Ie={class:"text-sm text-gray-500 mb-3"},we={key:0,class:"text-sm text-gray-600"},be=3e4,Le={__name:"Projects",setup(L){const j=X(),p=Z("$dayjs"),{fetchPermissions:b,hasFullAccess:v}=pe(),i=y(!0),f=y(""),n=y("active"),r=y([]),d=y([]);let I=!1;const V=M({url:"smart_pro.smart_pro.api.projects.get_user_projects",auto:!1}),N=M({url:"smart_pro.smart_pro.api.projects.get_user_projects",auto:!1}),R=E(()=>{let l=n.value==="completed"?d.value:r.value;if(n.value!=="all"&&n.value!=="completed"){const a={active:"Active",planning:"Planning","on-hold":"On Hold",cancelled:"Cancelled"}[n.value];l=l.filter(w=>w.status===a)}if(f.value){const e=f.value.toLowerCase();l=l.filter(a=>(a.title||a.name).toLowerCase().includes(e)||(a.status||"").toLowerCase().includes(e))}return l}),z=E(()=>f.value?"Try a different search term":n.value!=="all"?`No ${{active:"active",planning:"planning",completed:"completed","on-hold":"on hold",cancelled:"cancelled"}[n.value]} projects`:"Create your first project");let k=0;function P(l=!1){return x(this,null,function*(){const e=Date.now();if(!(!l&&k&&e-k<be&&r.value.length>0)){i.value=r.value.length===0;try{if(yield b(),v.value){const a=yield O("smart_pro.smart_pro.api.projects.get_all_projects");r.value=(a||[]).filter(w=>w.status!=="Completed")}else yield V.fetch(),r.value=V.data||[];k=e}catch(a){console.error("Error loading projects:",a)}finally{i.value=!1}}})}function T(){return x(this,null,function*(){if(!I){i.value=!0;try{if(v.value){const l=yield O("smart_pro.smart_pro.api.projects.get_all_projects");d.value=(l||[]).filter(e=>e.status==="Completed")}else{yield N.fetch({include_completed:"true"});const l=N.data||[];d.value=l.filter(e=>e.status==="Completed")}I=!0}catch(l){console.error("Error loading completed projects:",l)}finally{i.value=!1}}})}J(n,l=>{l==="completed"&&!I&&T()});function U(l){I=!1,d.value=[],P(!0).finally(()=>{n.value==="completed"?T().finally(()=>{l.target.complete()}):l.target.complete()})}function q(){j.push("/smart-pro/project/new")}function A(l){return l?p(l).format("MMM D, YYYY"):"-"}function Q(l){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(l)}function W(l){return{Active:"active",Planning:"planning",Completed:"completed","On Hold":"on-hold",Cancelled:"cancelled"}[l]||""}function G(l){j.push(`/smart-pro/project/${encodeURIComponent(l)}`)}return K(()=>{P()}),te(()=>{P()}),(l,e)=>(c(),D(t(me),null,{default:o(()=>[s(t(le),null,{default:o(()=>[s(t(B),null,{default:o(()=>[s(t($),{slot:"start"},{default:o(()=>[s(t(ae),{"default-href":"/smart-pro/home",text:""})]),_:1}),s(t(se),null,{default:o(()=>[...e[2]||(e[2]=[_("Projects",-1)])]),_:1}),t(v)?(c(),D(t($),{key:0,slot:"end"},{default:o(()=>[s(t(oe),{onClick:q},{default:o(()=>[s(t(Y),{icon:t(ne)},null,8,["icon"])]),_:1})]),_:1})):S("",!0)]),_:1}),s(t(B),null,{default:o(()=>[s(t(re),{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=a=>f.value=a),placeholder:"Search projects...",debounce:300},null,8,["modelValue"])]),_:1}),s(t(B),null,{default:o(()=>[s(t(ue),{modelValue:n.value,"onUpdate:modelValue":e[1]||(e[1]=a=>n.value=a),scrollable:""},{default:o(()=>[s(t(C),{value:"all"},{default:o(()=>[s(t(h),null,{default:o(()=>[...e[3]||(e[3]=[_("All",-1)])]),_:1})]),_:1}),s(t(C),{value:"active"},{default:o(()=>[s(t(h),null,{default:o(()=>[...e[4]||(e[4]=[_("Active",-1)])]),_:1})]),_:1}),s(t(C),{value:"planning"},{default:o(()=>[s(t(h),null,{default:o(()=>[...e[5]||(e[5]=[_("Planning",-1)])]),_:1})]),_:1}),s(t(C),{value:"completed"},{default:o(()=>[s(t(h),null,{default:o(()=>[...e[6]||(e[6]=[_("Completed",-1)])]),_:1})]),_:1}),s(t(C),{value:"on-hold"},{default:o(()=>[s(t(h),null,{default:o(()=>[...e[7]||(e[7]=[_("On Hold",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(t(ce),{fullscreen:!0},{default:o(()=>[s(t(de),{slot:"fixed",onIonRefresh:U},{default:o(()=>[s(t(ie))]),_:1}),i.value?(c(),m("div",ve,[(c(),m(F,null,H(5,a=>u("div",{key:a,class:"app-card mb-4 p-4"},[...e[8]||(e[8]=[u("div",{class:"skeleton h-5 w-3/4 mb-2"},null,-1),u("div",{class:"skeleton h-4 w-1/2 mb-2"},null,-1),u("div",{class:"skeleton h-3 w-full"},null,-1)])])),64))])):R.value.length===0?(c(),m("div",_e,[s(t(Y),{icon:t(fe),class:"empty-state-icon"},null,8,["icon"]),e[9]||(e[9]=u("div",{class:"empty-state-title"}," No projects found ",-1)),u("div",ge,g(z.value),1)])):(c(),m("div",ye,[(c(!0),m(F,null,H(R.value,a=>(c(),m("div",{key:a.name,class:"app-card mb-4 p-4",onClick:w=>G(a.name)},[u("div",he,[u("h3",je,g(a.title||a.name),1),u("span",{class:ee(["status-badge",W(a.status)])},g(a.status),3)]),u("div",Ie,g(A(a.start_date))+" - "+g(A(a.end_date)),1),a.budget_amount?(c(),m("div",we," Budget: "+g(Q(a.budget_amount)),1)):S("",!0)],8,Ce))),128))]))]),_:1})]),_:1}))}};export{Le as default};
//# sourceMappingURL=Projects-RrBRPdii.js.map
