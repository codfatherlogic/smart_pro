var i=(T,w,p)=>new Promise((v,m)=>{var c=r=>{try{f(p.next(r))}catch(g){m(g)}},s=r=>{try{f(p.throw(r))}catch(g){m(g)}},f=r=>r.done?v(r.value):Promise.resolve(r.value).then(c,s);f((p=p.apply(T,w)).next())});import{r as h,c as U,a as W,A as j,q as n,t as o,u as Y,z as P,M as $,i as L,l as u,n as l,v as y,k,N as x,x as t,y as d,P as I,Q as F}from"./frappe-ui-5f3Xtay5.js";import{j as q,k as Q,m as S,z as G,l as J,n as _,d as K,a8 as X,u as Z,v as ee,w as te,i as se,a9 as ae,a5 as B,a6 as oe,M as D}from"./index-Cn4F0kH1.js";const ne={key:0,class:"p-4"},le={key:1,class:"empty-state h-full"},re={class:"empty-state-description"},ie={key:2,class:"p-4"},de={class:"mb-6"},ue={class:"flex justify-between items-start mb-2"},ce={class:"text-2xl font-bold text-gray-800 flex-1 pr-2"},pe={key:0,class:"text-gray-600"},me={class:"app-card p-4 mb-6"},ve={class:"flex justify-between items-center mb-2"},fe={class:"text-primary-600 font-bold"},ge={class:"progress-bar h-3"},ye={key:0,class:"app-card p-4 mb-6"},ke=["innerHTML"],xe={class:"grid grid-cols-2 gap-4 mb-6"},_e={class:"app-card p-4"},be={class:"app-card p-4"},we={class:"app-card p-4"},Ce={class:"app-card p-4"},he={class:"font-medium"},je={class:"space-y-3"},Pe={__name:"TaskDetail",setup(T){const w=Y(),p=$(),v=L("$dayjs"),m=h(!0),c=h(""),s=h(null),f=U(()=>{var a;return(a=s.value)!=null&&a.due_date?v(s.value.due_date).isBefore(v(),"day"):!1});function r(){return i(this,null,function*(){const a=w.params.id;if(!a){c.value="Task not found";return}m.value=!0,c.value="";try{const e=yield P("frappe.client.get",{doctype:"Smart Task",name:a});s.value=e}catch(e){console.error("Error loading task:",e),c.value=e.message||"Failed to load task"}finally{m.value=!1}})}function g(a){r().finally(()=>{a.target.complete()})}function R(a){return a?v(a).format("MMM D, YYYY"):"-"}function N(a){return{Open:"planning",Working:"on-hold","Pending Review":"on-hold",Completed:"completed",Cancelled:"cancelled"}[a]||""}function A(a){return{Low:"text-green-600",Medium:"text-blue-600",High:"text-orange-600",Critical:"text-red-600"}[a]||"text-gray-600"}function E(){var a;(a=s.value)!=null&&a.project&&p.push(`/smart-pro/project/${encodeURIComponent(s.value.project)}`)}function O(){return i(this,null,function*(){var e;yield(yield B.create({header:"Update Progress",inputs:[{name:"progress",type:"number",placeholder:"Enter progress (0-100)",min:0,max:100,value:((e=s.value)==null?void 0:e.progress)||0}],buttons:[{text:"Cancel",role:"cancel"},{text:"Update",handler:b=>i(this,null,function*(){const M=Math.min(100,Math.max(0,parseInt(b.progress)||0));yield C({progress:M})})}]})).present()})}function V(){return i(this,null,function*(){yield C({status:"Working"})})}function z(){return i(this,null,function*(){yield(yield B.create({header:"Mark Complete",message:"Are you sure you want to mark this task as complete?",buttons:[{text:"Cancel",role:"cancel"},{text:"Complete",handler:()=>i(this,null,function*(){yield C({status:"Completed",progress:100})})}]})).present()})}function C(a){return i(this,null,function*(){const e=yield oe.create({message:"Saving..."});yield e.present();try{yield P("frappe.client.set_value",{doctype:"Smart Task",name:s.value.name,fieldname:a}),Object.assign(s.value,a),yield(yield D.create({message:"Task updated successfully",duration:2e3,color:"success"})).present()}catch(b){console.error("Error saving task:",b),yield(yield D.create({message:"Failed to update task",duration:2e3,color:"danger"})).present()}finally{yield e.dismiss()}})}function H(){return i(this,null,function*(){yield(yield ae.create({header:"Actions",buttons:[{text:"Open in Desktop",handler:()=>{window.open(`/app/smart-task/${s.value.name}`,"_blank")}},{text:"Cancel",role:"cancel"}]})).present()})}return W(()=>{r()}),(a,e)=>(u(),j(o(se),null,{default:n(()=>[l(o(q),null,{default:n(()=>[l(o(Q),null,{default:n(()=>[l(o(S),{slot:"start"},{default:n(()=>[l(o(G),{"default-href":"/smart-pro/tasks",text:""})]),_:1}),l(o(J),null,{default:n(()=>[...e[0]||(e[0]=[y("Task Details",-1)])]),_:1}),l(o(S),{slot:"end"},{default:n(()=>[l(o(_),{onClick:H},{default:n(()=>[l(o(K),{icon:o(X)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),l(o(Z),{fullscreen:!0},{default:n(()=>[l(o(ee),{slot:"fixed",onIonRefresh:g},{default:n(()=>[l(o(te))]),_:1}),m.value?(u(),k("div",ne,[...e[1]||(e[1]=[t("div",{class:"skeleton h-8 w-3/4 mb-4"},null,-1),t("div",{class:"skeleton h-4 w-1/2 mb-6"},null,-1),t("div",{class:"skeleton h-24 w-full mb-4"},null,-1)])])):c.value?(u(),k("div",le,[e[3]||(e[3]=t("div",{class:"empty-state-title"}," Error loading task ",-1)),t("div",re,d(c.value),1),l(o(_),{class:"mt-4",onClick:r},{default:n(()=>[...e[2]||(e[2]=[y(" Retry ",-1)])]),_:1})])):s.value?(u(),k("div",ie,[t("div",de,[t("div",ue,[t("h1",ce,d(s.value.title),1),t("span",{class:I(["status-badge",N(s.value.status)])},d(s.value.status),3)]),s.value.description?(u(),k("p",pe,d(s.value.description),1)):x("",!0)]),t("div",me,[t("div",ve,[e[4]||(e[4]=t("span",{class:"font-medium"},"Progress",-1)),t("span",fe,d(s.value.progress||0)+"%",1)]),t("div",ge,[t("div",{class:"progress-bar-fill",style:F({width:(s.value.progress||0)+"%"})},null,4)]),l(o(_),{expand:"block",fill:"outline",class:"mt-4",onClick:O},{default:n(()=>[...e[5]||(e[5]=[y(" Update Progress ",-1)])]),_:1})]),s.value.project_scope?(u(),k("div",ye,[e[6]||(e[6]=t("div",{class:"text-xs text-gray-500 mb-2 uppercase font-semibold"}," Project Scope ",-1)),t("div",{class:"text-gray-700 prose prose-sm max-w-none",innerHTML:s.value.project_scope},null,8,ke)])):x("",!0),t("div",xe,[t("div",_e,[e[7]||(e[7]=t("div",{class:"text-xs text-gray-500 mb-1"}," Project ",-1)),t("div",{class:"font-medium text-primary-600",onClick:E},d(s.value.project||"-"),1)]),t("div",be,[e[8]||(e[8]=t("div",{class:"text-xs text-gray-500 mb-1"}," Due Date ",-1)),t("div",{class:I(["font-medium",{"text-red-600":f.value}])},d(R(s.value.due_date)),3)]),t("div",we,[e[9]||(e[9]=t("div",{class:"text-xs text-gray-500 mb-1"}," Priority ",-1)),t("div",{class:I(["font-medium",A(s.value.priority)])},d(s.value.priority||"Normal"),3)]),t("div",Ce,[e[10]||(e[10]=t("div",{class:"text-xs text-gray-500 mb-1"}," Assigned To ",-1)),t("div",he,d(s.value.assigned_to||"-"),1)])]),t("div",je,[s.value.status!=="Completed"?(u(),j(o(_),{key:0,expand:"block",onClick:z},{default:n(()=>[...e[11]||(e[11]=[y(" Mark as Complete ",-1)])]),_:1})):x("",!0),s.value.status==="Open"?(u(),j(o(_),{key:1,expand:"block",fill:"outline",onClick:V},{default:n(()=>[...e[12]||(e[12]=[y(" Start Working ",-1)])]),_:1})):x("",!0)])])):x("",!0)]),_:1})]),_:1}))}};export{Pe as default};
//# sourceMappingURL=TaskDetail-DYClTo-l.js.map
