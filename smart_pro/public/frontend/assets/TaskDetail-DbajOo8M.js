var d=(T,h,m)=>new Promise((v,_)=>{var f=e=>{try{i(m.next(e))}catch(g){_(g)}},y=e=>{try{i(m.throw(e))}catch(g){_(g)}},i=e=>e.done?v(e.value):Promise.resolve(e.value).then(f,y);i((m=m.apply(T,h)).next())});import{r as I,c as Y,a as $,A as b,q as n,t as o,u as z,z as S,M as L,i as q,l as r,n as l,v as k,k as p,N as c,x as s,y as u,P,Q}from"./frappe-ui-5f3Xtay5.js";import{j as G,k as J,m as B,A as K,l as X,n as x,d as Z,a9 as tt,u as et,v as st,w as at,i as ot,aa as nt,P as D,a7 as lt,O as R}from"./index-CfzjP1Tk.js";import{u as rt}from"./usePermissions-DkJGg_er.js";const it={key:0,class:"p-4"},dt={key:1,class:"empty-state h-full"},ut={class:"empty-state-description"},ct={key:2,class:"p-4"},pt={class:"mb-6"},mt={class:"flex justify-between items-start mb-2"},vt={class:"text-2xl font-bold text-gray-800 flex-1 pr-2"},ft={key:0,class:"text-gray-600"},yt={class:"app-card p-4 mb-6"},gt={class:"flex justify-between items-center mb-2"},kt={class:"text-primary-600 font-bold"},xt={class:"progress-bar h-3"},_t={key:0,class:"app-card p-4 mb-6"},wt=["innerHTML"],bt={class:"grid grid-cols-2 gap-4 mb-6"},ht={class:"app-card p-4"},Ct={class:"app-card p-4"},jt={class:"app-card p-4"},It={class:"app-card p-4"},Pt={class:"font-medium"},Tt={key:1,class:"space-y-3"},Mt={key:2,class:"app-card p-4 mt-6"},At={__name:"TaskDetail",setup(T){const h=z(),{fetchPermissions:m,hasFullAccess:v}=rt(),_=L(),f=q("$dayjs"),y=I(!0),i=I(""),e=I(null),g=Y(()=>{var a;return(a=e.value)!=null&&a.due_date?f(e.value.due_date).isBefore(f(),"day"):!1});function C(){return d(this,null,function*(){const a=h.params.id;if(!a){i.value="Task not found";return}y.value=!0,i.value="";try{yield m();const t=yield S("frappe.client.get",{doctype:"Smart Task",name:a});e.value=t}catch(t){console.error("Error loading task:",t),i.value=t.message||"Failed to load task"}finally{y.value=!1}})}function A(a){C().finally(()=>{a.target.complete()})}function N(a){return a?f(a).format("MMM D, YYYY"):"-"}function O(a){return{Open:"planning",Working:"on-hold","Pending Review":"on-hold",Completed:"completed",Cancelled:"cancelled"}[a]||""}function V(a){return{Low:"text-green-600",Medium:"text-blue-600",High:"text-orange-600",Critical:"text-red-600"}[a]||"text-gray-600"}function E(){var a;(a=e.value)!=null&&a.project&&_.push(`/smart-pro/project/${encodeURIComponent(e.value.project)}`)}function F(){return d(this,null,function*(){var t;yield(yield D.create({header:"Update Progress",inputs:[{name:"progress",type:"number",placeholder:"Enter progress (0-100)",min:0,max:100,value:((t=e.value)==null?void 0:t.progress)||0}],buttons:[{text:"Cancel",role:"cancel"},{text:"Update",handler:w=>d(this,null,function*(){const M=Math.min(100,Math.max(0,parseInt(w.progress)||0));yield j({progress:M})})}]})).present()})}function H(){return d(this,null,function*(){yield j({status:"Working"})})}function U(){return d(this,null,function*(){yield(yield D.create({header:"Mark Complete",message:"Are you sure you want to mark this task as complete?",buttons:[{text:"Cancel",role:"cancel"},{text:"Complete",handler:()=>d(this,null,function*(){yield j({status:"Completed",progress:100})})}]})).present()})}function j(a){return d(this,null,function*(){const t=yield lt.create({message:"Saving..."});yield t.present();try{yield S("frappe.client.set_value",{doctype:"Smart Task",name:e.value.name,fieldname:a}),Object.assign(e.value,a),yield(yield R.create({message:"Task updated successfully",duration:2e3,color:"success"})).present()}catch(w){console.error("Error saving task:",w),yield(yield R.create({message:"Failed to update task",duration:2e3,color:"danger"})).present()}finally{yield t.dismiss()}})}function W(){return d(this,null,function*(){yield(yield nt.create({header:"Actions",buttons:[{text:"Open in Desktop",handler:()=>{window.open(`/app/smart-task/${e.value.name}`,"_blank")}},{text:"Cancel",role:"cancel"}]})).present()})}return $(()=>{C()}),(a,t)=>(r(),b(o(ot),null,{default:n(()=>[l(o(G),null,{default:n(()=>[l(o(J),null,{default:n(()=>[l(o(B),{slot:"start"},{default:n(()=>[l(o(K),{"default-href":"/smart-pro/tasks",text:""})]),_:1}),l(o(X),null,{default:n(()=>[...t[0]||(t[0]=[k("Task Details",-1)])]),_:1}),l(o(B),{slot:"end"},{default:n(()=>[l(o(x),{onClick:W},{default:n(()=>[l(o(Z),{icon:o(tt)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),l(o(et),{fullscreen:!0},{default:n(()=>[l(o(st),{slot:"fixed",onIonRefresh:A},{default:n(()=>[l(o(at))]),_:1}),y.value?(r(),p("div",it,[...t[1]||(t[1]=[s("div",{class:"skeleton h-8 w-3/4 mb-4"},null,-1),s("div",{class:"skeleton h-4 w-1/2 mb-6"},null,-1),s("div",{class:"skeleton h-24 w-full mb-4"},null,-1)])])):i.value?(r(),p("div",dt,[t[3]||(t[3]=s("div",{class:"empty-state-title"}," Error loading task ",-1)),s("div",ut,u(i.value),1),l(o(x),{class:"mt-4",onClick:C},{default:n(()=>[...t[2]||(t[2]=[k(" Retry ",-1)])]),_:1})])):e.value?(r(),p("div",ct,[s("div",pt,[s("div",mt,[s("h1",vt,u(e.value.title),1),s("span",{class:P(["status-badge",O(e.value.status)])},u(e.value.status),3)]),e.value.description?(r(),p("p",ft,u(e.value.description),1)):c("",!0)]),s("div",yt,[s("div",gt,[t[4]||(t[4]=s("span",{class:"font-medium"},"Progress",-1)),s("span",kt,u(e.value.progress||0)+"%",1)]),s("div",xt,[s("div",{class:"progress-bar-fill",style:Q({width:(e.value.progress||0)+"%"})},null,4)]),o(v)?c("",!0):(r(),b(o(x),{key:0,expand:"block",fill:"outline",class:"mt-4",onClick:F},{default:n(()=>[...t[5]||(t[5]=[k(" Update Progress ",-1)])]),_:1}))]),e.value.project_scope?(r(),p("div",_t,[t[6]||(t[6]=s("div",{class:"text-xs text-gray-500 mb-2 uppercase font-semibold"}," Project Scope ",-1)),s("div",{class:"text-gray-700 prose prose-sm max-w-none",innerHTML:e.value.project_scope},null,8,wt)])):c("",!0),s("div",bt,[s("div",ht,[t[7]||(t[7]=s("div",{class:"text-xs text-gray-500 mb-1"}," Project ",-1)),s("div",{class:"font-medium text-primary-600",onClick:E},u(e.value.project||"-"),1)]),s("div",Ct,[t[8]||(t[8]=s("div",{class:"text-xs text-gray-500 mb-1"}," Due Date ",-1)),s("div",{class:P(["font-medium",{"text-red-600":g.value}])},u(N(e.value.due_date)),3)]),s("div",jt,[t[9]||(t[9]=s("div",{class:"text-xs text-gray-500 mb-1"}," Priority ",-1)),s("div",{class:P(["font-medium",V(e.value.priority)])},u(e.value.priority||"Normal"),3)]),s("div",It,[t[10]||(t[10]=s("div",{class:"text-xs text-gray-500 mb-1"}," Assigned To ",-1)),s("div",Pt,u(e.value.assigned_to||"-"),1)])]),o(v)?c("",!0):(r(),p("div",Tt,[e.value.status!=="Completed"?(r(),b(o(x),{key:0,expand:"block",onClick:U},{default:n(()=>[...t[11]||(t[11]=[k(" Mark as Complete ",-1)])]),_:1})):c("",!0),e.value.status==="Open"?(r(),b(o(x),{key:1,expand:"block",fill:"outline",onClick:H},{default:n(()=>[...t[12]||(t[12]=[k(" Start Working ",-1)])]),_:1})):c("",!0)])),o(v)?(r(),p("div",Mt,[...t[13]||(t[13]=[s("div",{class:"text-sm text-gray-500 italic text-center"}," View only mode - Full access users cannot modify tasks ",-1)])])):c("",!0)])):c("",!0)]),_:1})]),_:1}))}};export{At as default};
//# sourceMappingURL=TaskDetail-DbajOo8M.js.map
