var O=(G,F,w)=>new Promise((H,L)=>{var V=p=>{try{r(w.next(p))}catch(g){L(g)}},k=p=>{try{r(w.throw(p))}catch(g){L(g)}},r=p=>p.done?H(p.value):Promise.resolve(p.value).then(V,k);r((w=w.apply(G,F)).next())});import{f as pe,r as v,c as ge,L as ye,a as ce,A as $,q as l,t,z as E,M as ke,i as xe,l as d,n as s,v as o,k as y,F as Q,O as X,x as u,y as m,N as _,P as Z,R as W,Q as _e}from"./frappe-ui-5f3Xtay5.js";import{o as be,j as q,k as S,m as z,z as we,l as A,B as Ce,C as B,e as c,u as Y,v as Te,w as Ie,d as h,f as Ve,n as j,t as De,E as ee,F as Me,G as te,H as f,J as se,K as le,L as Re,i as Pe,M as ae}from"./index-BtvF1KL1.js";import{u as je}from"./usePermissions-DkJGg_er.js";const Le={key:0,class:"p-4"},Oe={key:1,class:"empty-state h-full"},Se={class:"empty-state-description"},Be={key:2,class:"p-4"},Fe={class:"flex justify-between items-start mb-2"},He=["onClick"],Ue={class:"text-sm text-gray-500 mb-2"},Ne={key:0},$e={class:"flex items-center justify-between text-sm"},Ee={class:"text-gray-500"},We={class:"mt-3"},qe={class:"flex justify-between text-xs text-gray-500 mb-1"},ze=["onClick"],Ae={key:0,class:"mt-3 pt-3 border-t border-gray-100"},Ye={key:0,class:"mb-4"},Ge={class:"font-semibold text-lg mb-2"},Je={class:"text-sm text-gray-500"},Ke={class:"mb-6"},Qe={class:"flex items-center space-x-4"},Xe={class:"text-lg font-semibold w-16 text-center"},Ze={class:"mb-4"},he={key:1,class:"mt-4 p-3 bg-red-50 text-red-600 rounded-lg text-sm"},et={key:0,class:"mb-4"},tt={class:"font-semibold text-lg mb-2"},st={class:"text-sm text-gray-500"},lt={class:"mb-4"},at={class:"mb-4"},ot={class:"mb-4"},nt={class:"mb-4"},ut={key:0,class:"mt-4 p-3 bg-red-50 text-red-600 rounded-lg text-sm"},rt=3e4,it={__name:"Tasks",setup(G){const F=ke(),w=xe("$dayjs"),{fetchPermissions:H,hasFullAccess:L}=je(),V=v(!0),k=v("open"),r=v([]),p=v(!1),g=v(null),C=v(0),D=v("Open"),M=v(!1),T=v(""),R=v(!1),b=v(null),P=v(!1),I=v(""),i=v({date:"",hours_worked:"",activity_type:"Development",description:""}),J=ge(()=>k.value==="all"?r.value:k.value==="open"?r.value.filter(n=>n.status==="Open"):k.value==="working"?r.value.filter(n=>n.status==="Working"||n.status==="Pending Review"):k.value==="done"?r.value.filter(n=>n.status==="Completed"):r.value),K=ye({url:"smart_pro.smart_pro.api.projects.get_user_tasks",auto:!1});let U=0;function N(n=!1){return O(this,null,function*(){var a;const e=Date.now();if(!(!n&&U&&e-U<rt&&r.value.length>0)){V.value=r.value.length===0,T.value="";try{if(yield H(),L.value){const x=yield E("smart_pro.smart_pro.api.projects.get_all_tasks");r.value=x||[]}else yield K.fetch(),r.value=K.data||[];U=e}catch(x){console.error("Error loading tasks:",x),T.value=((a=x.messages)==null?void 0:a[0])||x.message||"Failed to load tasks"}finally{V.value=!1}}})}function oe(n){N(!0).finally(()=>{n.target.complete()})}function ne(n){if(!n)return"-";const e=w(n);return e.isToday()?"Today":e.isTomorrow()?"Tomorrow":e.format("MMM D")}function ue(n){return{Open:"planning",Working:"on-hold","Pending Review":"on-hold",Completed:"completed",Cancelled:"cancelled"}[n]||""}function re(n){return{Low:"text-green-600",Medium:"text-blue-600",High:"text-orange-600",Critical:"text-red-600"}[n]||"text-gray-600"}function ie(n){F.push(`/smart-pro/task/${encodeURIComponent(n)}`)}function de(n){g.value=n,C.value=n.progress||0,D.value=n.status||"Open",p.value=!0}function me(){return O(this,null,function*(){var n;if(g.value){M.value=!0,T.value="";try{yield E("frappe.client.set_value",{doctype:"Smart Task",name:g.value.name,fieldname:{progress:C.value,status:D.value}}),yield(yield ae.create({message:"Task updated successfully!",duration:2e3,color:"success"})).present();const a=r.value.findIndex(x=>x.name===g.value.name);a!==-1&&(r.value[a].progress=C.value,r.value[a].status=D.value),p.value=!1,g.value=null}catch(e){console.error("Error updating task:",e),T.value=((n=e.messages)==null?void 0:n[0])||e.message||"Failed to update task"}finally{M.value=!1}}})}function ve(n){b.value=n,i.value={date:w().format("YYYY-MM-DD"),hours_worked:"",activity_type:"Development",description:""},I.value="",R.value=!0}function fe(){return O(this,null,function*(){var n;if(b.value){if(!i.value.date||!i.value.hours_worked||!i.value.description){I.value="Date, hours, and description are required";return}P.value=!0,I.value="";try{yield E("smart_pro.smart_pro.api.projects.create_timesheet",{task:b.value.name,date:i.value.date,hours_worked:parseFloat(i.value.hours_worked),description:i.value.description,activity_type:i.value.activity_type,notes:null}),yield(yield ae.create({message:"Timesheet saved successfully!",duration:2e3,color:"success"})).present(),R.value=!1,b.value=null}catch(e){console.error("Error saving timesheet:",e),I.value=((n=e.messages)==null?void 0:n[0])||e.message||"Failed to save timesheet"}finally{P.value=!1}}})}return ce(()=>{console.log("Tasks component mounted - loading data"),N()}),be(()=>{console.log("Tasks view entering - reloading data"),N()}),(n,e)=>(d(),$(t(Pe),null,{default:l(()=>[s(t(q),null,{default:l(()=>[s(t(S),null,{default:l(()=>[s(t(z),{slot:"start"},{default:l(()=>[s(t(we),{"default-href":"/smart-pro/home",text:""})]),_:1}),s(t(A),null,{default:l(()=>[...e[11]||(e[11]=[o("My Tasks",-1)])]),_:1})]),_:1}),s(t(S),null,{default:l(()=>[s(t(Ce),{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=a=>k.value=a),scrollable:""},{default:l(()=>[s(t(B),{value:"all"},{default:l(()=>[s(t(c),null,{default:l(()=>[...e[12]||(e[12]=[o("All",-1)])]),_:1})]),_:1}),s(t(B),{value:"open"},{default:l(()=>[s(t(c),null,{default:l(()=>[...e[13]||(e[13]=[o("Open",-1)])]),_:1})]),_:1}),s(t(B),{value:"working"},{default:l(()=>[s(t(c),null,{default:l(()=>[...e[14]||(e[14]=[o("Working",-1)])]),_:1})]),_:1}),s(t(B),{value:"done"},{default:l(()=>[s(t(c),null,{default:l(()=>[...e[15]||(e[15]=[o("Done",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(t(Y),{fullscreen:!0},{default:l(()=>[s(t(Te),{slot:"fixed",onIonRefresh:oe},{default:l(()=>[s(t(Ie))]),_:1}),V.value?(d(),y("div",Le,[(d(),y(Q,null,X(5,a=>u("div",{key:a,class:"app-card mb-4 p-4"},[...e[16]||(e[16]=[u("div",{class:"skeleton h-5 w-3/4 mb-2"},null,-1),u("div",{class:"skeleton h-4 w-1/2 mb-2"},null,-1),u("div",{class:"skeleton h-2 w-full"},null,-1)])])),64))])):J.value.length===0?(d(),y("div",Oe,[s(t(h),{icon:t(Ve),class:"empty-state-icon"},null,8,["icon"]),e[17]||(e[17]=u("div",{class:"empty-state-title"}," No tasks ",-1)),u("div",Se,m(k.value==="done"?"No completed tasks yet":k.value==="open"?"No open tasks":k.value==="working"?"No tasks in progress":"No tasks assigned to you"),1)])):(d(),y("div",Be,[(d(!0),y(Q,null,X(J.value,a=>(d(),y("div",{key:a.name,class:"app-card mb-4 p-4"},[u("div",Fe,[u("h3",{class:"font-semibold text-gray-800 flex-1 pr-2",onClick:x=>ie(a.name)},m(a.title||a.name),9,He),u("span",{class:Z(["status-badge",ue(a.status)])},m(a.status),3)]),u("div",Ue,[a.project?(d(),y("span",Ne,"Project: "+m(a.project),1)):_("",!0)]),u("div",$e,[u("span",Ee,"Due: "+m(ne(a.due_date)),1),a.priority?(d(),y("span",{key:0,class:Z(["text-xs font-medium",re(a.priority)])},m(a.priority),3)):_("",!0)]),u("div",We,[u("div",qe,[e[18]||(e[18]=u("span",null,"Progress",-1)),u("span",null,m(a.progress||0)+"%",1)]),u("div",{class:"progress-bar",onClick:W(x=>de(a),["stop"])},[u("div",{class:"progress-bar-fill",style:_e({width:(a.progress||0)+"%"})},null,4)],8,ze),e[19]||(e[19]=u("div",{class:"text-xs text-gray-500 mt-1 text-center"}," Tap progress bar to update ",-1))]),a.status!=="Completed"?(d(),y("div",Ae,[s(t(j),{size:"small",expand:"block",fill:"outline",onClick:W(x=>ve(a),["stop"])},{default:l(()=>[s(t(h),{icon:t(De),slot:"start"},null,8,["icon"]),e[20]||(e[20]=o(" Log Hours ",-1))]),_:1},8,["onClick"])])):_("",!0)]))),128))]))]),_:1}),s(t(ee),{"is-open":p.value,onDidDismiss:e[4]||(e[4]=a=>p.value=!1)},{default:l(()=>[s(t(q),null,{default:l(()=>[s(t(S),null,{default:l(()=>[s(t(A),null,{default:l(()=>[...e[21]||(e[21]=[o("Update Progress",-1)])]),_:1}),s(t(z),{slot:"end"},{default:l(()=>[s(t(j),{onClick:e[1]||(e[1]=a=>p.value=!1)},{default:l(()=>[...e[22]||(e[22]=[o(" Close ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),s(t(Y),{class:"ion-padding"},{default:l(()=>[g.value?(d(),y("div",Ye,[u("h3",Ge,m(g.value.title||g.value.name),1),u("div",Je," Current progress: "+m(g.value.progress||0)+"% ",1)])):_("",!0),u("div",Ke,[s(t(c),{class:"block text-sm font-medium text-gray-700 mb-2"},{default:l(()=>[...e[23]||(e[23]=[o(" Set Progress (0-100%) ",-1)])]),_:1}),u("div",Qe,[s(t(Me),{modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=a=>C.value=a),min:0,max:100,step:5,color:"primary",class:"flex-1"},{start:l(()=>[s(t(c),null,{default:l(()=>[...e[24]||(e[24]=[o("0%",-1)])]),_:1})]),end:l(()=>[s(t(c),null,{default:l(()=>[...e[25]||(e[25]=[o("100%",-1)])]),_:1})]),_:1},8,["modelValue"]),u("div",Xe,m(C.value)+"% ",1)])]),u("div",Ze,[s(t(c),{class:"block text-sm font-medium text-gray-700 mb-2"},{default:l(()=>[...e[26]||(e[26]=[o(" Status ",-1)])]),_:1}),s(t(te),{modelValue:D.value,"onUpdate:modelValue":e[3]||(e[3]=a=>D.value=a),fill:"outline",interface:"action-sheet"},{default:l(()=>[s(t(f),{value:"Open"},{default:l(()=>[...e[27]||(e[27]=[o(" Open ",-1)])]),_:1}),s(t(f),{value:"Working"},{default:l(()=>[...e[28]||(e[28]=[o(" Working ",-1)])]),_:1}),s(t(f),{value:"Pending Review"},{default:l(()=>[...e[29]||(e[29]=[o(" Pending Review ",-1)])]),_:1}),s(t(f),{value:"Completed"},{default:l(()=>[...e[30]||(e[30]=[o(" Completed ",-1)])]),_:1})]),_:1},8,["modelValue"])]),s(t(j),{expand:"block",disabled:M.value,class:"mt-6",onClick:me},{default:l(()=>[M.value?(d(),$(t(se),{key:0,name:"crescent",class:"mr-2"})):_("",!0),o(" "+m(M.value?"Updating...":"Update Task"),1)]),_:1},8,["disabled"]),T.value?(d(),y("div",he,m(T.value),1)):_("",!0)]),_:1})]),_:1},8,["is-open"]),s(t(ee),{"is-open":R.value,onDidDismiss:e[10]||(e[10]=a=>R.value=!1)},{default:l(()=>[s(t(q),null,{default:l(()=>[s(t(S),null,{default:l(()=>[s(t(A),null,{default:l(()=>[...e[31]||(e[31]=[o("Log Hours",-1)])]),_:1}),s(t(z),{slot:"end"},{default:l(()=>[s(t(j),{onClick:e[5]||(e[5]=a=>R.value=!1)},{default:l(()=>[...e[32]||(e[32]=[o(" Close ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),s(t(Y),{class:"ion-padding"},{default:l(()=>[b.value?(d(),y("div",et,[u("h3",tt,m(b.value.title||b.value.name),1),u("div",st,m(b.value.project),1)])):_("",!0),u("form",{onSubmit:W(fe,["prevent"])},[u("div",lt,[s(t(c),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[33]||(e[33]=[o(" Date * ",-1)])]),_:1}),s(t(le),{modelValue:i.value.date,"onUpdate:modelValue":e[6]||(e[6]=a=>i.value.date=a),type:"date",fill:"outline",required:""},null,8,["modelValue"])]),u("div",at,[s(t(c),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[34]||(e[34]=[o(" Hours Worked * ",-1)])]),_:1}),s(t(le),{modelValue:i.value.hours_worked,"onUpdate:modelValue":e[7]||(e[7]=a=>i.value.hours_worked=a),type:"number",min:"0.5",max:"24",step:"0.5",placeholder:"e.g., 8",fill:"outline",required:""},null,8,["modelValue"])]),u("div",ot,[s(t(c),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[35]||(e[35]=[o(" Activity Type ",-1)])]),_:1}),s(t(te),{modelValue:i.value.activity_type,"onUpdate:modelValue":e[8]||(e[8]=a=>i.value.activity_type=a),interface:"action-sheet",fill:"outline"},{default:l(()=>[s(t(f),{value:"Development"},{default:l(()=>[...e[36]||(e[36]=[o("Development",-1)])]),_:1}),s(t(f),{value:"Design"},{default:l(()=>[...e[37]||(e[37]=[o("Design",-1)])]),_:1}),s(t(f),{value:"Testing"},{default:l(()=>[...e[38]||(e[38]=[o("Testing",-1)])]),_:1}),s(t(f),{value:"Documentation"},{default:l(()=>[...e[39]||(e[39]=[o("Documentation",-1)])]),_:1}),s(t(f),{value:"Meeting"},{default:l(()=>[...e[40]||(e[40]=[o("Meeting",-1)])]),_:1}),s(t(f),{value:"Research"},{default:l(()=>[...e[41]||(e[41]=[o("Research",-1)])]),_:1}),s(t(f),{value:"Bug Fix"},{default:l(()=>[...e[42]||(e[42]=[o("Bug Fix",-1)])]),_:1}),s(t(f),{value:"Code Review"},{default:l(()=>[...e[43]||(e[43]=[o("Code Review",-1)])]),_:1}),s(t(f),{value:"Deployment"},{default:l(()=>[...e[44]||(e[44]=[o("Deployment",-1)])]),_:1}),s(t(f),{value:"Other"},{default:l(()=>[...e[45]||(e[45]=[o("Other",-1)])]),_:1})]),_:1},8,["modelValue"])]),u("div",nt,[s(t(c),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[46]||(e[46]=[o(" Work Description * ",-1)])]),_:1}),s(t(Re),{modelValue:i.value.description,"onUpdate:modelValue":e[9]||(e[9]=a=>i.value.description=a),placeholder:"What did you work on?",fill:"outline",rows:3,required:""},null,8,["modelValue"])]),s(t(j),{expand:"block",type:"submit",disabled:P.value,class:"mt-6"},{default:l(()=>[P.value?(d(),$(t(se),{key:0,name:"crescent",class:"mr-2"})):_("",!0),o(" "+m(P.value?"Saving...":"Save Timesheet"),1)]),_:1},8,["disabled"]),I.value?(d(),y("div",ut,m(I.value),1)):_("",!0)],32)]),_:1})]),_:1},8,["is-open"])]),_:1}))}},pt=pe(it,[["__scopeId","data-v-b7406efb"]]);export{pt as default};
//# sourceMappingURL=Tasks-8Km5WZJm.js.map
