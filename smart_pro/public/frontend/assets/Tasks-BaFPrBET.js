var L=(J,F,C)=>new Promise((H,b)=>{var D=g=>{try{i(C.next(g))}catch(y){b(y)}},k=g=>{try{i(C.throw(g))}catch(y){b(y)}},i=g=>g.done?H(g.value):Promise.resolve(g.value).then(D,k);i((C=C.apply(J,F)).next())});import{f as fe,r as p,c as ge,L as ye,a as ce,A as $,q as l,t,z as E,M as ke,i as xe,l as r,n as s,v as o,k as v,F as X,O as Z,x as u,y as m,N as x,P as W,R as A,Q as _e}from"./frappe-ui-5f3Xtay5.js";import{o as be,j as q,k as S,m as z,A as we,l as Y,D as Ce,E as B,e as c,u as G,v as Te,w as Ie,d as h,f as Ve,n as O,t as De,G as ee,H as Me,J as te,K as f,L as se,M as le,N as Re,i as Pe,O as ae}from"./index-C-hcTcxK.js";import{u as je}from"./usePermissions-DkJGg_er.js";const Oe={key:0,class:"p-4"},Le={key:1,class:"empty-state h-full"},Se={class:"empty-state-description"},Be={key:2,class:"p-4"},Fe={class:"flex justify-between items-start mb-2"},He=["onClick"],Ne={class:"text-sm text-gray-500 mb-2"},Ue={key:0},$e={class:"flex items-center justify-between text-sm"},Ee={class:"text-gray-500"},We={class:"mt-3"},Ae={class:"flex justify-between text-xs text-gray-500 mb-1"},qe=["onClick"],ze={key:0,class:"text-xs text-gray-500 mt-1 text-center"},Ye={key:0,class:"mt-3 pt-3 border-t border-gray-100"},Ge={key:1,class:"mt-3 pt-3 border-t border-gray-100"},Je={key:0,class:"mb-4"},Ke={class:"font-semibold text-lg mb-2"},Qe={class:"text-sm text-gray-500"},Xe={class:"mb-6"},Ze={class:"flex items-center space-x-4"},he={class:"text-lg font-semibold w-16 text-center"},et={class:"mb-4"},tt={key:1,class:"mt-4 p-3 bg-red-50 text-red-600 rounded-lg text-sm"},st={key:0,class:"mb-4"},lt={class:"font-semibold text-lg mb-2"},at={class:"text-sm text-gray-500"},ot={class:"mb-4"},nt={class:"mb-4"},ut={class:"mb-4"},rt={class:"mb-4"},it={key:0,class:"mt-4 p-3 bg-red-50 text-red-600 rounded-lg text-sm"},dt=3e4,mt={__name:"Tasks",setup(J){const F=ke(),C=xe("$dayjs"),{fetchPermissions:H,hasFullAccess:b}=je(),D=p(!0),k=p("open"),i=p([]),g=p(!1),y=p(null),T=p(0),M=p("Open"),R=p(!1),I=p(""),P=p(!1),w=p(null),j=p(!1),V=p(""),d=p({date:"",hours_worked:"",activity_type:"Development",description:""}),K=ge(()=>k.value==="all"?i.value:k.value==="open"?i.value.filter(n=>n.status==="Open"):k.value==="working"?i.value.filter(n=>n.status==="Working"||n.status==="Pending Review"):k.value==="done"?i.value.filter(n=>n.status==="Completed"):i.value),Q=ye({url:"smart_pro.smart_pro.api.projects.get_user_tasks",auto:!1});let N=0;function U(n=!1){return L(this,null,function*(){var a;const e=Date.now();if(!(!n&&N&&e-N<dt&&i.value.length>0)){D.value=i.value.length===0,I.value="";try{if(yield H(),b.value){const _=yield E("smart_pro.smart_pro.api.projects.get_all_tasks");i.value=_||[]}else yield Q.fetch(),i.value=Q.data||[];N=e}catch(_){console.error("Error loading tasks:",_),I.value=((a=_.messages)==null?void 0:a[0])||_.message||"Failed to load tasks"}finally{D.value=!1}}})}function oe(n){U(!0).finally(()=>{n.target.complete()})}function ne(n){if(!n)return"-";const e=C(n);return e.isToday()?"Today":e.isTomorrow()?"Tomorrow":e.format("MMM D")}function ue(n){return{Open:"planning",Working:"on-hold","Pending Review":"on-hold",Completed:"completed",Cancelled:"cancelled"}[n]||""}function re(n){return{Low:"text-green-600",Medium:"text-blue-600",High:"text-orange-600",Critical:"text-red-600"}[n]||"text-gray-600"}function ie(n){F.push(`/smart-pro/task/${encodeURIComponent(n)}`)}function de(n){y.value=n,T.value=n.progress||0,M.value=n.status||"Open",g.value=!0}function me(){return L(this,null,function*(){var n;if(y.value){R.value=!0,I.value="";try{yield E("frappe.client.set_value",{doctype:"Smart Task",name:y.value.name,fieldname:{progress:T.value,status:M.value}}),yield(yield ae.create({message:"Task updated successfully!",duration:2e3,color:"success"})).present();const a=i.value.findIndex(_=>_.name===y.value.name);a!==-1&&(i.value[a].progress=T.value,i.value[a].status=M.value),g.value=!1,y.value=null}catch(e){console.error("Error updating task:",e),I.value=((n=e.messages)==null?void 0:n[0])||e.message||"Failed to update task"}finally{R.value=!1}}})}function ve(n){w.value=n,d.value={date:C().format("YYYY-MM-DD"),hours_worked:"",activity_type:"Development",description:""},V.value="",P.value=!0}function pe(){return L(this,null,function*(){var n;if(w.value){if(!d.value.date||!d.value.hours_worked||!d.value.description){V.value="Date, hours, and description are required";return}j.value=!0,V.value="";try{yield E("smart_pro.smart_pro.api.projects.create_timesheet",{task:w.value.name,date:d.value.date,hours_worked:parseFloat(d.value.hours_worked),description:d.value.description,activity_type:d.value.activity_type,notes:null}),yield(yield ae.create({message:"Timesheet saved successfully!",duration:2e3,color:"success"})).present(),P.value=!1,w.value=null}catch(e){console.error("Error saving timesheet:",e),V.value=((n=e.messages)==null?void 0:n[0])||e.message||"Failed to save timesheet"}finally{j.value=!1}}})}return ce(()=>{console.log("Tasks component mounted - loading data"),U()}),be(()=>{console.log("Tasks view entering - reloading data"),U()}),(n,e)=>(r(),$(t(Pe),null,{default:l(()=>[s(t(q),null,{default:l(()=>[s(t(S),null,{default:l(()=>[s(t(z),{slot:"start"},{default:l(()=>[s(t(we),{"default-href":"/smart-pro/home",text:""})]),_:1}),s(t(Y),null,{default:l(()=>[...e[11]||(e[11]=[o("My Tasks",-1)])]),_:1})]),_:1}),s(t(S),null,{default:l(()=>[s(t(Ce),{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=a=>k.value=a),scrollable:""},{default:l(()=>[s(t(B),{value:"all"},{default:l(()=>[s(t(c),null,{default:l(()=>[...e[12]||(e[12]=[o("All",-1)])]),_:1})]),_:1}),s(t(B),{value:"open"},{default:l(()=>[s(t(c),null,{default:l(()=>[...e[13]||(e[13]=[o("Open",-1)])]),_:1})]),_:1}),s(t(B),{value:"working"},{default:l(()=>[s(t(c),null,{default:l(()=>[...e[14]||(e[14]=[o("Working",-1)])]),_:1})]),_:1}),s(t(B),{value:"done"},{default:l(()=>[s(t(c),null,{default:l(()=>[...e[15]||(e[15]=[o("Done",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(t(G),{fullscreen:!0},{default:l(()=>[s(t(Te),{slot:"fixed",onIonRefresh:oe},{default:l(()=>[s(t(Ie))]),_:1}),D.value?(r(),v("div",Oe,[(r(),v(X,null,Z(5,a=>u("div",{key:a,class:"app-card mb-4 p-4"},[...e[16]||(e[16]=[u("div",{class:"skeleton h-5 w-3/4 mb-2"},null,-1),u("div",{class:"skeleton h-4 w-1/2 mb-2"},null,-1),u("div",{class:"skeleton h-2 w-full"},null,-1)])])),64))])):K.value.length===0?(r(),v("div",Le,[s(t(h),{icon:t(Ve),class:"empty-state-icon"},null,8,["icon"]),e[17]||(e[17]=u("div",{class:"empty-state-title"}," No tasks ",-1)),u("div",Se,m(k.value==="done"?"No completed tasks yet":k.value==="open"?"No open tasks":k.value==="working"?"No tasks in progress":"No tasks assigned to you"),1)])):(r(),v("div",Be,[(r(!0),v(X,null,Z(K.value,a=>(r(),v("div",{key:a.name,class:"app-card mb-4 p-4"},[u("div",Fe,[u("h3",{class:"font-semibold text-gray-800 flex-1 pr-2",onClick:_=>ie(a.name)},m(a.title||a.name),9,He),u("span",{class:W(["status-badge",ue(a.status)])},m(a.status),3)]),u("div",Ne,[a.project?(r(),v("span",Ue,"Project: "+m(a.project),1)):x("",!0)]),u("div",$e,[u("span",Ee,"Due: "+m(ne(a.due_date)),1),a.priority?(r(),v("span",{key:0,class:W(["text-xs font-medium",re(a.priority)])},m(a.priority),3)):x("",!0)]),u("div",We,[u("div",Ae,[e[18]||(e[18]=u("span",null,"Progress",-1)),u("span",null,m(a.progress||0)+"%",1)]),u("div",{class:W(["progress-bar",{"progress-bar-readonly":t(b)}]),onClick:A(_=>!t(b)&&de(a),["stop"])},[u("div",{class:"progress-bar-fill",style:_e({width:(a.progress||0)+"%"})},null,4)],10,qe),t(b)?x("",!0):(r(),v("div",ze," Tap progress bar to update "))]),a.status!=="Completed"&&!t(b)?(r(),v("div",Ye,[s(t(O),{size:"small",expand:"block",fill:"outline",onClick:A(_=>ve(a),["stop"])},{default:l(()=>[s(t(h),{icon:t(De),slot:"start"},null,8,["icon"]),e[19]||(e[19]=o(" Log Hours ",-1))]),_:1},8,["onClick"])])):x("",!0),a.status!=="Completed"&&t(b)?(r(),v("div",Ge,[...e[20]||(e[20]=[u("div",{class:"text-xs text-gray-500 italic text-center"}," View only mode - Full access users cannot log hours ",-1)])])):x("",!0)]))),128))]))]),_:1}),s(t(ee),{"is-open":g.value,onDidDismiss:e[4]||(e[4]=a=>g.value=!1)},{default:l(()=>[s(t(q),null,{default:l(()=>[s(t(S),null,{default:l(()=>[s(t(Y),null,{default:l(()=>[...e[21]||(e[21]=[o("Update Progress",-1)])]),_:1}),s(t(z),{slot:"end"},{default:l(()=>[s(t(O),{onClick:e[1]||(e[1]=a=>g.value=!1)},{default:l(()=>[...e[22]||(e[22]=[o(" Close ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),s(t(G),{class:"ion-padding"},{default:l(()=>[y.value?(r(),v("div",Je,[u("h3",Ke,m(y.value.title||y.value.name),1),u("div",Qe," Current progress: "+m(y.value.progress||0)+"% ",1)])):x("",!0),u("div",Xe,[s(t(c),{class:"block text-sm font-medium text-gray-700 mb-2"},{default:l(()=>[...e[23]||(e[23]=[o(" Set Progress (0-100%) ",-1)])]),_:1}),u("div",Ze,[s(t(Me),{modelValue:T.value,"onUpdate:modelValue":e[2]||(e[2]=a=>T.value=a),min:0,max:100,step:5,color:"primary",class:"flex-1"},{start:l(()=>[s(t(c),null,{default:l(()=>[...e[24]||(e[24]=[o("0%",-1)])]),_:1})]),end:l(()=>[s(t(c),null,{default:l(()=>[...e[25]||(e[25]=[o("100%",-1)])]),_:1})]),_:1},8,["modelValue"]),u("div",he,m(T.value)+"% ",1)])]),u("div",et,[s(t(c),{class:"block text-sm font-medium text-gray-700 mb-2"},{default:l(()=>[...e[26]||(e[26]=[o(" Status ",-1)])]),_:1}),s(t(te),{modelValue:M.value,"onUpdate:modelValue":e[3]||(e[3]=a=>M.value=a),fill:"outline",interface:"action-sheet"},{default:l(()=>[s(t(f),{value:"Open"},{default:l(()=>[...e[27]||(e[27]=[o(" Open ",-1)])]),_:1}),s(t(f),{value:"Working"},{default:l(()=>[...e[28]||(e[28]=[o(" Working ",-1)])]),_:1}),s(t(f),{value:"Pending Review"},{default:l(()=>[...e[29]||(e[29]=[o(" Pending Review ",-1)])]),_:1}),s(t(f),{value:"Completed"},{default:l(()=>[...e[30]||(e[30]=[o(" Completed ",-1)])]),_:1})]),_:1},8,["modelValue"])]),s(t(O),{expand:"block",disabled:R.value,class:"mt-6",onClick:me},{default:l(()=>[R.value?(r(),$(t(se),{key:0,name:"crescent",class:"mr-2"})):x("",!0),o(" "+m(R.value?"Updating...":"Update Task"),1)]),_:1},8,["disabled"]),I.value?(r(),v("div",tt,m(I.value),1)):x("",!0)]),_:1})]),_:1},8,["is-open"]),s(t(ee),{"is-open":P.value,onDidDismiss:e[10]||(e[10]=a=>P.value=!1)},{default:l(()=>[s(t(q),null,{default:l(()=>[s(t(S),null,{default:l(()=>[s(t(Y),null,{default:l(()=>[...e[31]||(e[31]=[o("Log Hours",-1)])]),_:1}),s(t(z),{slot:"end"},{default:l(()=>[s(t(O),{onClick:e[5]||(e[5]=a=>P.value=!1)},{default:l(()=>[...e[32]||(e[32]=[o(" Close ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),s(t(G),{class:"ion-padding"},{default:l(()=>[w.value?(r(),v("div",st,[u("h3",lt,m(w.value.title||w.value.name),1),u("div",at,m(w.value.project),1)])):x("",!0),u("form",{onSubmit:A(pe,["prevent"])},[u("div",ot,[s(t(c),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[33]||(e[33]=[o(" Date * ",-1)])]),_:1}),s(t(le),{modelValue:d.value.date,"onUpdate:modelValue":e[6]||(e[6]=a=>d.value.date=a),type:"date",fill:"outline",required:""},null,8,["modelValue"])]),u("div",nt,[s(t(c),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[34]||(e[34]=[o(" Hours Worked * ",-1)])]),_:1}),s(t(le),{modelValue:d.value.hours_worked,"onUpdate:modelValue":e[7]||(e[7]=a=>d.value.hours_worked=a),type:"number",min:"0.5",max:"24",step:"0.5",placeholder:"e.g., 8",fill:"outline",required:""},null,8,["modelValue"])]),u("div",ut,[s(t(c),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[35]||(e[35]=[o(" Activity Type ",-1)])]),_:1}),s(t(te),{modelValue:d.value.activity_type,"onUpdate:modelValue":e[8]||(e[8]=a=>d.value.activity_type=a),interface:"action-sheet",fill:"outline"},{default:l(()=>[s(t(f),{value:"Development"},{default:l(()=>[...e[36]||(e[36]=[o("Development",-1)])]),_:1}),s(t(f),{value:"Design"},{default:l(()=>[...e[37]||(e[37]=[o("Design",-1)])]),_:1}),s(t(f),{value:"Testing"},{default:l(()=>[...e[38]||(e[38]=[o("Testing",-1)])]),_:1}),s(t(f),{value:"Documentation"},{default:l(()=>[...e[39]||(e[39]=[o("Documentation",-1)])]),_:1}),s(t(f),{value:"Meeting"},{default:l(()=>[...e[40]||(e[40]=[o("Meeting",-1)])]),_:1}),s(t(f),{value:"Research"},{default:l(()=>[...e[41]||(e[41]=[o("Research",-1)])]),_:1}),s(t(f),{value:"Bug Fix"},{default:l(()=>[...e[42]||(e[42]=[o("Bug Fix",-1)])]),_:1}),s(t(f),{value:"Code Review"},{default:l(()=>[...e[43]||(e[43]=[o("Code Review",-1)])]),_:1}),s(t(f),{value:"Deployment"},{default:l(()=>[...e[44]||(e[44]=[o("Deployment",-1)])]),_:1}),s(t(f),{value:"Other"},{default:l(()=>[...e[45]||(e[45]=[o("Other",-1)])]),_:1})]),_:1},8,["modelValue"])]),u("div",rt,[s(t(c),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[46]||(e[46]=[o(" Work Description * ",-1)])]),_:1}),s(t(Re),{modelValue:d.value.description,"onUpdate:modelValue":e[9]||(e[9]=a=>d.value.description=a),placeholder:"What did you work on?",fill:"outline",rows:3,required:""},null,8,["modelValue"])]),s(t(O),{expand:"block",type:"submit",disabled:j.value,class:"mt-6"},{default:l(()=>[j.value?(r(),$(t(se),{key:0,name:"crescent",class:"mr-2"})):x("",!0),o(" "+m(j.value?"Saving...":"Save Timesheet"),1)]),_:1},8,["disabled"]),V.value?(r(),v("div",it,m(V.value),1)):x("",!0)],32)]),_:1})]),_:1},8,["is-open"])]),_:1}))}},yt=fe(mt,[["__scopeId","data-v-ccb3e15d"]]);export{yt as default};
//# sourceMappingURL=Tasks-BaFPrBET.js.map
