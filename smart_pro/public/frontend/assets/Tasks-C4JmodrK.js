var L=(z,B,C)=>new Promise((D,c)=>{var p=v=>{try{g(C.next(v))}catch(x){c(x)}},T=v=>{try{g(C.throw(v))}catch(x){c(x)}},g=v=>v.done?D(v.value):Promise.resolve(v.value).then(p,T);g((C=C.apply(z,B)).next())});import{f as me,r as m,c as fe,L as pe,a as ge,A as F,q as s,t,M as ye,i as ce,l as i,n as l,v as o,k as y,F as G,O as J,x as u,y as d,N as _,P as K,R as N,Q as ke,z as Q}from"./frappe-ui-5f3Xtay5.js";import{o as xe,j as $,k as O,m as E,z as _e,l as W,B as be,C as S,e as k,u as q,v as we,w as Ce,d as X,f as Te,n as j,t as Ie,E as Z,F as Ve,G as h,H as f,J as ee,K as te,L as De,i as Me,M as le}from"./index-Cn4F0kH1.js";const Re={key:0,class:"p-4"},Pe={key:1,class:"empty-state h-full"},je={class:"empty-state-description"},Le={key:2,class:"p-4"},Oe={class:"flex justify-between items-start mb-2"},Se=["onClick"],Be={class:"text-sm text-gray-500 mb-2"},He={key:0},Ue={class:"flex items-center justify-between text-sm"},Fe={class:"text-gray-500"},Ne={class:"mt-3"},$e={class:"flex justify-between text-xs text-gray-500 mb-1"},Ee=["onClick"],We={key:0,class:"mt-3 pt-3 border-t border-gray-100"},qe={key:0,class:"mb-4"},ze={class:"font-semibold text-lg mb-2"},Ae={class:"text-sm text-gray-500"},Ye={class:"mb-6"},Ge={class:"flex items-center space-x-4"},Je={class:"text-lg font-semibold w-16 text-center"},Ke={class:"mb-4"},Qe={key:1,class:"mt-4 p-3 bg-red-50 text-red-600 rounded-lg text-sm"},Xe={key:0,class:"mb-4"},Ze={class:"font-semibold text-lg mb-2"},he={class:"text-sm text-gray-500"},et={class:"mb-4"},tt={class:"mb-4"},lt={class:"mb-4"},st={class:"mb-4"},at={key:0,class:"mt-4 p-3 bg-red-50 text-red-600 rounded-lg text-sm"},ot=3e4,nt={__name:"Tasks",setup(z){const B=ye(),C=ce("$dayjs"),D=m(!0),c=m("open"),p=m([]),T=m(!1),g=m(null),v=m(0),x=m("Open"),M=m(!1),I=m(""),R=m(!1),b=m(null),P=m(!1),V=m(""),r=m({date:"",hours_worked:"",activity_type:"Development",description:""}),A=fe(()=>c.value==="all"?p.value:c.value==="open"?p.value.filter(n=>n.status==="Open"):c.value==="working"?p.value.filter(n=>n.status==="Working"||n.status==="Pending Review"):c.value==="done"?p.value.filter(n=>n.status==="Completed"):p.value),Y=pe({url:"smart_pro.smart_pro.api.projects.get_user_tasks",auto:!1});let H=0;function U(n=!1){return L(this,null,function*(){var a;const e=Date.now();if(!(!n&&H&&e-H<ot&&p.value.length>0)){D.value=p.value.length===0,I.value="";try{yield Y.fetch(),p.value=Y.data||[],H=e}catch(w){console.error("Error loading tasks:",w),I.value=((a=w.messages)==null?void 0:a[0])||w.message||"Failed to load tasks"}finally{D.value=!1}}})}function se(n){U(!0).finally(()=>{n.target.complete()})}function ae(n){if(!n)return"-";const e=C(n);return e.isToday()?"Today":e.isTomorrow()?"Tomorrow":e.format("MMM D")}function oe(n){return{Open:"planning",Working:"on-hold","Pending Review":"on-hold",Completed:"completed",Cancelled:"cancelled"}[n]||""}function ne(n){return{Low:"text-green-600",Medium:"text-blue-600",High:"text-orange-600",Critical:"text-red-600"}[n]||"text-gray-600"}function ue(n){B.push(`/smart-pro/task/${encodeURIComponent(n)}`)}function re(n){g.value=n,v.value=n.progress||0,x.value=n.status||"Open",T.value=!0}function ie(){return L(this,null,function*(){var n;if(g.value){M.value=!0,I.value="";try{yield Q("frappe.client.set_value",{doctype:"Smart Task",name:g.value.name,fieldname:{progress:v.value,status:x.value}}),yield(yield le.create({message:"Task updated successfully!",duration:2e3,color:"success"})).present();const a=p.value.findIndex(w=>w.name===g.value.name);a!==-1&&(p.value[a].progress=v.value,p.value[a].status=x.value),T.value=!1,g.value=null}catch(e){console.error("Error updating task:",e),I.value=((n=e.messages)==null?void 0:n[0])||e.message||"Failed to update task"}finally{M.value=!1}}})}function de(n){b.value=n,r.value={date:C().format("YYYY-MM-DD"),hours_worked:"",activity_type:"Development",description:""},V.value="",R.value=!0}function ve(){return L(this,null,function*(){var n;if(b.value){if(!r.value.date||!r.value.hours_worked||!r.value.description){V.value="Date, hours, and description are required";return}P.value=!0,V.value="";try{yield Q("smart_pro.smart_pro.api.projects.create_timesheet",{task:b.value.name,date:r.value.date,hours_worked:parseFloat(r.value.hours_worked),description:r.value.description,activity_type:r.value.activity_type,notes:null}),yield(yield le.create({message:"Timesheet saved successfully!",duration:2e3,color:"success"})).present(),R.value=!1,b.value=null}catch(e){console.error("Error saving timesheet:",e),V.value=((n=e.messages)==null?void 0:n[0])||e.message||"Failed to save timesheet"}finally{P.value=!1}}})}return ge(()=>{console.log("Tasks component mounted - loading data"),U()}),xe(()=>{console.log("Tasks view entering - reloading data"),U()}),(n,e)=>(i(),F(t(Me),null,{default:s(()=>[l(t($),null,{default:s(()=>[l(t(O),null,{default:s(()=>[l(t(E),{slot:"start"},{default:s(()=>[l(t(_e),{"default-href":"/smart-pro/home",text:""})]),_:1}),l(t(W),null,{default:s(()=>[...e[11]||(e[11]=[o("My Tasks",-1)])]),_:1})]),_:1}),l(t(O),null,{default:s(()=>[l(t(be),{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=a=>c.value=a),scrollable:""},{default:s(()=>[l(t(S),{value:"all"},{default:s(()=>[l(t(k),null,{default:s(()=>[...e[12]||(e[12]=[o("All",-1)])]),_:1})]),_:1}),l(t(S),{value:"open"},{default:s(()=>[l(t(k),null,{default:s(()=>[...e[13]||(e[13]=[o("Open",-1)])]),_:1})]),_:1}),l(t(S),{value:"working"},{default:s(()=>[l(t(k),null,{default:s(()=>[...e[14]||(e[14]=[o("Working",-1)])]),_:1})]),_:1}),l(t(S),{value:"done"},{default:s(()=>[l(t(k),null,{default:s(()=>[...e[15]||(e[15]=[o("Done",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(t(q),{fullscreen:!0},{default:s(()=>[l(t(we),{slot:"fixed",onIonRefresh:se},{default:s(()=>[l(t(Ce))]),_:1}),D.value?(i(),y("div",Re,[(i(),y(G,null,J(5,a=>u("div",{key:a,class:"app-card mb-4 p-4"},[...e[16]||(e[16]=[u("div",{class:"skeleton h-5 w-3/4 mb-2"},null,-1),u("div",{class:"skeleton h-4 w-1/2 mb-2"},null,-1),u("div",{class:"skeleton h-2 w-full"},null,-1)])])),64))])):A.value.length===0?(i(),y("div",Pe,[l(t(X),{icon:t(Te),class:"empty-state-icon"},null,8,["icon"]),e[17]||(e[17]=u("div",{class:"empty-state-title"}," No tasks ",-1)),u("div",je,d(c.value==="done"?"No completed tasks yet":c.value==="open"?"No open tasks":c.value==="working"?"No tasks in progress":"No tasks assigned to you"),1)])):(i(),y("div",Le,[(i(!0),y(G,null,J(A.value,a=>(i(),y("div",{key:a.name,class:"app-card mb-4 p-4"},[u("div",Oe,[u("h3",{class:"font-semibold text-gray-800 flex-1 pr-2",onClick:w=>ue(a.name)},d(a.title||a.name),9,Se),u("span",{class:K(["status-badge",oe(a.status)])},d(a.status),3)]),u("div",Be,[a.project?(i(),y("span",He,"Project: "+d(a.project),1)):_("",!0)]),u("div",Ue,[u("span",Fe,"Due: "+d(ae(a.due_date)),1),a.priority?(i(),y("span",{key:0,class:K(["text-xs font-medium",ne(a.priority)])},d(a.priority),3)):_("",!0)]),u("div",Ne,[u("div",$e,[e[18]||(e[18]=u("span",null,"Progress",-1)),u("span",null,d(a.progress||0)+"%",1)]),u("div",{class:"progress-bar",onClick:N(w=>re(a),["stop"])},[u("div",{class:"progress-bar-fill",style:ke({width:(a.progress||0)+"%"})},null,4)],8,Ee),e[19]||(e[19]=u("div",{class:"text-xs text-gray-500 mt-1 text-center"}," Tap progress bar to update ",-1))]),a.status!=="Completed"?(i(),y("div",We,[l(t(j),{size:"small",expand:"block",fill:"outline",onClick:N(w=>de(a),["stop"])},{default:s(()=>[l(t(X),{icon:t(Ie),slot:"start"},null,8,["icon"]),e[20]||(e[20]=o(" Log Hours ",-1))]),_:1},8,["onClick"])])):_("",!0)]))),128))]))]),_:1}),l(t(Z),{"is-open":T.value,onDidDismiss:e[4]||(e[4]=a=>T.value=!1)},{default:s(()=>[l(t($),null,{default:s(()=>[l(t(O),null,{default:s(()=>[l(t(W),null,{default:s(()=>[...e[21]||(e[21]=[o("Update Progress",-1)])]),_:1}),l(t(E),{slot:"end"},{default:s(()=>[l(t(j),{onClick:e[1]||(e[1]=a=>T.value=!1)},{default:s(()=>[...e[22]||(e[22]=[o(" Close ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),l(t(q),{class:"ion-padding"},{default:s(()=>[g.value?(i(),y("div",qe,[u("h3",ze,d(g.value.title||g.value.name),1),u("div",Ae," Current progress: "+d(g.value.progress||0)+"% ",1)])):_("",!0),u("div",Ye,[l(t(k),{class:"block text-sm font-medium text-gray-700 mb-2"},{default:s(()=>[...e[23]||(e[23]=[o(" Set Progress (0-100%) ",-1)])]),_:1}),u("div",Ge,[l(t(Ve),{modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=a=>v.value=a),min:0,max:100,step:5,color:"primary",class:"flex-1"},{start:s(()=>[l(t(k),null,{default:s(()=>[...e[24]||(e[24]=[o("0%",-1)])]),_:1})]),end:s(()=>[l(t(k),null,{default:s(()=>[...e[25]||(e[25]=[o("100%",-1)])]),_:1})]),_:1},8,["modelValue"]),u("div",Je,d(v.value)+"% ",1)])]),u("div",Ke,[l(t(k),{class:"block text-sm font-medium text-gray-700 mb-2"},{default:s(()=>[...e[26]||(e[26]=[o(" Status ",-1)])]),_:1}),l(t(h),{modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=a=>x.value=a),fill:"outline",interface:"action-sheet"},{default:s(()=>[l(t(f),{value:"Open"},{default:s(()=>[...e[27]||(e[27]=[o(" Open ",-1)])]),_:1}),l(t(f),{value:"Working"},{default:s(()=>[...e[28]||(e[28]=[o(" Working ",-1)])]),_:1}),l(t(f),{value:"Pending Review"},{default:s(()=>[...e[29]||(e[29]=[o(" Pending Review ",-1)])]),_:1}),l(t(f),{value:"Completed"},{default:s(()=>[...e[30]||(e[30]=[o(" Completed ",-1)])]),_:1})]),_:1},8,["modelValue"])]),l(t(j),{expand:"block",disabled:M.value,class:"mt-6",onClick:ie},{default:s(()=>[M.value?(i(),F(t(ee),{key:0,name:"crescent",class:"mr-2"})):_("",!0),o(" "+d(M.value?"Updating...":"Update Task"),1)]),_:1},8,["disabled"]),I.value?(i(),y("div",Qe,d(I.value),1)):_("",!0)]),_:1})]),_:1},8,["is-open"]),l(t(Z),{"is-open":R.value,onDidDismiss:e[10]||(e[10]=a=>R.value=!1)},{default:s(()=>[l(t($),null,{default:s(()=>[l(t(O),null,{default:s(()=>[l(t(W),null,{default:s(()=>[...e[31]||(e[31]=[o("Log Hours",-1)])]),_:1}),l(t(E),{slot:"end"},{default:s(()=>[l(t(j),{onClick:e[5]||(e[5]=a=>R.value=!1)},{default:s(()=>[...e[32]||(e[32]=[o(" Close ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),l(t(q),{class:"ion-padding"},{default:s(()=>[b.value?(i(),y("div",Xe,[u("h3",Ze,d(b.value.title||b.value.name),1),u("div",he,d(b.value.project),1)])):_("",!0),u("form",{onSubmit:N(ve,["prevent"])},[u("div",et,[l(t(k),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:s(()=>[...e[33]||(e[33]=[o(" Date * ",-1)])]),_:1}),l(t(te),{modelValue:r.value.date,"onUpdate:modelValue":e[6]||(e[6]=a=>r.value.date=a),type:"date",fill:"outline",required:""},null,8,["modelValue"])]),u("div",tt,[l(t(k),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:s(()=>[...e[34]||(e[34]=[o(" Hours Worked * ",-1)])]),_:1}),l(t(te),{modelValue:r.value.hours_worked,"onUpdate:modelValue":e[7]||(e[7]=a=>r.value.hours_worked=a),type:"number",min:"0.5",max:"24",step:"0.5",placeholder:"e.g., 8",fill:"outline",required:""},null,8,["modelValue"])]),u("div",lt,[l(t(k),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:s(()=>[...e[35]||(e[35]=[o(" Activity Type ",-1)])]),_:1}),l(t(h),{modelValue:r.value.activity_type,"onUpdate:modelValue":e[8]||(e[8]=a=>r.value.activity_type=a),interface:"action-sheet",fill:"outline"},{default:s(()=>[l(t(f),{value:"Development"},{default:s(()=>[...e[36]||(e[36]=[o("Development",-1)])]),_:1}),l(t(f),{value:"Design"},{default:s(()=>[...e[37]||(e[37]=[o("Design",-1)])]),_:1}),l(t(f),{value:"Testing"},{default:s(()=>[...e[38]||(e[38]=[o("Testing",-1)])]),_:1}),l(t(f),{value:"Documentation"},{default:s(()=>[...e[39]||(e[39]=[o("Documentation",-1)])]),_:1}),l(t(f),{value:"Meeting"},{default:s(()=>[...e[40]||(e[40]=[o("Meeting",-1)])]),_:1}),l(t(f),{value:"Research"},{default:s(()=>[...e[41]||(e[41]=[o("Research",-1)])]),_:1}),l(t(f),{value:"Bug Fix"},{default:s(()=>[...e[42]||(e[42]=[o("Bug Fix",-1)])]),_:1}),l(t(f),{value:"Code Review"},{default:s(()=>[...e[43]||(e[43]=[o("Code Review",-1)])]),_:1}),l(t(f),{value:"Deployment"},{default:s(()=>[...e[44]||(e[44]=[o("Deployment",-1)])]),_:1}),l(t(f),{value:"Other"},{default:s(()=>[...e[45]||(e[45]=[o("Other",-1)])]),_:1})]),_:1},8,["modelValue"])]),u("div",st,[l(t(k),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:s(()=>[...e[46]||(e[46]=[o(" Work Description * ",-1)])]),_:1}),l(t(De),{modelValue:r.value.description,"onUpdate:modelValue":e[9]||(e[9]=a=>r.value.description=a),placeholder:"What did you work on?",fill:"outline",rows:3,required:""},null,8,["modelValue"])]),l(t(j),{expand:"block",type:"submit",disabled:P.value,class:"mt-6"},{default:s(()=>[P.value?(i(),F(t(ee),{key:0,name:"crescent",class:"mr-2"})):_("",!0),o(" "+d(P.value?"Saving...":"Save Timesheet"),1)]),_:1},8,["disabled"]),V.value?(i(),y("div",at,d(V.value),1)):_("",!0)],32)]),_:1})]),_:1},8,["is-open"])]),_:1}))}},dt=me(nt,[["__scopeId","data-v-6c26fa3f"]]);export{dt as default};
//# sourceMappingURL=Tasks-C4JmodrK.js.map
