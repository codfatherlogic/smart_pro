var j=(q,L,w)=>new Promise((V,y)=>{var c=v=>{try{p(w.next(v))}catch(x){y(x)}},C=v=>{try{p(w.throw(v))}catch(x){y(x)}},p=v=>v.done?V(v.value):Promise.resolve(v.value).then(c,C);p((w=w.apply(q,L)).next())});import{f as ve,r as m,c as me,L as fe,a as pe,A as U,q as s,t,M as ge,i as ye,l as d,n as l,v as o,k as g,F as A,O as G,x as u,y as i,N as b,P as J,R as F,Q as ce,z as K}from"./frappe-ui-5f3Xtay5.js";import{E as ke,j as H,k as S,m as $,y as xe,l as W,F as be,G as B,e as k,r as E,d as Q,f as _e,n as P,t as we,w as Ce,x as Ie,H as X,J as Te,K as Z,L as f,M as h,N as ee,O as Ve,i as De,P as te}from"./index-BT8PkI2H.js";const Re={key:0,class:"p-4"},Me={key:1,class:"empty-state h-full"},Pe={class:"empty-state-description"},Oe={key:2,class:"p-4"},je={class:"flex justify-between items-start mb-2"},Se=["onClick"],Be={class:"text-sm text-gray-500 mb-2"},Le={key:0},Ne={class:"flex items-center justify-between text-sm"},Ue={class:"text-gray-500"},Fe={class:"mt-3"},He={class:"flex justify-between text-xs text-gray-500 mb-1"},$e=["onClick"],We={key:0,class:"mt-3 pt-3 border-t border-gray-100"},Ee={key:0,class:"mb-4"},qe={class:"font-semibold text-lg mb-2"},ze={class:"text-sm text-gray-500"},Ye={class:"mb-6"},Ae={class:"flex items-center space-x-4"},Ge={class:"text-lg font-semibold w-16 text-center"},Je={class:"mb-4"},Ke={key:1,class:"mt-4 p-3 bg-red-50 text-red-600 rounded-lg text-sm"},Qe={key:0,class:"mb-4"},Xe={class:"font-semibold text-lg mb-2"},Ze={class:"text-sm text-gray-500"},he={class:"mb-4"},et={class:"mb-4"},tt={class:"mb-4"},lt={class:"mb-4"},st={key:0,class:"mt-4 p-3 bg-red-50 text-red-600 rounded-lg text-sm"},at={__name:"Tasks",setup(q){const L=ge(),w=ye("$dayjs"),V=m(!0),y=m("all"),c=m([]),C=m(!1),p=m(null),v=m(0),x=m("Open"),D=m(!1),I=m(""),R=m(!1),_=m(null),M=m(!1),T=m(""),r=m({date:"",hours_worked:"",activity_type:"Development",description:""}),z=me(()=>y.value==="all"?c.value:y.value==="open"?c.value.filter(n=>n.status==="Open"):y.value==="working"?c.value.filter(n=>n.status==="Working"||n.status==="Pending Review"):y.value==="done"?c.value.filter(n=>n.status==="Completed"):c.value),Y=fe({url:"smart_pro.smart_pro.api.projects.get_user_tasks",auto:!1});function N(){return j(this,null,function*(){var n;V.value=!0,I.value="";try{yield Y.fetch(),c.value=Y.data||[],console.log("Tasks loaded via createResource:",c.value.length,"tasks")}catch(e){console.error("Error loading tasks:",e),I.value=((n=e.messages)==null?void 0:n[0])||e.message||"Failed to load tasks"}finally{V.value=!1}})}function le(n){N().finally(()=>{n.target.complete()})}function se(n){if(!n)return"-";const e=w(n);return e.isToday()?"Today":e.isTomorrow()?"Tomorrow":e.format("MMM D")}function ae(n){return{Open:"planning",Working:"on-hold","Pending Review":"on-hold",Completed:"completed",Cancelled:"cancelled"}[n]||""}function oe(n){return{Low:"text-green-600",Medium:"text-blue-600",High:"text-orange-600",Critical:"text-red-600"}[n]||"text-gray-600"}function ne(n){L.push(`/smart-pro/task/${encodeURIComponent(n)}`)}function ue(n){p.value=n,v.value=n.progress||0,x.value=n.status||"Open",C.value=!0}function re(){return j(this,null,function*(){var n;if(p.value){D.value=!0,I.value="";try{yield K("frappe.client.set_value",{doctype:"Smart Task",name:p.value.name,fieldname:{progress:v.value,status:x.value}}),yield(yield te.create({message:"Task updated successfully!",duration:2e3,color:"success"})).present();const a=c.value.findIndex(O=>O.name===p.value.name);a!==-1&&(c.value[a].progress=v.value,c.value[a].status=x.value),C.value=!1,p.value=null}catch(e){console.error("Error updating task:",e),I.value=((n=e.messages)==null?void 0:n[0])||e.message||"Failed to update task"}finally{D.value=!1}}})}function de(n){_.value=n,r.value={date:w().format("YYYY-MM-DD"),hours_worked:"",activity_type:"Development",description:""},T.value="",R.value=!0}function ie(){return j(this,null,function*(){var n;if(_.value){if(!r.value.date||!r.value.hours_worked||!r.value.description){T.value="Date, hours, and description are required";return}M.value=!0,T.value="";try{yield K("smart_pro.smart_pro.api.projects.create_timesheet",{task:_.value.name,date:r.value.date,hours_worked:parseFloat(r.value.hours_worked),description:r.value.description,activity_type:r.value.activity_type,notes:null}),yield(yield te.create({message:"Timesheet saved successfully!",duration:2e3,color:"success"})).present(),R.value=!1,_.value=null}catch(e){console.error("Error saving timesheet:",e),T.value=((n=e.messages)==null?void 0:n[0])||e.message||"Failed to save timesheet"}finally{M.value=!1}}})}return pe(()=>{console.log("Tasks component mounted - loading data"),N()}),ke(()=>{console.log("Tasks view entering - reloading data"),N()}),(n,e)=>(d(),U(t(De),null,{default:s(()=>[l(t(H),null,{default:s(()=>[l(t(S),null,{default:s(()=>[l(t($),{slot:"start"},{default:s(()=>[l(t(xe),{"default-href":"/smart-pro/home",text:""})]),_:1}),l(t(W),null,{default:s(()=>[...e[11]||(e[11]=[o("My Tasks",-1)])]),_:1})]),_:1}),l(t(S),null,{default:s(()=>[l(t(be),{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=a=>y.value=a),scrollable:""},{default:s(()=>[l(t(B),{value:"all"},{default:s(()=>[l(t(k),null,{default:s(()=>[...e[12]||(e[12]=[o("All",-1)])]),_:1})]),_:1}),l(t(B),{value:"open"},{default:s(()=>[l(t(k),null,{default:s(()=>[...e[13]||(e[13]=[o("Open",-1)])]),_:1})]),_:1}),l(t(B),{value:"working"},{default:s(()=>[l(t(k),null,{default:s(()=>[...e[14]||(e[14]=[o("Working",-1)])]),_:1})]),_:1}),l(t(B),{value:"done"},{default:s(()=>[l(t(k),null,{default:s(()=>[...e[15]||(e[15]=[o("Done",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(t(E),{fullscreen:!0},{fixed:s(()=>[l(t(Ce),{onIonRefresh:le},{default:s(()=>[l(t(Ie))]),_:1})]),default:s(()=>[V.value?(d(),g("div",Re,[(d(),g(A,null,G(5,a=>u("div",{key:a,class:"app-card mb-4 p-4"},[...e[16]||(e[16]=[u("div",{class:"skeleton h-5 w-3/4 mb-2"},null,-1),u("div",{class:"skeleton h-4 w-1/2 mb-2"},null,-1),u("div",{class:"skeleton h-2 w-full"},null,-1)])])),64))])):z.value.length===0?(d(),g("div",Me,[l(t(Q),{icon:t(_e),class:"empty-state-icon"},null,8,["icon"]),e[17]||(e[17]=u("div",{class:"empty-state-title"}," No tasks ",-1)),u("div",Pe,i(y.value==="done"?"No completed tasks yet":y.value==="open"?"No open tasks":y.value==="working"?"No tasks in progress":"No tasks assigned to you"),1)])):(d(),g("div",Oe,[(d(!0),g(A,null,G(z.value,a=>(d(),g("div",{key:a.name,class:"app-card mb-4 p-4"},[u("div",je,[u("h3",{class:"font-semibold text-gray-800 flex-1 pr-2",onClick:O=>ne(a.name)},i(a.title||a.name),9,Se),u("span",{class:J(["status-badge",ae(a.status)])},i(a.status),3)]),u("div",Be,[a.project?(d(),g("span",Le,"Project: "+i(a.project),1)):b("",!0)]),u("div",Ne,[u("span",Ue,"Due: "+i(se(a.due_date)),1),a.priority?(d(),g("span",{key:0,class:J(["text-xs font-medium",oe(a.priority)])},i(a.priority),3)):b("",!0)]),u("div",Fe,[u("div",He,[e[18]||(e[18]=u("span",null,"Progress",-1)),u("span",null,i(a.progress||0)+"%",1)]),u("div",{class:"progress-bar",onClick:F(O=>ue(a),["stop"])},[u("div",{class:"progress-bar-fill",style:ce({width:(a.progress||0)+"%"})},null,4)],8,$e),e[19]||(e[19]=u("div",{class:"text-xs text-gray-500 mt-1 text-center"}," Tap progress bar to update ",-1))]),a.status!=="Completed"?(d(),g("div",We,[l(t(P),{size:"small",expand:"block",fill:"outline",onClick:F(O=>de(a),["stop"])},{default:s(()=>[l(t(Q),{icon:t(we),slot:"start"},null,8,["icon"]),e[20]||(e[20]=o(" Log Hours ",-1))]),_:1},8,["onClick"])])):b("",!0)]))),128))]))]),_:1}),l(t(X),{"is-open":C.value,onDidDismiss:e[4]||(e[4]=a=>C.value=!1)},{default:s(()=>[l(t(H),null,{default:s(()=>[l(t(S),null,{default:s(()=>[l(t(W),null,{default:s(()=>[...e[21]||(e[21]=[o("Update Progress",-1)])]),_:1}),l(t($),{slot:"end"},{default:s(()=>[l(t(P),{onClick:e[1]||(e[1]=a=>C.value=!1)},{default:s(()=>[...e[22]||(e[22]=[o(" Close ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),l(t(E),{class:"ion-padding"},{default:s(()=>[p.value?(d(),g("div",Ee,[u("h3",qe,i(p.value.title||p.value.name),1),u("div",ze," Current progress: "+i(p.value.progress||0)+"% ",1)])):b("",!0),u("div",Ye,[l(t(k),{class:"block text-sm font-medium text-gray-700 mb-2"},{default:s(()=>[...e[23]||(e[23]=[o(" Set Progress (0-100%) ",-1)])]),_:1}),u("div",Ae,[l(t(Te),{modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=a=>v.value=a),min:0,max:100,step:5,color:"primary",class:"flex-1"},{start:s(()=>[l(t(k),null,{default:s(()=>[...e[24]||(e[24]=[o("0%",-1)])]),_:1})]),end:s(()=>[l(t(k),null,{default:s(()=>[...e[25]||(e[25]=[o("100%",-1)])]),_:1})]),_:1},8,["modelValue"]),u("div",Ge,i(v.value)+"% ",1)])]),u("div",Je,[l(t(k),{class:"block text-sm font-medium text-gray-700 mb-2"},{default:s(()=>[...e[26]||(e[26]=[o(" Status ",-1)])]),_:1}),l(t(Z),{modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=a=>x.value=a),fill:"outline",interface:"action-sheet"},{default:s(()=>[l(t(f),{value:"Open"},{default:s(()=>[...e[27]||(e[27]=[o(" Open ",-1)])]),_:1}),l(t(f),{value:"Working"},{default:s(()=>[...e[28]||(e[28]=[o(" Working ",-1)])]),_:1}),l(t(f),{value:"Pending Review"},{default:s(()=>[...e[29]||(e[29]=[o(" Pending Review ",-1)])]),_:1}),l(t(f),{value:"Completed"},{default:s(()=>[...e[30]||(e[30]=[o(" Completed ",-1)])]),_:1})]),_:1},8,["modelValue"])]),l(t(P),{expand:"block",disabled:D.value,class:"mt-6",onClick:re},{default:s(()=>[D.value?(d(),U(t(h),{key:0,name:"crescent",class:"mr-2"})):b("",!0),o(" "+i(D.value?"Updating...":"Update Task"),1)]),_:1},8,["disabled"]),I.value?(d(),g("div",Ke,i(I.value),1)):b("",!0)]),_:1})]),_:1},8,["is-open"]),l(t(X),{"is-open":R.value,onDidDismiss:e[10]||(e[10]=a=>R.value=!1)},{default:s(()=>[l(t(H),null,{default:s(()=>[l(t(S),null,{default:s(()=>[l(t(W),null,{default:s(()=>[...e[31]||(e[31]=[o("Log Hours",-1)])]),_:1}),l(t($),{slot:"end"},{default:s(()=>[l(t(P),{onClick:e[5]||(e[5]=a=>R.value=!1)},{default:s(()=>[...e[32]||(e[32]=[o(" Close ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),l(t(E),{class:"ion-padding"},{default:s(()=>[_.value?(d(),g("div",Qe,[u("h3",Xe,i(_.value.title||_.value.name),1),u("div",Ze,i(_.value.project),1)])):b("",!0),u("form",{onSubmit:F(ie,["prevent"])},[u("div",he,[l(t(k),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:s(()=>[...e[33]||(e[33]=[o(" Date * ",-1)])]),_:1}),l(t(ee),{modelValue:r.value.date,"onUpdate:modelValue":e[6]||(e[6]=a=>r.value.date=a),type:"date",fill:"outline",required:""},null,8,["modelValue"])]),u("div",et,[l(t(k),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:s(()=>[...e[34]||(e[34]=[o(" Hours Worked * ",-1)])]),_:1}),l(t(ee),{modelValue:r.value.hours_worked,"onUpdate:modelValue":e[7]||(e[7]=a=>r.value.hours_worked=a),type:"number",min:"0.5",max:"24",step:"0.5",placeholder:"e.g., 8",fill:"outline",required:""},null,8,["modelValue"])]),u("div",tt,[l(t(k),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:s(()=>[...e[35]||(e[35]=[o(" Activity Type ",-1)])]),_:1}),l(t(Z),{modelValue:r.value.activity_type,"onUpdate:modelValue":e[8]||(e[8]=a=>r.value.activity_type=a),interface:"action-sheet",fill:"outline"},{default:s(()=>[l(t(f),{value:"Development"},{default:s(()=>[...e[36]||(e[36]=[o("Development",-1)])]),_:1}),l(t(f),{value:"Design"},{default:s(()=>[...e[37]||(e[37]=[o("Design",-1)])]),_:1}),l(t(f),{value:"Testing"},{default:s(()=>[...e[38]||(e[38]=[o("Testing",-1)])]),_:1}),l(t(f),{value:"Documentation"},{default:s(()=>[...e[39]||(e[39]=[o("Documentation",-1)])]),_:1}),l(t(f),{value:"Meeting"},{default:s(()=>[...e[40]||(e[40]=[o("Meeting",-1)])]),_:1}),l(t(f),{value:"Research"},{default:s(()=>[...e[41]||(e[41]=[o("Research",-1)])]),_:1}),l(t(f),{value:"Bug Fix"},{default:s(()=>[...e[42]||(e[42]=[o("Bug Fix",-1)])]),_:1}),l(t(f),{value:"Code Review"},{default:s(()=>[...e[43]||(e[43]=[o("Code Review",-1)])]),_:1}),l(t(f),{value:"Deployment"},{default:s(()=>[...e[44]||(e[44]=[o("Deployment",-1)])]),_:1}),l(t(f),{value:"Other"},{default:s(()=>[...e[45]||(e[45]=[o("Other",-1)])]),_:1})]),_:1},8,["modelValue"])]),u("div",lt,[l(t(k),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:s(()=>[...e[46]||(e[46]=[o(" Work Description * ",-1)])]),_:1}),l(t(Ve),{modelValue:r.value.description,"onUpdate:modelValue":e[9]||(e[9]=a=>r.value.description=a),placeholder:"What did you work on?",fill:"outline",rows:3,required:""},null,8,["modelValue"])]),l(t(P),{expand:"block",type:"submit",disabled:M.value,class:"mt-6"},{default:s(()=>[M.value?(d(),U(t(h),{key:0,name:"crescent",class:"mr-2"})):b("",!0),o(" "+i(M.value?"Saving...":"Save Timesheet"),1)]),_:1},8,["disabled"]),T.value?(d(),g("div",st,i(T.value),1)):b("",!0)],32)]),_:1})]),_:1},8,["is-open"])]),_:1}))}},rt=ve(at,[["__scopeId","data-v-04983c55"]]);export{rt as default};
//# sourceMappingURL=Tasks-CYFxCgYR.js.map
