var C=(U,S,b)=>new Promise((g,k)=>{var x=r=>{try{v(b.next(r))}catch(w){k(w)}},y=r=>{try{v(b.throw(r))}catch(w){k(w)}},v=r=>r.done?g(r.value):Promise.resolve(r.value).then(x,y);v((b=b.apply(U,S)).next())});import{f as ae,r as c,c as le,a as oe,A as j,q as a,t,z as V,i as ue,l as d,n as s,v as o,x as u,k as p,y as m,F as A,O as N,N as I,P as ne,R as ie}from"./frappe-ui-5f3Xtay5.js";import{j as q,k as F,m as O,y as de,l as E,n as D,d as h,z as re,F as me,G as M,e as _,r as $,t as z,g as ve,B as pe,M as P,w as fe,x as ce,H as _e,K as W,L as f,N as G,O as K,i as ye,P as Y}from"./index-BT8PkI2H.js";const be={class:"p-4 pb-0"},ke={class:"app-card p-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white"},ge={class:"flex justify-between items-end"},xe={class:"text-3xl font-bold"},we={class:"text-right"},Ie={class:"text-sm opacity-90"},Ve={key:0,class:"p-4"},De={key:1,class:"empty-state h-full"},he={class:"empty-state-description"},Se={key:2,class:"p-4"},Te={class:"flex justify-between items-start mb-2"},Ce={class:"font-semibold text-gray-800"},je={class:"text-sm text-gray-500 mb-2"},Me={class:"flex items-center justify-between text-sm"},Re={class:"text-gray-600"},Be={class:"px-2 py-1 bg-gray-100 rounded text-xs text-gray-600"},Ae={key:0,class:"mt-2 text-sm text-blue-600"},Ne={key:1,class:"mt-2 text-sm text-gray-600 line-clamp-2"},Fe={key:2,class:"mt-3 pt-3 border-t border-gray-100"},Oe={class:"mb-4"},Ye={class:"mb-4"},Ue={class:"mb-4"},He={class:"mb-4"},Le={class:"mb-4"},qe={class:"mb-4"},Ee={key:0,class:"mt-4 p-3 bg-red-50 text-red-600 rounded-lg text-sm"},$e={__name:"TimeSheet",setup(U){const S=ue("$dayjs"),b=c(!0),g=c(!1),k=c(!1),x=c(null),y=c(""),v=c("all"),r=c([]),w=c([]),R=c({total_hours:0,tasks_worked:0,timesheets:[]}),H=le(()=>v.value==="all"?r.value:v.value==="draft"?r.value.filter(n=>n.status==="Draft"):v.value==="submitted"?r.value.filter(n=>n.status==="Submitted"):v.value==="approved"?r.value.filter(n=>n.status==="Approved"):r.value),i=c({task:"",date:"",hours_worked:"",activity_type:"Development",description:"",notes:""});function T(){return C(this,null,function*(){var n;b.value=!0;try{const[e,l,B]=yield Promise.all([V("smart_pro.smart_pro.api.projects.get_my_timesheets"),V("smart_pro.smart_pro.api.projects.get_user_tasks"),V("smart_pro.smart_pro.api.projects.get_today_summary")]);r.value=e||[],w.value=(l||[]).filter(se=>se.status!=="Completed"),R.value=B||{total_hours:0,tasks_worked:0}}catch(e){console.error("Error loading data:",e),y.value=((n=e.messages)==null?void 0:n[0])||e.message||"Failed to load data"}finally{b.value=!1}})}function L(){i.value={task:"",date:S().format("YYYY-MM-DD"),hours_worked:"",activity_type:"Development",description:"",notes:""},y.value="",g.value=!0}function J(){return C(this,null,function*(){var n;if(!i.value.task||!i.value.date||!i.value.hours_worked||!i.value.description){y.value="Task, date, hours, and description are required";return}k.value=!0,y.value="";try{yield V("smart_pro.smart_pro.api.projects.create_timesheet",{task:i.value.task,date:i.value.date,hours_worked:parseFloat(i.value.hours_worked),description:i.value.description,activity_type:i.value.activity_type,notes:i.value.notes||null}),yield(yield Y.create({message:"Timesheet saved successfully!",duration:2e3,color:"success"})).present(),g.value=!1,yield T()}catch(e){console.error("Error saving timesheet:",e),y.value=((n=e.messages)==null?void 0:n[0])||e.message||"Failed to save timesheet"}finally{k.value=!1}})}function Q(n){return C(this,null,function*(){var e;x.value=n;try{yield V("smart_pro.smart_pro.api.projects.submit_timesheet",{timesheet_name:n}),yield(yield Y.create({message:"Timesheet submitted for approval!",duration:2e3,color:"success"})).present(),yield T()}catch(l){console.error("Error submitting timesheet:",l),yield(yield Y.create({message:((e=l.messages)==null?void 0:e[0])||"Failed to submit timesheet",duration:3e3,color:"danger"})).present()}finally{x.value=null}})}function X(n){T().finally(()=>{n.target.complete()})}function Z(n){return n?S(n).format("MMM D, YYYY"):"-"}function ee(n){return n?n.replace(/<[^>]*>/g,""):""}function te(n){return{Draft:"planning",Submitted:"on-hold",Approved:"completed",Rejected:"cancelled"}[n]||""}return oe(()=>{T()}),(n,e)=>(d(),j(t(ye),null,{default:a(()=>[s(t(q),null,{default:a(()=>[s(t(F),null,{default:a(()=>[s(t(O),{slot:"start"},{default:a(()=>[s(t(de),{"default-href":"/smart-pro/home",text:""})]),_:1}),s(t(E),null,{default:a(()=>[...e[9]||(e[9]=[o("Timesheet",-1)])]),_:1}),s(t(O),{slot:"end"},{default:a(()=>[s(t(D),{onClick:L},{default:a(()=>[s(t(h),{icon:t(re)},null,8,["icon"])]),_:1})]),_:1})]),_:1}),s(t(F),null,{default:a(()=>[s(t(me),{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=l=>v.value=l),scrollable:""},{default:a(()=>[s(t(M),{value:"all"},{default:a(()=>[s(t(_),null,{default:a(()=>[...e[10]||(e[10]=[o("All",-1)])]),_:1})]),_:1}),s(t(M),{value:"draft"},{default:a(()=>[s(t(_),null,{default:a(()=>[...e[11]||(e[11]=[o("Draft",-1)])]),_:1})]),_:1}),s(t(M),{value:"submitted"},{default:a(()=>[s(t(_),null,{default:a(()=>[...e[12]||(e[12]=[o("Submitted",-1)])]),_:1})]),_:1}),s(t(M),{value:"approved"},{default:a(()=>[s(t(_),null,{default:a(()=>[...e[13]||(e[13]=[o("Approved",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(t($),{fullscreen:!0},{fixed:a(()=>[s(t(fe),{onIonRefresh:X},{default:a(()=>[s(t(ce))]),_:1})]),default:a(()=>[u("div",be,[u("div",ke,[e[15]||(e[15]=u("div",{class:"text-sm opacity-90 mb-1"},"Today's Summary",-1)),u("div",ge,[u("div",null,[u("span",xe,m(R.value.total_hours||0),1),e[14]||(e[14]=u("span",{class:"text-lg ml-1"},"hours",-1))]),u("div",we,[u("div",Ie,m(R.value.tasks_worked||0)+" tasks",1)])])])]),b.value?(d(),p("div",Ve,[(d(),p(A,null,N(3,l=>u("div",{key:l,class:"app-card mb-4 p-4"},[...e[16]||(e[16]=[u("div",{class:"skeleton h-5 w-3/4 mb-2"},null,-1),u("div",{class:"skeleton h-4 w-1/2 mb-2"},null,-1),u("div",{class:"skeleton h-3 w-full"},null,-1)])])),64))])):H.value.length===0?(d(),p("div",De,[s(t(h),{icon:t(z),class:"empty-state-icon"},null,8,["icon"]),e[18]||(e[18]=u("div",{class:"empty-state-title"},"No timesheet entries",-1)),u("div",he,m(v.value==="draft"?"No draft timesheets":v.value==="submitted"?"No submitted timesheets":v.value==="approved"?"No approved timesheets":"Log your work hours from your assigned tasks"),1),s(t(D),{class:"mt-4",onClick:L},{default:a(()=>[...e[17]||(e[17]=[o(" Log Hours ",-1)])]),_:1})])):(d(),p("div",Se,[(d(!0),p(A,null,N(H.value,l=>(d(),p("div",{key:l.name,class:"app-card mb-4 p-4"},[u("div",Te,[u("h3",Ce,m(l.task_title||l.task||"General Work"),1),u("span",{class:ne(["status-badge",te(l.status)])},m(l.status),3)]),u("div",je,[s(t(h),{icon:t(ve),class:"mr-1"},null,8,["icon"]),o(" "+m(Z(l.date)),1)]),u("div",Me,[u("span",Re,[s(t(h),{icon:t(z),class:"mr-1"},null,8,["icon"]),o(" "+m(l.hours_worked)+" hours ",1)]),u("span",Be,m(l.activity_type),1)]),l.project?(d(),p("div",Ae,[s(t(h),{icon:t(pe),class:"mr-1"},null,8,["icon"]),o(" "+m(l.project),1)])):I("",!0),l.description?(d(),p("div",Ne,m(ee(l.description)),1)):I("",!0),l.status==="Draft"?(d(),p("div",Fe,[s(t(D),{size:"small",expand:"block",onClick:B=>Q(l.name),disabled:x.value===l.name},{default:a(()=>[x.value===l.name?(d(),j(t(P),{key:0,name:"crescent",class:"mr-2"})):I("",!0),o(" "+m(x.value===l.name?"Submitting...":"Submit for Approval"),1)]),_:2},1032,["onClick","disabled"])])):I("",!0)]))),128))]))]),_:1}),s(t(_e),{"is-open":g.value,onDidDismiss:e[8]||(e[8]=l=>g.value=!1)},{default:a(()=>[s(t(q),null,{default:a(()=>[s(t(F),null,{default:a(()=>[s(t(E),null,{default:a(()=>[...e[19]||(e[19]=[o("Log Hours",-1)])]),_:1}),s(t(O),{slot:"end"},{default:a(()=>[s(t(D),{onClick:e[1]||(e[1]=l=>g.value=!1)},{default:a(()=>[...e[20]||(e[20]=[o("Close",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),s(t($),{class:"ion-padding"},{default:a(()=>[u("form",{onSubmit:ie(J,["prevent"])},[u("div",Oe,[s(t(_),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:a(()=>[...e[21]||(e[21]=[o(" Task * ",-1)])]),_:1}),s(t(W),{modelValue:i.value.task,"onUpdate:modelValue":e[2]||(e[2]=l=>i.value.task=l),placeholder:"Select a task",interface:"action-sheet",fill:"outline"},{default:a(()=>[(d(!0),p(A,null,N(w.value,l=>(d(),j(t(f),{key:l.name,value:l.name},{default:a(()=>[o(m(l.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),u("div",Ye,[s(t(_),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:a(()=>[...e[22]||(e[22]=[o(" Date * ",-1)])]),_:1}),s(t(G),{modelValue:i.value.date,"onUpdate:modelValue":e[3]||(e[3]=l=>i.value.date=l),type:"date",fill:"outline",required:""},null,8,["modelValue"])]),u("div",Ue,[s(t(_),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:a(()=>[...e[23]||(e[23]=[o(" Hours Worked * ",-1)])]),_:1}),s(t(G),{modelValue:i.value.hours_worked,"onUpdate:modelValue":e[4]||(e[4]=l=>i.value.hours_worked=l),type:"number",min:"0.5",max:"24",step:"0.5",placeholder:"e.g., 8",fill:"outline",required:""},null,8,["modelValue"])]),u("div",He,[s(t(_),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:a(()=>[...e[24]||(e[24]=[o(" Activity Type ",-1)])]),_:1}),s(t(W),{modelValue:i.value.activity_type,"onUpdate:modelValue":e[5]||(e[5]=l=>i.value.activity_type=l),interface:"action-sheet",fill:"outline"},{default:a(()=>[s(t(f),{value:"Development"},{default:a(()=>[...e[25]||(e[25]=[o("Development",-1)])]),_:1}),s(t(f),{value:"Design"},{default:a(()=>[...e[26]||(e[26]=[o("Design",-1)])]),_:1}),s(t(f),{value:"Testing"},{default:a(()=>[...e[27]||(e[27]=[o("Testing",-1)])]),_:1}),s(t(f),{value:"Documentation"},{default:a(()=>[...e[28]||(e[28]=[o("Documentation",-1)])]),_:1}),s(t(f),{value:"Meeting"},{default:a(()=>[...e[29]||(e[29]=[o("Meeting",-1)])]),_:1}),s(t(f),{value:"Research"},{default:a(()=>[...e[30]||(e[30]=[o("Research",-1)])]),_:1}),s(t(f),{value:"Bug Fix"},{default:a(()=>[...e[31]||(e[31]=[o("Bug Fix",-1)])]),_:1}),s(t(f),{value:"Code Review"},{default:a(()=>[...e[32]||(e[32]=[o("Code Review",-1)])]),_:1}),s(t(f),{value:"Deployment"},{default:a(()=>[...e[33]||(e[33]=[o("Deployment",-1)])]),_:1}),s(t(f),{value:"Other"},{default:a(()=>[...e[34]||(e[34]=[o("Other",-1)])]),_:1})]),_:1},8,["modelValue"])]),u("div",Le,[s(t(_),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:a(()=>[...e[35]||(e[35]=[o(" Work Description * ",-1)])]),_:1}),s(t(K),{modelValue:i.value.description,"onUpdate:modelValue":e[6]||(e[6]=l=>i.value.description=l),placeholder:"What did you work on today?",fill:"outline",rows:3,required:""},null,8,["modelValue"])]),u("div",qe,[s(t(_),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:a(()=>[...e[36]||(e[36]=[o(" Additional Notes ",-1)])]),_:1}),s(t(K),{modelValue:i.value.notes,"onUpdate:modelValue":e[7]||(e[7]=l=>i.value.notes=l),placeholder:"Any additional notes...",fill:"outline",rows:2},null,8,["modelValue"])]),s(t(D),{expand:"block",type:"submit",disabled:k.value,class:"mt-6"},{default:a(()=>[k.value?(d(),j(t(P),{key:0,name:"crescent",class:"mr-2"})):I("",!0),o(" "+m(k.value?"Saving...":"Save Timesheet"),1)]),_:1},8,["disabled"]),y.value?(d(),p("div",Ee,m(y.value),1)):I("",!0)],32)]),_:1})]),_:1},8,["is-open"])]),_:1}))}},Ge=ae($e,[["__scopeId","data-v-6d9ba3a8"]]);export{Ge as default};
//# sourceMappingURL=TimeSheet-C1ChFiLG.js.map
