var C=(E,T,y)=>new Promise((g,k)=>{var x=r=>{try{v(y.next(r))}catch(w){k(w)}},b=r=>{try{v(y.throw(r))}catch(w){k(w)}},v=r=>r.done?g(r.value):Promise.resolve(r.value).then(x,b);v((y=y.apply(E,T)).next())});import{f as ae,r as c,c as le,a as oe,A as j,q as a,t,z as D,i as ue,l as d,n as s,v as o,x as u,k as p,y as m,F as A,O as N,N as I,P as ne,R as ie}from"./frappe-ui-5f3Xtay5.js";import{o as de,j as L,k as F,m as O,z as re,l as q,n as h,d as S,N as me,B as ve,C as M,e as _,u as W,v as pe,w as fe,t as $,g as ce,D as _e,J as z,E as be,G as P,H as f,K as G,L as J,i as ye,M as Y}from"./index-Cn4F0kH1.js";const ke={class:"p-4 pb-0"},ge={class:"app-card p-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white"},xe={class:"flex justify-between items-end"},we={class:"text-3xl font-bold"},Ie={class:"text-right"},Ve={class:"text-sm opacity-90"},De={key:0,class:"p-4"},he={key:1,class:"empty-state h-full"},Se={class:"empty-state-description"},Te={key:2,class:"p-4"},Ce={class:"flex justify-between items-start mb-2"},je={class:"font-semibold text-gray-800"},Me={class:"text-sm text-gray-500 mb-2"},Re={class:"flex items-center justify-between text-sm"},Be={class:"text-gray-600"},Ae={class:"px-2 py-1 bg-gray-100 rounded text-xs text-gray-600"},Ne={key:0,class:"mt-2 text-sm text-blue-600"},Fe={key:1,class:"mt-2 text-sm text-gray-600 line-clamp-2"},Oe={key:2,class:"mt-3 pt-3 border-t border-gray-100"},Ye={class:"mb-4"},Ee={class:"mb-4"},Ue={class:"mb-4"},He={class:"mb-4"},Le={class:"mb-4"},qe={class:"mb-4"},We={key:0,class:"mt-4 p-3 bg-red-50 text-red-600 rounded-lg text-sm"},$e={__name:"TimeSheet",setup(E){const T=ue("$dayjs"),y=c(!0),g=c(!1),k=c(!1),x=c(null),b=c(""),v=c("draft"),r=c([]),w=c([]),R=c({total_hours:0,tasks_worked:0,timesheets:[]}),U=le(()=>v.value==="all"?r.value:v.value==="draft"?r.value.filter(n=>n.status==="Draft"):v.value==="submitted"?r.value.filter(n=>n.status==="Submitted"):v.value==="approved"?r.value.filter(n=>n.status==="Approved"):r.value),i=c({task:"",date:"",hours_worked:"",activity_type:"Development",description:"",notes:""});function V(){return C(this,null,function*(){var n;y.value=!0;try{const[e,l,B]=yield Promise.all([D("smart_pro.smart_pro.api.projects.get_my_timesheets"),D("smart_pro.smart_pro.api.projects.get_user_tasks"),D("smart_pro.smart_pro.api.projects.get_today_summary")]);r.value=e||[],w.value=(l||[]).filter(se=>se.status!=="Completed"),R.value=B||{total_hours:0,tasks_worked:0}}catch(e){console.error("Error loading data:",e),b.value=((n=e.messages)==null?void 0:n[0])||e.message||"Failed to load data"}finally{y.value=!1}})}function H(){i.value={task:"",date:T().format("YYYY-MM-DD"),hours_worked:"",activity_type:"Development",description:"",notes:""},b.value="",g.value=!0}function K(){return C(this,null,function*(){var n;if(!i.value.task||!i.value.date||!i.value.hours_worked||!i.value.description){b.value="Task, date, hours, and description are required";return}k.value=!0,b.value="";try{yield D("smart_pro.smart_pro.api.projects.create_timesheet",{task:i.value.task,date:i.value.date,hours_worked:parseFloat(i.value.hours_worked),description:i.value.description,activity_type:i.value.activity_type,notes:i.value.notes||null}),yield(yield Y.create({message:"Timesheet saved successfully!",duration:2e3,color:"success"})).present(),g.value=!1,yield V()}catch(e){console.error("Error saving timesheet:",e),b.value=((n=e.messages)==null?void 0:n[0])||e.message||"Failed to save timesheet"}finally{k.value=!1}})}function Q(n){return C(this,null,function*(){var e;x.value=n;try{yield D("smart_pro.smart_pro.api.projects.submit_timesheet",{timesheet_name:n}),yield(yield Y.create({message:"Timesheet submitted for approval!",duration:2e3,color:"success"})).present(),yield V()}catch(l){console.error("Error submitting timesheet:",l),yield(yield Y.create({message:((e=l.messages)==null?void 0:e[0])||"Failed to submit timesheet",duration:3e3,color:"danger"})).present()}finally{x.value=null}})}function X(n){V().finally(()=>{n.target.complete()})}function Z(n){return n?T(n).format("MMM D, YYYY"):"-"}function ee(n){return n?n.replace(/<[^>]*>/g,""):""}function te(n){return{Draft:"planning",Submitted:"on-hold",Approved:"completed",Rejected:"cancelled"}[n]||""}return oe(()=>{V()}),de(()=>{V()}),(n,e)=>(d(),j(t(ye),null,{default:a(()=>[s(t(L),null,{default:a(()=>[s(t(F),null,{default:a(()=>[s(t(O),{slot:"start"},{default:a(()=>[s(t(re),{"default-href":"/smart-pro/home",text:""})]),_:1}),s(t(q),null,{default:a(()=>[...e[9]||(e[9]=[o("Timesheet",-1)])]),_:1}),s(t(O),{slot:"end"},{default:a(()=>[s(t(h),{onClick:H},{default:a(()=>[s(t(S),{icon:t(me)},null,8,["icon"])]),_:1})]),_:1})]),_:1}),s(t(F),null,{default:a(()=>[s(t(ve),{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=l=>v.value=l),scrollable:""},{default:a(()=>[s(t(M),{value:"all"},{default:a(()=>[s(t(_),null,{default:a(()=>[...e[10]||(e[10]=[o("All",-1)])]),_:1})]),_:1}),s(t(M),{value:"draft"},{default:a(()=>[s(t(_),null,{default:a(()=>[...e[11]||(e[11]=[o("Draft",-1)])]),_:1})]),_:1}),s(t(M),{value:"submitted"},{default:a(()=>[s(t(_),null,{default:a(()=>[...e[12]||(e[12]=[o("Submitted",-1)])]),_:1})]),_:1}),s(t(M),{value:"approved"},{default:a(()=>[s(t(_),null,{default:a(()=>[...e[13]||(e[13]=[o("Approved",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(t(W),{fullscreen:!0},{default:a(()=>[s(t(pe),{slot:"fixed",onIonRefresh:X},{default:a(()=>[s(t(fe))]),_:1}),u("div",ke,[u("div",ge,[e[15]||(e[15]=u("div",{class:"text-sm opacity-90 mb-1"},"Today's Summary",-1)),u("div",xe,[u("div",null,[u("span",we,m(R.value.total_hours||0),1),e[14]||(e[14]=u("span",{class:"text-lg ml-1"},"hours",-1))]),u("div",Ie,[u("div",Ve,m(R.value.tasks_worked||0)+" tasks",1)])])])]),y.value?(d(),p("div",De,[(d(),p(A,null,N(3,l=>u("div",{key:l,class:"app-card mb-4 p-4"},[...e[16]||(e[16]=[u("div",{class:"skeleton h-5 w-3/4 mb-2"},null,-1),u("div",{class:"skeleton h-4 w-1/2 mb-2"},null,-1),u("div",{class:"skeleton h-3 w-full"},null,-1)])])),64))])):U.value.length===0?(d(),p("div",he,[s(t(S),{icon:t($),class:"empty-state-icon"},null,8,["icon"]),e[18]||(e[18]=u("div",{class:"empty-state-title"},"No timesheet entries",-1)),u("div",Se,m(v.value==="draft"?"No draft timesheets":v.value==="submitted"?"No submitted timesheets":v.value==="approved"?"No approved timesheets":"Log your work hours from your assigned tasks"),1),s(t(h),{class:"mt-4",onClick:H},{default:a(()=>[...e[17]||(e[17]=[o(" Log Hours ",-1)])]),_:1})])):(d(),p("div",Te,[(d(!0),p(A,null,N(U.value,l=>(d(),p("div",{key:l.name,class:"app-card mb-4 p-4"},[u("div",Ce,[u("h3",je,m(l.task_title||l.task||"General Work"),1),u("span",{class:ne(["status-badge",te(l.status)])},m(l.status),3)]),u("div",Me,[s(t(S),{icon:t(ce),class:"mr-1"},null,8,["icon"]),o(" "+m(Z(l.date)),1)]),u("div",Re,[u("span",Be,[s(t(S),{icon:t($),class:"mr-1"},null,8,["icon"]),o(" "+m(l.hours_worked)+" hours ",1)]),u("span",Ae,m(l.activity_type),1)]),l.project?(d(),p("div",Ne,[s(t(S),{icon:t(_e),class:"mr-1"},null,8,["icon"]),o(" "+m(l.project),1)])):I("",!0),l.description?(d(),p("div",Fe,m(ee(l.description)),1)):I("",!0),l.status==="Draft"?(d(),p("div",Oe,[s(t(h),{size:"small",expand:"block",onClick:B=>Q(l.name),disabled:x.value===l.name},{default:a(()=>[x.value===l.name?(d(),j(t(z),{key:0,name:"crescent",class:"mr-2"})):I("",!0),o(" "+m(x.value===l.name?"Submitting...":"Submit for Approval"),1)]),_:2},1032,["onClick","disabled"])])):I("",!0)]))),128))]))]),_:1}),s(t(be),{"is-open":g.value,onDidDismiss:e[8]||(e[8]=l=>g.value=!1)},{default:a(()=>[s(t(L),null,{default:a(()=>[s(t(F),null,{default:a(()=>[s(t(q),null,{default:a(()=>[...e[19]||(e[19]=[o("Log Hours",-1)])]),_:1}),s(t(O),{slot:"end"},{default:a(()=>[s(t(h),{onClick:e[1]||(e[1]=l=>g.value=!1)},{default:a(()=>[...e[20]||(e[20]=[o("Close",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),s(t(W),{class:"ion-padding"},{default:a(()=>[u("form",{onSubmit:ie(K,["prevent"])},[u("div",Ye,[s(t(_),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:a(()=>[...e[21]||(e[21]=[o(" Task * ",-1)])]),_:1}),s(t(P),{modelValue:i.value.task,"onUpdate:modelValue":e[2]||(e[2]=l=>i.value.task=l),placeholder:"Select a task",interface:"action-sheet",fill:"outline"},{default:a(()=>[(d(!0),p(A,null,N(w.value,l=>(d(),j(t(f),{key:l.name,value:l.name},{default:a(()=>[o(m(l.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),u("div",Ee,[s(t(_),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:a(()=>[...e[22]||(e[22]=[o(" Date * ",-1)])]),_:1}),s(t(G),{modelValue:i.value.date,"onUpdate:modelValue":e[3]||(e[3]=l=>i.value.date=l),type:"date",fill:"outline",required:""},null,8,["modelValue"])]),u("div",Ue,[s(t(_),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:a(()=>[...e[23]||(e[23]=[o(" Hours Worked * ",-1)])]),_:1}),s(t(G),{modelValue:i.value.hours_worked,"onUpdate:modelValue":e[4]||(e[4]=l=>i.value.hours_worked=l),type:"number",min:"0.5",max:"24",step:"0.5",placeholder:"e.g., 8",fill:"outline",required:""},null,8,["modelValue"])]),u("div",He,[s(t(_),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:a(()=>[...e[24]||(e[24]=[o(" Activity Type ",-1)])]),_:1}),s(t(P),{modelValue:i.value.activity_type,"onUpdate:modelValue":e[5]||(e[5]=l=>i.value.activity_type=l),interface:"action-sheet",fill:"outline"},{default:a(()=>[s(t(f),{value:"Development"},{default:a(()=>[...e[25]||(e[25]=[o("Development",-1)])]),_:1}),s(t(f),{value:"Design"},{default:a(()=>[...e[26]||(e[26]=[o("Design",-1)])]),_:1}),s(t(f),{value:"Testing"},{default:a(()=>[...e[27]||(e[27]=[o("Testing",-1)])]),_:1}),s(t(f),{value:"Documentation"},{default:a(()=>[...e[28]||(e[28]=[o("Documentation",-1)])]),_:1}),s(t(f),{value:"Meeting"},{default:a(()=>[...e[29]||(e[29]=[o("Meeting",-1)])]),_:1}),s(t(f),{value:"Research"},{default:a(()=>[...e[30]||(e[30]=[o("Research",-1)])]),_:1}),s(t(f),{value:"Bug Fix"},{default:a(()=>[...e[31]||(e[31]=[o("Bug Fix",-1)])]),_:1}),s(t(f),{value:"Code Review"},{default:a(()=>[...e[32]||(e[32]=[o("Code Review",-1)])]),_:1}),s(t(f),{value:"Deployment"},{default:a(()=>[...e[33]||(e[33]=[o("Deployment",-1)])]),_:1}),s(t(f),{value:"Other"},{default:a(()=>[...e[34]||(e[34]=[o("Other",-1)])]),_:1})]),_:1},8,["modelValue"])]),u("div",Le,[s(t(_),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:a(()=>[...e[35]||(e[35]=[o(" Work Description * ",-1)])]),_:1}),s(t(J),{modelValue:i.value.description,"onUpdate:modelValue":e[6]||(e[6]=l=>i.value.description=l),placeholder:"What did you work on today?",fill:"outline",rows:3,required:""},null,8,["modelValue"])]),u("div",qe,[s(t(_),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:a(()=>[...e[36]||(e[36]=[o(" Additional Notes ",-1)])]),_:1}),s(t(J),{modelValue:i.value.notes,"onUpdate:modelValue":e[7]||(e[7]=l=>i.value.notes=l),placeholder:"Any additional notes...",fill:"outline",rows:2},null,8,["modelValue"])]),s(t(h),{expand:"block",type:"submit",disabled:k.value,class:"mt-6"},{default:a(()=>[k.value?(d(),j(t(z),{key:0,name:"crescent",class:"mr-2"})):I("",!0),o(" "+m(k.value?"Saving...":"Save Timesheet"),1)]),_:1},8,["disabled"]),b.value?(d(),p("div",We,m(b.value),1)):I("",!0)],32)]),_:1})]),_:1},8,["is-open"])]),_:1}))}},Je=ae($e,[["__scopeId","data-v-e3d1b2ec"]]);export{Je as default};
//# sourceMappingURL=TimeSheet-CM8WlcJ1.js.map
