var v=(H,M,S)=>new Promise((g,A)=>{var h=d=>{try{k(S.next(d))}catch(f){A(f)}},T=d=>{try{k(S.throw(d))}catch(f){A(f)}},k=d=>d.done?g(d.value):Promise.resolve(d.value).then(h,T);k((S=S.apply(H,M)).next())});import{f as pe,r as _,c as ve,a as ce,A as I,q as l,t,z as x,i as fe,l as u,n as a,N as c,v as r,x as i,k as p,y as m,F as O,O as N,P as _e,R as ye}from"./frappe-ui-5f3Xtay5.js";import{o as be,j as W,k as Y,m as U,z as ge,l as G,n as C,d as F,A as ke,C as we,D as B,e as b,u as J,v as xe,w as he,t as K,g as Te,E as je,K as $,F as Ve,H as Q,J as y,L as X,M as Z,i as Ie,O as z,N as D}from"./index-BdT8h_5n.js";import{u as Ce}from"./usePermissions-DkJGg_er.js";const De={class:"p-4 pb-0"},Se={class:"app-card p-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white"},Ae={class:"flex justify-between items-end"},Re={class:"text-3xl font-bold"},Fe={class:"text-right"},Me={class:"text-sm opacity-90"},Be={key:0,class:"p-4"},Ee={key:1,class:"empty-state h-full"},Oe={class:"empty-state-description"},Ne={key:1,class:"mt-4 text-sm text-gray-500 italic"},Ye={key:2,class:"p-4"},Ue={class:"flex justify-between items-start mb-2"},$e={class:"font-semibold text-gray-800"},ze={class:"text-sm text-gray-500 mb-2"},He={class:"flex items-center justify-between text-sm"},Le={class:"text-gray-600"},qe={class:"px-2 py-1 bg-gray-100 rounded text-xs text-gray-600"},Pe={key:0,class:"mt-2 text-sm text-blue-600"},We={key:1,class:"mt-2 text-sm text-gray-600 line-clamp-2"},Ge={key:2,class:"mt-3 pt-3 border-t border-gray-100"},Je={key:3,class:"mt-3 pt-3 border-t border-gray-100"},Ke={key:4,class:"mt-3 pt-3 border-t border-gray-100"},Qe={class:"flex gap-2"},Xe={class:"mb-4"},Ze={class:"mb-4"},et={class:"mb-4"},tt={class:"mb-4"},st={class:"mb-4"},at={class:"mb-4"},lt={key:0,class:"mt-4 p-3 bg-red-50 text-red-600 rounded-lg text-sm"},ot={__name:"TimeSheet",setup(H){const M=fe("$dayjs"),{fetchPermissions:S,hasFullAccess:g}=Ce(),A=_(!0),h=_(!1),T=_(!1),k=_(null),d=_(null),f=_(""),w=_("draft"),R=_([]),L=_([]),E=_({total_hours:0,tasks_worked:0,timesheets:[]}),q=ve(()=>w.value==="all"?R.value:w.value==="draft"?R.value.filter(o=>o.status==="Draft"):w.value==="submitted"?R.value.filter(o=>o.status==="Submitted"):w.value==="approved"?R.value.filter(o=>o.status==="Approved"):R.value),n=_({task:"",date:"",hours_worked:"",activity_type:"Development",description:"",notes:""});function j(){return v(this,null,function*(){var o;A.value=!0;try{yield S();let e;g.value?e=yield x("smart_pro.smart_pro.api.projects.get_all_timesheets"):e=yield x("smart_pro.smart_pro.api.projects.get_my_timesheets");const[s,V]=yield Promise.all([x("smart_pro.smart_pro.api.projects.get_user_tasks"),x("smart_pro.smart_pro.api.projects.get_today_summary")]);R.value=e||[],L.value=(s||[]).filter(me=>me.status!=="Completed"),E.value=V||{total_hours:0,tasks_worked:0}}catch(e){console.error("Error loading data:",e),f.value=((o=e.messages)==null?void 0:o[0])||e.message||"Failed to load data"}finally{A.value=!1}})}function P(){n.value={task:"",date:M().format("YYYY-MM-DD"),hours_worked:"",activity_type:"Development",description:"",notes:""},f.value="",h.value=!0}function ee(){return v(this,null,function*(){var o;if(!n.value.task||!n.value.date||!n.value.hours_worked||!n.value.description){f.value="Task, date, hours, and description are required";return}T.value=!0,f.value="";try{yield x("smart_pro.smart_pro.api.projects.create_timesheet",{task:n.value.task,date:n.value.date,hours_worked:parseFloat(n.value.hours_worked),description:n.value.description,activity_type:n.value.activity_type,notes:n.value.notes||null}),yield(yield D.create({message:"Timesheet saved successfully!",duration:2e3,color:"success"})).present(),h.value=!1,yield j()}catch(e){console.error("Error saving timesheet:",e),f.value=((o=e.messages)==null?void 0:o[0])||e.message||"Failed to save timesheet"}finally{T.value=!1}})}function te(o){return v(this,null,function*(){yield(yield z.create({header:"Submit for Approval",message:"Are you sure you want to submit this timesheet for approval?",buttons:[{text:"Cancel",role:"cancel"},{text:"Submit",handler:()=>v(this,null,function*(){yield se(o)})}]})).present()})}function se(o){return v(this,null,function*(){var e;k.value=o;try{yield x("smart_pro.smart_pro.api.projects.submit_timesheet",{timesheet_name:o}),yield(yield D.create({message:"Timesheet submitted for approval!",duration:2e3,color:"success"})).present(),yield j()}catch(s){console.error("Error submitting timesheet:",s),yield(yield D.create({message:((e=s.messages)==null?void 0:e[0])||"Failed to submit timesheet",duration:3e3,color:"danger"})).present()}finally{k.value=null}})}function ae(o){return v(this,null,function*(){yield(yield z.create({header:"Approve Timesheet",message:"Are you sure you want to approve this timesheet?",buttons:[{text:"Cancel",role:"cancel"},{text:"Approve",handler:()=>v(this,null,function*(){yield le(o)})}]})).present()})}function le(o){return v(this,null,function*(){var e;d.value=o;try{yield x("smart_pro.smart_pro.api.projects.approve_timesheet",{timesheet_name:o}),yield(yield D.create({message:"Timesheet approved successfully!",duration:2e3,color:"success"})).present(),yield j()}catch(s){console.error("Error approving timesheet:",s),yield(yield D.create({message:((e=s.messages)==null?void 0:e[0])||"Failed to approve timesheet",duration:3e3,color:"danger"})).present()}finally{d.value=null}})}function oe(o){return v(this,null,function*(){yield(yield z.create({header:"Reject Timesheet",message:"Are you sure you want to reject this timesheet?",buttons:[{text:"Cancel",role:"cancel"},{text:"Reject",cssClass:"alert-button-danger",handler:()=>v(this,null,function*(){yield re(o)})}]})).present()})}function re(o){return v(this,null,function*(){var e;d.value=o;try{yield x("smart_pro.smart_pro.api.projects.reject_timesheet",{timesheet_name:o}),yield(yield D.create({message:"Timesheet rejected!",duration:2e3,color:"warning"})).present(),yield j()}catch(s){console.error("Error rejecting timesheet:",s),yield(yield D.create({message:((e=s.messages)==null?void 0:e[0])||"Failed to reject timesheet",duration:3e3,color:"danger"})).present()}finally{d.value=null}})}function ie(o){j().finally(()=>{o.target.complete()})}function ne(o){return o?M(o).format("MMM D, YYYY"):"-"}function ue(o){return o?o.replace(/<[^>]*>/g,""):""}function de(o){return{Draft:"planning",Submitted:"on-hold",Approved:"completed",Rejected:"cancelled"}[o]||""}return ce(()=>{j()}),be(()=>{j()}),(o,e)=>(u(),I(t(Ie),null,{default:l(()=>[a(t(W),null,{default:l(()=>[a(t(Y),null,{default:l(()=>[a(t(U),{slot:"start"},{default:l(()=>[a(t(ge),{"default-href":"/smart-pro/home",text:""})]),_:1}),a(t(G),null,{default:l(()=>[...e[9]||(e[9]=[r("Timesheet",-1)])]),_:1}),t(g)?c("",!0):(u(),I(t(U),{key:0,slot:"end"},{default:l(()=>[a(t(C),{onClick:P},{default:l(()=>[a(t(F),{icon:t(ke)},null,8,["icon"])]),_:1})]),_:1}))]),_:1}),a(t(Y),null,{default:l(()=>[a(t(we),{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=s=>w.value=s),scrollable:""},{default:l(()=>[a(t(B),{value:"all"},{default:l(()=>[a(t(b),null,{default:l(()=>[...e[10]||(e[10]=[r("All",-1)])]),_:1})]),_:1}),a(t(B),{value:"draft"},{default:l(()=>[a(t(b),null,{default:l(()=>[...e[11]||(e[11]=[r("Draft",-1)])]),_:1})]),_:1}),a(t(B),{value:"submitted"},{default:l(()=>[a(t(b),null,{default:l(()=>[...e[12]||(e[12]=[r("Submitted",-1)])]),_:1})]),_:1}),a(t(B),{value:"approved"},{default:l(()=>[a(t(b),null,{default:l(()=>[...e[13]||(e[13]=[r("Approved",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(t(J),{fullscreen:!0},{default:l(()=>[a(t(xe),{slot:"fixed",onIonRefresh:ie},{default:l(()=>[a(t(he))]),_:1}),i("div",De,[i("div",Se,[e[15]||(e[15]=i("div",{class:"text-sm opacity-90 mb-1"},"Today's Summary",-1)),i("div",Ae,[i("div",null,[i("span",Re,m(E.value.total_hours||0),1),e[14]||(e[14]=i("span",{class:"text-lg ml-1"},"hours",-1))]),i("div",Fe,[i("div",Me,m(E.value.tasks_worked||0)+" tasks",1)])])])]),A.value?(u(),p("div",Be,[(u(),p(O,null,N(3,s=>i("div",{key:s,class:"app-card mb-4 p-4"},[...e[16]||(e[16]=[i("div",{class:"skeleton h-5 w-3/4 mb-2"},null,-1),i("div",{class:"skeleton h-4 w-1/2 mb-2"},null,-1),i("div",{class:"skeleton h-3 w-full"},null,-1)])])),64))])):q.value.length===0?(u(),p("div",Ee,[a(t(F),{icon:t(K),class:"empty-state-icon"},null,8,["icon"]),e[18]||(e[18]=i("div",{class:"empty-state-title"},"No timesheet entries",-1)),i("div",Oe,m(w.value==="draft"?"No draft timesheets":w.value==="submitted"?"No submitted timesheets":w.value==="approved"?"No approved timesheets":"Log your work hours from your assigned tasks"),1),t(g)?c("",!0):(u(),I(t(C),{key:0,class:"mt-4",onClick:P},{default:l(()=>[...e[17]||(e[17]=[r(" Log Hours ",-1)])]),_:1})),t(g)?(u(),p("div",Ne," View only mode ")):c("",!0)])):(u(),p("div",Ye,[(u(!0),p(O,null,N(q.value,s=>(u(),p("div",{key:s.name,class:"app-card mb-4 p-4"},[i("div",Ue,[i("h3",$e,m(s.task_title||s.task||"General Work"),1),i("span",{class:_e(["status-badge",de(s.status)])},m(s.status),3)]),i("div",ze,[a(t(F),{icon:t(Te),class:"mr-1"},null,8,["icon"]),r(" "+m(ne(s.date)),1)]),i("div",He,[i("span",Le,[a(t(F),{icon:t(K),class:"mr-1"},null,8,["icon"]),r(" "+m(s.hours_worked)+" hours ",1)]),i("span",qe,m(s.activity_type),1)]),s.project?(u(),p("div",Pe,[a(t(F),{icon:t(je),class:"mr-1"},null,8,["icon"]),r(" "+m(s.project),1)])):c("",!0),s.description?(u(),p("div",We,m(ue(s.description)),1)):c("",!0),s.status==="Draft"&&!t(g)?(u(),p("div",Ge,[a(t(C),{size:"small",expand:"block",onClick:V=>te(s.name),disabled:k.value===s.name},{default:l(()=>[k.value===s.name?(u(),I(t($),{key:0,name:"crescent",class:"mr-2"})):c("",!0),r(" "+m(k.value===s.name?"Submitting...":"Submit for Approval"),1)]),_:2},1032,["onClick","disabled"])])):c("",!0),s.status==="Draft"&&t(g)?(u(),p("div",Je,[...e[19]||(e[19]=[i("div",{class:"text-xs text-gray-500 italic text-center"}," View only mode - Full access users cannot submit timesheets ",-1)])])):c("",!0),s.status==="Submitted"&&t(g)?(u(),p("div",Ke,[i("div",Qe,[a(t(C),{size:"small",expand:"block",color:"success",class:"flex-1",onClick:V=>ae(s.name),disabled:d.value===s.name},{default:l(()=>[d.value===s.name?(u(),I(t($),{key:0,name:"crescent",class:"mr-2"})):c("",!0),r(" "+m(d.value===s.name?"Approving...":"Approve"),1)]),_:2},1032,["onClick","disabled"]),a(t(C),{size:"small",expand:"block",color:"danger",fill:"outline",class:"flex-1",onClick:V=>oe(s.name),disabled:d.value===s.name},{default:l(()=>[...e[20]||(e[20]=[r(" Reject ",-1)])]),_:1},8,["onClick","disabled"])])])):c("",!0)]))),128))]))]),_:1}),a(t(Ve),{"is-open":h.value,onDidDismiss:e[8]||(e[8]=s=>h.value=!1)},{default:l(()=>[a(t(W),null,{default:l(()=>[a(t(Y),null,{default:l(()=>[a(t(G),null,{default:l(()=>[...e[21]||(e[21]=[r("Log Hours",-1)])]),_:1}),a(t(U),{slot:"end"},{default:l(()=>[a(t(C),{onClick:e[1]||(e[1]=s=>h.value=!1)},{default:l(()=>[...e[22]||(e[22]=[r("Close",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),a(t(J),{class:"ion-padding"},{default:l(()=>[i("form",{onSubmit:ye(ee,["prevent"])},[i("div",Xe,[a(t(b),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[23]||(e[23]=[r(" Task * ",-1)])]),_:1}),a(t(Q),{modelValue:n.value.task,"onUpdate:modelValue":e[2]||(e[2]=s=>n.value.task=s),placeholder:"Select a task",interface:"action-sheet",fill:"outline"},{default:l(()=>[(u(!0),p(O,null,N(L.value,s=>(u(),I(t(y),{key:s.name,value:s.name},{default:l(()=>[r(m(s.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),i("div",Ze,[a(t(b),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[24]||(e[24]=[r(" Date * ",-1)])]),_:1}),a(t(X),{modelValue:n.value.date,"onUpdate:modelValue":e[3]||(e[3]=s=>n.value.date=s),type:"date",fill:"outline",required:""},null,8,["modelValue"])]),i("div",et,[a(t(b),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[25]||(e[25]=[r(" Hours Worked * ",-1)])]),_:1}),a(t(X),{modelValue:n.value.hours_worked,"onUpdate:modelValue":e[4]||(e[4]=s=>n.value.hours_worked=s),type:"number",min:"0.5",max:"24",step:"0.5",placeholder:"e.g., 8",fill:"outline",required:""},null,8,["modelValue"])]),i("div",tt,[a(t(b),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[26]||(e[26]=[r(" Activity Type ",-1)])]),_:1}),a(t(Q),{modelValue:n.value.activity_type,"onUpdate:modelValue":e[5]||(e[5]=s=>n.value.activity_type=s),interface:"action-sheet",fill:"outline"},{default:l(()=>[a(t(y),{value:"Development"},{default:l(()=>[...e[27]||(e[27]=[r("Development",-1)])]),_:1}),a(t(y),{value:"Design"},{default:l(()=>[...e[28]||(e[28]=[r("Design",-1)])]),_:1}),a(t(y),{value:"Testing"},{default:l(()=>[...e[29]||(e[29]=[r("Testing",-1)])]),_:1}),a(t(y),{value:"Documentation"},{default:l(()=>[...e[30]||(e[30]=[r("Documentation",-1)])]),_:1}),a(t(y),{value:"Meeting"},{default:l(()=>[...e[31]||(e[31]=[r("Meeting",-1)])]),_:1}),a(t(y),{value:"Research"},{default:l(()=>[...e[32]||(e[32]=[r("Research",-1)])]),_:1}),a(t(y),{value:"Bug Fix"},{default:l(()=>[...e[33]||(e[33]=[r("Bug Fix",-1)])]),_:1}),a(t(y),{value:"Code Review"},{default:l(()=>[...e[34]||(e[34]=[r("Code Review",-1)])]),_:1}),a(t(y),{value:"Deployment"},{default:l(()=>[...e[35]||(e[35]=[r("Deployment",-1)])]),_:1}),a(t(y),{value:"Other"},{default:l(()=>[...e[36]||(e[36]=[r("Other",-1)])]),_:1})]),_:1},8,["modelValue"])]),i("div",st,[a(t(b),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[37]||(e[37]=[r(" Work Description * ",-1)])]),_:1}),a(t(Z),{modelValue:n.value.description,"onUpdate:modelValue":e[6]||(e[6]=s=>n.value.description=s),placeholder:"What did you work on today?",fill:"outline",rows:3,required:""},null,8,["modelValue"])]),i("div",at,[a(t(b),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:l(()=>[...e[38]||(e[38]=[r(" Additional Notes ",-1)])]),_:1}),a(t(Z),{modelValue:n.value.notes,"onUpdate:modelValue":e[7]||(e[7]=s=>n.value.notes=s),placeholder:"Any additional notes...",fill:"outline",rows:2},null,8,["modelValue"])]),a(t(C),{expand:"block",type:"submit",disabled:T.value,class:"mt-6"},{default:l(()=>[T.value?(u(),I(t($),{key:0,name:"crescent",class:"mr-2"})):c("",!0),r(" "+m(T.value?"Saving...":"Save Timesheet"),1)]),_:1},8,["disabled"]),f.value?(u(),p("div",lt,m(f.value),1)):c("",!0)],32)]),_:1})]),_:1},8,["is-open"])]),_:1}))}},dt=pe(ot,[["__scopeId","data-v-bbf33d69"]]);export{dt as default};
//# sourceMappingURL=TimeSheet-CTimQetc.js.map
