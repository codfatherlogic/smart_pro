var C=(U,T,g)=>new Promise((R,x)=>{var y=r=>{try{b(g.next(r))}catch(v){x(v)}},k=r=>{try{b(g.throw(r))}catch(v){x(v)}},b=r=>r.done?R(r.value):Promise.resolve(r.value).then(y,k);b((g=g.apply(U,T)).next())});import{f as oe,r as c,c as ue,a as ie,A as j,q as a,t,z as h,i as ne,l as d,n as s,v as o,x as u,k as p,y as m,F as N,O as F,N as I,P as re,R as de}from"./frappe-ui-5f3Xtay5.js";import{o as me,j as P,k as O,m as Y,z as ve,l as W,n as D,d as S,N as pe,B as fe,C as M,e as _,u as $,v as ce,w as _e,t as z,g as be,D as ye,J as G,E as ke,G as J,H as f,K,L as Q,i as ge,M as E}from"./index-BtvF1KL1.js";import{u as xe}from"./usePermissions-DkJGg_er.js";const we={class:"p-4 pb-0"},he={class:"app-card p-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white"},Ie={class:"flex justify-between items-end"},Ve={class:"text-3xl font-bold"},De={class:"text-right"},Se={class:"text-sm opacity-90"},Te={key:0,class:"p-4"},Ce={key:1,class:"empty-state h-full"},je={class:"empty-state-description"},Me={key:2,class:"p-4"},Re={class:"flex justify-between items-start mb-2"},Ae={class:"font-semibold text-gray-800"},Be={class:"text-sm text-gray-500 mb-2"},Ne={class:"flex items-center justify-between text-sm"},Fe={class:"text-gray-600"},Oe={class:"px-2 py-1 bg-gray-100 rounded text-xs text-gray-600"},Ye={key:0,class:"mt-2 text-sm text-blue-600"},Ee={key:1,class:"mt-2 text-sm text-gray-600 line-clamp-2"},Ue={key:2,class:"mt-3 pt-3 border-t border-gray-100"},He={class:"mb-4"},Le={class:"mb-4"},qe={class:"mb-4"},Pe={class:"mb-4"},We={class:"mb-4"},$e={class:"mb-4"},ze={key:0,class:"mt-4 p-3 bg-red-50 text-red-600 rounded-lg text-sm"},Ge={__name:"TimeSheet",setup(U){const T=ne("$dayjs"),{fetchPermissions:g,hasFullAccess:R}=xe(),x=c(!0),y=c(!1),k=c(!1),b=c(null),r=c(""),v=c("draft"),w=c([]),H=c([]),A=c({total_hours:0,tasks_worked:0,timesheets:[]}),L=ue(()=>v.value==="all"?w.value:v.value==="draft"?w.value.filter(i=>i.status==="Draft"):v.value==="submitted"?w.value.filter(i=>i.status==="Submitted"):v.value==="approved"?w.value.filter(i=>i.status==="Approved"):w.value),n=c({task:"",date:"",hours_worked:"",activity_type:"Development",description:"",notes:""});function V(){return C(this,null,function*(){var i;x.value=!0;try{yield g();let e;R.value?e=yield h("smart_pro.smart_pro.api.projects.get_all_timesheets"):e=yield h("smart_pro.smart_pro.api.projects.get_my_timesheets");const[l,B]=yield Promise.all([h("smart_pro.smart_pro.api.projects.get_user_tasks"),h("smart_pro.smart_pro.api.projects.get_today_summary")]);w.value=e||[],H.value=(l||[]).filter(le=>le.status!=="Completed"),A.value=B||{total_hours:0,tasks_worked:0}}catch(e){console.error("Error loading data:",e),r.value=((i=e.messages)==null?void 0:i[0])||e.message||"Failed to load data"}finally{x.value=!1}})}function q(){n.value={task:"",date:T().format("YYYY-MM-DD"),hours_worked:"",activity_type:"Development",description:"",notes:""},r.value="",y.value=!0}function X(){return C(this,null,function*(){var i;if(!n.value.task||!n.value.date||!n.value.hours_worked||!n.value.description){r.value="Task, date, hours, and description are required";return}k.value=!0,r.value="";try{yield h("smart_pro.smart_pro.api.projects.create_timesheet",{task:n.value.task,date:n.value.date,hours_worked:parseFloat(n.value.hours_worked),description:n.value.description,activity_type:n.value.activity_type,notes:n.value.notes||null}),yield(yield E.create({message:"Timesheet saved successfully!",duration:2e3,color:"success"})).present(),y.value=!1,yield V()}catch(e){console.error("Error saving timesheet:",e),r.value=((i=e.messages)==null?void 0:i[0])||e.message||"Failed to save timesheet"}finally{k.value=!1}})}function Z(i){return C(this,null,function*(){var e;b.value=i;try{yield h("smart_pro.smart_pro.api.projects.submit_timesheet",{timesheet_name:i}),yield(yield E.create({message:"Timesheet submitted for approval!",duration:2e3,color:"success"})).present(),yield V()}catch(l){console.error("Error submitting timesheet:",l),yield(yield E.create({message:((e=l.messages)==null?void 0:e[0])||"Failed to submit timesheet",duration:3e3,color:"danger"})).present()}finally{b.value=null}})}function ee(i){V().finally(()=>{i.target.complete()})}function te(i){return i?T(i).format("MMM D, YYYY"):"-"}function se(i){return i?i.replace(/<[^>]*>/g,""):""}function ae(i){return{Draft:"planning",Submitted:"on-hold",Approved:"completed",Rejected:"cancelled"}[i]||""}return ie(()=>{V()}),me(()=>{V()}),(i,e)=>(d(),j(t(ge),null,{default:a(()=>[s(t(P),null,{default:a(()=>[s(t(O),null,{default:a(()=>[s(t(Y),{slot:"start"},{default:a(()=>[s(t(ve),{"default-href":"/smart-pro/home",text:""})]),_:1}),s(t(W),null,{default:a(()=>[...e[9]||(e[9]=[o("Timesheet",-1)])]),_:1}),s(t(Y),{slot:"end"},{default:a(()=>[s(t(D),{onClick:q},{default:a(()=>[s(t(S),{icon:t(pe)},null,8,["icon"])]),_:1})]),_:1})]),_:1}),s(t(O),null,{default:a(()=>[s(t(fe),{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=l=>v.value=l),scrollable:""},{default:a(()=>[s(t(M),{value:"all"},{default:a(()=>[s(t(_),null,{default:a(()=>[...e[10]||(e[10]=[o("All",-1)])]),_:1})]),_:1}),s(t(M),{value:"draft"},{default:a(()=>[s(t(_),null,{default:a(()=>[...e[11]||(e[11]=[o("Draft",-1)])]),_:1})]),_:1}),s(t(M),{value:"submitted"},{default:a(()=>[s(t(_),null,{default:a(()=>[...e[12]||(e[12]=[o("Submitted",-1)])]),_:1})]),_:1}),s(t(M),{value:"approved"},{default:a(()=>[s(t(_),null,{default:a(()=>[...e[13]||(e[13]=[o("Approved",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(t($),{fullscreen:!0},{default:a(()=>[s(t(ce),{slot:"fixed",onIonRefresh:ee},{default:a(()=>[s(t(_e))]),_:1}),u("div",we,[u("div",he,[e[15]||(e[15]=u("div",{class:"text-sm opacity-90 mb-1"},"Today's Summary",-1)),u("div",Ie,[u("div",null,[u("span",Ve,m(A.value.total_hours||0),1),e[14]||(e[14]=u("span",{class:"text-lg ml-1"},"hours",-1))]),u("div",De,[u("div",Se,m(A.value.tasks_worked||0)+" tasks",1)])])])]),x.value?(d(),p("div",Te,[(d(),p(N,null,F(3,l=>u("div",{key:l,class:"app-card mb-4 p-4"},[...e[16]||(e[16]=[u("div",{class:"skeleton h-5 w-3/4 mb-2"},null,-1),u("div",{class:"skeleton h-4 w-1/2 mb-2"},null,-1),u("div",{class:"skeleton h-3 w-full"},null,-1)])])),64))])):L.value.length===0?(d(),p("div",Ce,[s(t(S),{icon:t(z),class:"empty-state-icon"},null,8,["icon"]),e[18]||(e[18]=u("div",{class:"empty-state-title"},"No timesheet entries",-1)),u("div",je,m(v.value==="draft"?"No draft timesheets":v.value==="submitted"?"No submitted timesheets":v.value==="approved"?"No approved timesheets":"Log your work hours from your assigned tasks"),1),s(t(D),{class:"mt-4",onClick:q},{default:a(()=>[...e[17]||(e[17]=[o(" Log Hours ",-1)])]),_:1})])):(d(),p("div",Me,[(d(!0),p(N,null,F(L.value,l=>(d(),p("div",{key:l.name,class:"app-card mb-4 p-4"},[u("div",Re,[u("h3",Ae,m(l.task_title||l.task||"General Work"),1),u("span",{class:re(["status-badge",ae(l.status)])},m(l.status),3)]),u("div",Be,[s(t(S),{icon:t(be),class:"mr-1"},null,8,["icon"]),o(" "+m(te(l.date)),1)]),u("div",Ne,[u("span",Fe,[s(t(S),{icon:t(z),class:"mr-1"},null,8,["icon"]),o(" "+m(l.hours_worked)+" hours ",1)]),u("span",Oe,m(l.activity_type),1)]),l.project?(d(),p("div",Ye,[s(t(S),{icon:t(ye),class:"mr-1"},null,8,["icon"]),o(" "+m(l.project),1)])):I("",!0),l.description?(d(),p("div",Ee,m(se(l.description)),1)):I("",!0),l.status==="Draft"?(d(),p("div",Ue,[s(t(D),{size:"small",expand:"block",onClick:B=>Z(l.name),disabled:b.value===l.name},{default:a(()=>[b.value===l.name?(d(),j(t(G),{key:0,name:"crescent",class:"mr-2"})):I("",!0),o(" "+m(b.value===l.name?"Submitting...":"Submit for Approval"),1)]),_:2},1032,["onClick","disabled"])])):I("",!0)]))),128))]))]),_:1}),s(t(ke),{"is-open":y.value,onDidDismiss:e[8]||(e[8]=l=>y.value=!1)},{default:a(()=>[s(t(P),null,{default:a(()=>[s(t(O),null,{default:a(()=>[s(t(W),null,{default:a(()=>[...e[19]||(e[19]=[o("Log Hours",-1)])]),_:1}),s(t(Y),{slot:"end"},{default:a(()=>[s(t(D),{onClick:e[1]||(e[1]=l=>y.value=!1)},{default:a(()=>[...e[20]||(e[20]=[o("Close",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),s(t($),{class:"ion-padding"},{default:a(()=>[u("form",{onSubmit:de(X,["prevent"])},[u("div",He,[s(t(_),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:a(()=>[...e[21]||(e[21]=[o(" Task * ",-1)])]),_:1}),s(t(J),{modelValue:n.value.task,"onUpdate:modelValue":e[2]||(e[2]=l=>n.value.task=l),placeholder:"Select a task",interface:"action-sheet",fill:"outline"},{default:a(()=>[(d(!0),p(N,null,F(H.value,l=>(d(),j(t(f),{key:l.name,value:l.name},{default:a(()=>[o(m(l.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),u("div",Le,[s(t(_),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:a(()=>[...e[22]||(e[22]=[o(" Date * ",-1)])]),_:1}),s(t(K),{modelValue:n.value.date,"onUpdate:modelValue":e[3]||(e[3]=l=>n.value.date=l),type:"date",fill:"outline",required:""},null,8,["modelValue"])]),u("div",qe,[s(t(_),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:a(()=>[...e[23]||(e[23]=[o(" Hours Worked * ",-1)])]),_:1}),s(t(K),{modelValue:n.value.hours_worked,"onUpdate:modelValue":e[4]||(e[4]=l=>n.value.hours_worked=l),type:"number",min:"0.5",max:"24",step:"0.5",placeholder:"e.g., 8",fill:"outline",required:""},null,8,["modelValue"])]),u("div",Pe,[s(t(_),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:a(()=>[...e[24]||(e[24]=[o(" Activity Type ",-1)])]),_:1}),s(t(J),{modelValue:n.value.activity_type,"onUpdate:modelValue":e[5]||(e[5]=l=>n.value.activity_type=l),interface:"action-sheet",fill:"outline"},{default:a(()=>[s(t(f),{value:"Development"},{default:a(()=>[...e[25]||(e[25]=[o("Development",-1)])]),_:1}),s(t(f),{value:"Design"},{default:a(()=>[...e[26]||(e[26]=[o("Design",-1)])]),_:1}),s(t(f),{value:"Testing"},{default:a(()=>[...e[27]||(e[27]=[o("Testing",-1)])]),_:1}),s(t(f),{value:"Documentation"},{default:a(()=>[...e[28]||(e[28]=[o("Documentation",-1)])]),_:1}),s(t(f),{value:"Meeting"},{default:a(()=>[...e[29]||(e[29]=[o("Meeting",-1)])]),_:1}),s(t(f),{value:"Research"},{default:a(()=>[...e[30]||(e[30]=[o("Research",-1)])]),_:1}),s(t(f),{value:"Bug Fix"},{default:a(()=>[...e[31]||(e[31]=[o("Bug Fix",-1)])]),_:1}),s(t(f),{value:"Code Review"},{default:a(()=>[...e[32]||(e[32]=[o("Code Review",-1)])]),_:1}),s(t(f),{value:"Deployment"},{default:a(()=>[...e[33]||(e[33]=[o("Deployment",-1)])]),_:1}),s(t(f),{value:"Other"},{default:a(()=>[...e[34]||(e[34]=[o("Other",-1)])]),_:1})]),_:1},8,["modelValue"])]),u("div",We,[s(t(_),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:a(()=>[...e[35]||(e[35]=[o(" Work Description * ",-1)])]),_:1}),s(t(Q),{modelValue:n.value.description,"onUpdate:modelValue":e[6]||(e[6]=l=>n.value.description=l),placeholder:"What did you work on today?",fill:"outline",rows:3,required:""},null,8,["modelValue"])]),u("div",$e,[s(t(_),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:a(()=>[...e[36]||(e[36]=[o(" Additional Notes ",-1)])]),_:1}),s(t(Q),{modelValue:n.value.notes,"onUpdate:modelValue":e[7]||(e[7]=l=>n.value.notes=l),placeholder:"Any additional notes...",fill:"outline",rows:2},null,8,["modelValue"])]),s(t(D),{expand:"block",type:"submit",disabled:k.value,class:"mt-6"},{default:a(()=>[k.value?(d(),j(t(G),{key:0,name:"crescent",class:"mr-2"})):I("",!0),o(" "+m(k.value?"Saving...":"Save Timesheet"),1)]),_:1},8,["disabled"]),r.value?(d(),p("div",ze,m(r.value),1)):I("",!0)],32)]),_:1})]),_:1},8,["is-open"])]),_:1}))}},Ze=oe(Ge,[["__scopeId","data-v-b156daa4"]]);export{Ze as default};
//# sourceMappingURL=TimeSheet-nrjcSIqN.js.map
