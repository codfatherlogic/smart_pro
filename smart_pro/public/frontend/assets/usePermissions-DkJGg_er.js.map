{"version":3,"file":"usePermissions-DkJGg_er.js","sources":["../../../frontend/src/composables/usePermissions.js"],"sourcesContent":["import { ref, computed } from \"vue\"\nimport { call } from \"frappe-ui\"\n\n// Shared state across all component instances (singleton pattern)\nconst permissions = ref({\n  has_full_access: false,\n  is_project_manager: false,\n  managed_projects: [],\n})\nconst loading = ref(false)\nconst error = ref(null)\nconst fetched = ref(false)\n\n/**\n * Composable for managing user permissions\n * - has_full_access: Can view all data (read-only mode)\n * - is_project_manager: Can approve timesheets for their projects\n * - managed_projects: List of project IDs managed by the user\n */\nexport function usePermissions() {\n  async function fetchPermissions() {\n    // Don't fetch again if already fetched\n    if (fetched.value) {\n      return permissions.value\n    }\n\n    loading.value = true\n    error.value = null\n    try {\n      const result = await call(\"smart_pro.smart_pro.api.projects.get_user_permissions\")\n      if (result?.success) {\n        permissions.value = {\n          has_full_access: result.has_full_access || false,\n          is_project_manager: result.is_project_manager || false,\n          managed_projects: result.managed_projects || [],\n        }\n      }\n      fetched.value = true\n      console.log(\"User permissions fetched:\", permissions.value)\n      return permissions.value\n    } catch (err) {\n      error.value = err\n      console.error(\"Failed to fetch user permissions:\", err)\n      return permissions.value\n    } finally {\n      loading.value = false\n    }\n  }\n\n  // Computed properties for easy access\n  const hasFullAccess = computed(() => permissions.value.has_full_access)\n  const isProjectManager = computed(() => permissions.value.is_project_manager)\n  const managedProjects = computed(() => permissions.value.managed_projects)\n\n  // Check if user can approve timesheet for a specific project\n  function canApproveTimesheetForProject(projectName) {\n    if (permissions.value.has_full_access) return true\n    if (!permissions.value.is_project_manager) return false\n    return permissions.value.managed_projects.includes(projectName)\n  }\n\n  // Check if user is in read-only mode (has full access but not the owner)\n  function isReadOnlyForItem(ownerOrAssignee) {\n    // If user has full access, they can see everything but in read-only mode\n    // unless they are the owner/assignee\n    return permissions.value.has_full_access\n  }\n\n  // Clear permissions (useful for logout)\n  function clearPermissions() {\n    permissions.value = {\n      has_full_access: false,\n      is_project_manager: false,\n      managed_projects: [],\n    }\n    fetched.value = false\n  }\n\n  return {\n    permissions,\n    loading,\n    error,\n    fetchPermissions,\n    hasFullAccess,\n    isProjectManager,\n    managedProjects,\n    canApproveTimesheetForProject,\n    isReadOnlyForItem,\n    clearPermissions,\n  }\n}\n"],"names":["permissions","ref","loading","error","fetched","usePermissions","fetchPermissions","__async","result","call","err","hasFullAccess","computed","isProjectManager","managedProjects","canApproveTimesheetForProject","projectName","isReadOnlyForItem","ownerOrAssignee","clearPermissions"],"mappings":"uQAIA,MAAMA,EAAcC,EAAI,CACtB,gBAAiB,GACjB,mBAAoB,GACpB,iBAAkB,CAAA,CACpB,CAAC,EACKC,EAAUD,EAAI,EAAK,EACnBE,EAAQF,EAAI,IAAI,EAChBG,EAAUH,EAAI,EAAK,EAQlB,SAASI,GAAiB,CAC/B,SAAeC,GAAmB,QAAAC,EAAA,sBAEhC,GAAIH,EAAQ,MACV,OAAOJ,EAAY,MAGrBE,EAAQ,MAAQ,GAChBC,EAAM,MAAQ,KACd,GAAI,CACF,MAAMK,EAAS,MAAMC,EAAK,uDAAuD,EACjF,OAAID,GAAA,MAAAA,EAAQ,UACVR,EAAY,MAAQ,CAClB,gBAAiBQ,EAAO,iBAAmB,GAC3C,mBAAoBA,EAAO,oBAAsB,GACjD,iBAAkBA,EAAO,kBAAoB,CAAA,CACvD,GAEMJ,EAAQ,MAAQ,GAChB,QAAQ,IAAI,4BAA6BJ,EAAY,KAAK,EACnDA,EAAY,KACrB,OAASU,EAAK,CACZ,OAAAP,EAAM,MAAQO,EACd,QAAQ,MAAM,oCAAqCA,CAAG,EAC/CV,EAAY,KACrB,QAAC,CACCE,EAAQ,MAAQ,EAClB,CACF,GAGA,MAAMS,EAAgBC,EAAS,IAAMZ,EAAY,MAAM,eAAe,EAChEa,EAAmBD,EAAS,IAAMZ,EAAY,MAAM,kBAAkB,EACtEc,EAAkBF,EAAS,IAAMZ,EAAY,MAAM,gBAAgB,EAGzE,SAASe,EAA8BC,EAAa,CAClD,OAAIhB,EAAY,MAAM,gBAAwB,GACzCA,EAAY,MAAM,mBAChBA,EAAY,MAAM,iBAAiB,SAASgB,CAAW,EADZ,EAEpD,CAGA,SAASC,EAAkBC,EAAiB,CAG1C,OAAOlB,EAAY,MAAM,eAC3B,CAGA,SAASmB,GAAmB,CAC1BnB,EAAY,MAAQ,CAClB,gBAAiB,GACjB,mBAAoB,GACpB,iBAAkB,CAAA,CACxB,EACII,EAAQ,MAAQ,EAClB,CAEA,MAAO,CACL,YAAAJ,EACA,QAAAE,EACA,MAAAC,EACA,iBAAAG,EACA,cAAAK,EACA,iBAAAE,EACA,gBAAAC,EACA,8BAAAC,EACA,kBAAAE,EACA,iBAAAE,CACJ,CACA"}