var i=(T,b,p)=>new Promise((f,m)=>{var u=r=>{try{v(p.next(r))}catch(g){m(g)}},s=r=>{try{v(p.throw(r))}catch(g){m(g)}},v=r=>r.done?f(r.value):Promise.resolve(r.value).then(u,s);v((p=p.apply(T,b)).next())});import{a as C,c as Y,F as $,e as I,j as n,l as o,u as z,P as D,G as F,i as H,f as c,k as l,D as y,J as _,O as w,H as e,I as d,M as j,N as G}from"./frappe-ui-BxXHPJLj.js";import{g as J,h as L,n as M,x as q,i as K,m as k,d as Q,j as X,k as Z,l as tt,f as et,y as st,r as B,w as at,z as R}from"./index-CDDuZJGk.js";import{e as ot}from"./index-DEyDSjtY.js";const nt={key:0,class:"p-4"},lt={key:1,class:"empty-state h-full"},rt={class:"empty-state-description"},it={key:2,class:"p-4"},dt={class:"mb-6"},ut={class:"flex justify-between items-start mb-2"},ct={class:"text-2xl font-bold text-gray-800 flex-1 pr-2"},pt={key:0,class:"text-gray-600"},mt={class:"app-card p-4 mb-6"},ft={class:"flex justify-between items-center mb-2"},vt={class:"text-primary-600 font-bold"},gt={class:"progress-bar h-3"},yt={class:"grid grid-cols-2 gap-4 mb-6"},kt={class:"app-card p-4"},xt={class:"app-card p-4"},_t={class:"app-card p-4"},wt={class:"app-card p-4"},bt={class:"font-medium"},ht={class:"space-y-3"},Pt={__name:"TaskDetail",setup(T){const b=z(),p=F(),f=H("$dayjs"),m=C(!0),u=C(""),s=C(null),v=Y(()=>{var a;return(a=s.value)!=null&&a.due_date?f(s.value.due_date).isBefore(f(),"day"):!1});function r(){return i(this,null,function*(){const a=b.params.id;if(!a){u.value="Task not found";return}m.value=!0,u.value="";try{const t=yield D("frappe.client.get",{doctype:"Smart Task",name:a});s.value=t}catch(t){console.error("Error loading task:",t),u.value=t.message||"Failed to load task"}finally{m.value=!1}})}function g(a){r().finally(()=>{a.target.complete()})}function S(a){return a?f(a).format("MMM D, YYYY"):"-"}function N(a){return{Open:"planning",Working:"on-hold","Pending Review":"on-hold",Completed:"completed",Cancelled:"cancelled"}[a]||""}function O(a){return{Low:"text-green-600",Medium:"text-blue-600",High:"text-orange-600",Critical:"text-red-600"}[a]||"text-gray-600"}function E(){var a;(a=s.value)!=null&&a.project&&p.push(`/smart-pro/project/${encodeURIComponent(s.value.project)}`)}function V(){return i(this,null,function*(){var t;yield(yield B.create({header:"Update Progress",inputs:[{name:"progress",type:"number",placeholder:"Enter progress (0-100)",min:0,max:100,value:((t=s.value)==null?void 0:t.progress)||0}],buttons:[{text:"Cancel",role:"cancel"},{text:"Update",handler:x=>i(this,null,function*(){const P=Math.min(100,Math.max(0,parseInt(x.progress)||0));yield h({progress:P})})}]})).present()})}function A(){return i(this,null,function*(){yield h({status:"Working"})})}function U(){return i(this,null,function*(){yield(yield B.create({header:"Mark Complete",message:"Are you sure you want to mark this task as complete?",buttons:[{text:"Cancel",role:"cancel"},{text:"Complete",handler:()=>i(this,null,function*(){yield h({status:"Completed",progress:100})})}]})).present()})}function h(a){return i(this,null,function*(){const t=yield at.create({message:"Saving..."});yield t.present();try{yield D("frappe.client.set_value",{doctype:"Smart Task",name:s.value.name,fieldname:a}),Object.assign(s.value,a),yield(yield R.create({message:"Task updated successfully",duration:2e3,color:"success"})).present()}catch(x){console.error("Error saving task:",x),yield(yield R.create({message:"Failed to update task",duration:2e3,color:"danger"})).present()}finally{yield t.dismiss()}})}function W(){return i(this,null,function*(){yield(yield st.create({header:"Actions",buttons:[{text:"Open in Desktop",handler:()=>{window.open(`/app/smart-task/${s.value.name}`,"_blank")}},{text:"Cancel",role:"cancel"}]})).present()})}return $(()=>{r()}),(a,t)=>(c(),I(o(et),null,{default:n(()=>[l(o(J),null,{default:n(()=>[l(o(L),null,{default:n(()=>[l(o(M),{slot:"start"},{default:n(()=>[l(o(q),{"default-href":"/smart-pro/tasks"})]),_:1}),l(o(K),null,{default:n(()=>[...t[0]||(t[0]=[y("Task Details",-1)])]),_:1}),l(o(M),{slot:"end"},{default:n(()=>[l(o(k),{onClick:W},{default:n(()=>[l(o(Q),{icon:o(ot)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),l(o(X),{fullscreen:!0},{default:n(()=>[l(o(Z),{slot:"fixed",onIonRefresh:g},{default:n(()=>[l(o(tt))]),_:1}),m.value?(c(),_("div",nt,[...t[1]||(t[1]=[e("div",{class:"skeleton h-8 w-3/4 mb-4"},null,-1),e("div",{class:"skeleton h-4 w-1/2 mb-6"},null,-1),e("div",{class:"skeleton h-24 w-full mb-4"},null,-1)])])):u.value?(c(),_("div",lt,[t[3]||(t[3]=e("div",{class:"empty-state-title"},"Error loading task",-1)),e("div",rt,d(u.value),1),l(o(k),{class:"mt-4",onClick:r},{default:n(()=>[...t[2]||(t[2]=[y("Retry",-1)])]),_:1})])):s.value?(c(),_("div",it,[e("div",dt,[e("div",ut,[e("h1",ct,d(s.value.title),1),e("span",{class:j(["status-badge",N(s.value.status)])},d(s.value.status),3)]),s.value.description?(c(),_("p",pt,d(s.value.description),1)):w("",!0)]),e("div",mt,[e("div",ft,[t[4]||(t[4]=e("span",{class:"font-medium"},"Progress",-1)),e("span",vt,d(s.value.progress||0)+"%",1)]),e("div",gt,[e("div",{class:"progress-bar-fill",style:G({width:(s.value.progress||0)+"%"})},null,4)]),l(o(k),{expand:"block",fill:"outline",class:"mt-4",onClick:V},{default:n(()=>[...t[5]||(t[5]=[y(" Update Progress ",-1)])]),_:1})]),e("div",yt,[e("div",kt,[t[6]||(t[6]=e("div",{class:"text-xs text-gray-500 mb-1"},"Project",-1)),e("div",{class:"font-medium text-primary-600",onClick:E},d(s.value.project||"-"),1)]),e("div",xt,[t[7]||(t[7]=e("div",{class:"text-xs text-gray-500 mb-1"},"Due Date",-1)),e("div",{class:j(["font-medium",{"text-red-600":v.value}])},d(S(s.value.due_date)),3)]),e("div",_t,[t[8]||(t[8]=e("div",{class:"text-xs text-gray-500 mb-1"},"Priority",-1)),e("div",{class:j(["font-medium",O(s.value.priority)])},d(s.value.priority||"Normal"),3)]),e("div",wt,[t[9]||(t[9]=e("div",{class:"text-xs text-gray-500 mb-1"},"Assigned To",-1)),e("div",bt,d(s.value.assigned_to||"-"),1)])]),e("div",ht,[s.value.status!=="Completed"?(c(),I(o(k),{key:0,expand:"block",onClick:U},{default:n(()=>[...t[10]||(t[10]=[y(" Mark as Complete ",-1)])]),_:1})):w("",!0),s.value.status==="Open"?(c(),I(o(k),{key:1,expand:"block",fill:"outline",onClick:A},{default:n(()=>[...t[11]||(t[11]=[y(" Start Working ",-1)])]),_:1})):w("",!0)])])):w("",!0)]),_:1})]),_:1}))}};export{Pt as default};
//# sourceMappingURL=TaskDetail-CcMADYCi.js.map
